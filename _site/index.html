<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="Dzenan Ridjanovic"/>
        <title>On Dart</title> 
        <link rel="stylesheet" href="/css/code.css"/>  
        <link rel="stylesheet" href="/css/layout.css"/>
        <link rel="stylesheet" href="/css/link.css"/>
        <link rel="stylesheet" href="/css/list.css"/>
        <link rel="stylesheet" href="/css/menu.css"/>
        <link rel="stylesheet" href="/css/page.css"/>
    </head>

    <body>
        <header>  
            <h1>
                <a href="http://www.ondart.info/"><img src="/img/ondartb1.png"/></a>
               On Dart
               <!--  -->
            </h1>
        </header>

        <nav>
            <ul>
                <li>Dart
                    <ul>
                        <li>
                            <a href="http://www.dartlang.org/">Dart</a>
                        </li>
                        <li>
                            <a href="http://try.dartlang.org/">Dart Console</a>
                        </li>
                    </ul>  
                </li>
                <li>Magic Boxes
                    <ul>
                        <li>
                            <a href="http://goo.gl/I72z1">Browse Code</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Design Model</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes">Get Git</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes/tags">Get Spirals</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s00/MagicBoxes/MagicBoxes.html">Spiral 00</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s01/MagicBoxes/MagicBoxes.html">Spiral 01</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s02/MagicBoxes/MagicBoxes.html">Spiral 02</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s03/MagicBoxes/MagicBoxes.html">Spiral 03</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s04/MagicBoxes/MagicBoxes.html">Spiral 04</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s05/MagicBoxes/MagicBoxes.html">Spiral 05</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s06/MagicBoxes/MagicBoxes.html">Spiral 06</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s07/MagicBoxes/MagicBoxes.html">Spiral 07</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s08/MagicBoxes/MagicBoxes.html">Spiral 08</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s09/MagicBoxes/MagicBoxes.html">Spiral 09</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s10/MagicBoxes/MagicBoxes.html">Spiral 10</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Spiral 11</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s12/MagicBoxes/MagicBoxes.html">Spiral 12</a> 
                        </li>
                    </ul>  
                </li>
                <li>On Dart
                    <ul>
                        <li>
                            <a href="https://plus.google.com/u/0/b/113649577593294551754/113649577593294551754/posts">Google+ Page</a> 
                        </li>
                    </ul>  
                </li>
                <li>Posts
                    <ul>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a> 
                        </li>
                        <li>
                            &nbsp; 
                        </li>
                    </ul>  
                </li>
                <li>About
                    <ul>
                        <li>
                            <a href="http://goo.gl/f1F2e">D. R. (CV in PDF)</a> 
                        </li>
                    </ul>  
                </li>
            </ul>
        </nav>

        <section>
            <section>
    
        <h2><a href="/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 06, a line tool in the tool bar, allows a line creation between the last two clicked boxes.</p>

<p>In Spiral 07, a line may be selected and deleted. A menu bar has Edit, View and Create menus. The Edit menu has menu items for selecting all boxes and lines, and for deleting selected boxes and lines. The View menu has menu items for hiding and showing selected boxes and lines. The Create menu has menu items for generating boxes in a diagonal and as tiles.</p>

<p>The MenuBar class has a new content with six buttons.</p>

<p><strong>Code 06-07.01</strong>: The MenuBar class with six buttons.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='c1'>// Edit</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectAllButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>deleteSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// View</span>
  <span class='n'>ButtonElement</span> <span class='n'>hideSelectionButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>showHiddenSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// Creaete</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesInDiagonalButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesAsTilesButton</span><span class='o'>;</span>
  
  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>selectAllButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>all</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>deleteSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>delete</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>hideSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>hide</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>showHiddenSelectionButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>show</span><span class='o'>-</span><span class='n'>hidden</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>createBoxesInDiagonalButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>in</span><span class='o'>-</span><span class='n'>diagonal</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>createBoxesAsTilesButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>as</span><span class='o'>-</span><span class='n'>tiles</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Menu bar events.</span>
    <span class='n'>selectAllButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>deleteSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>deleteSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>hideSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>hideSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>showHiddenSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>showHiddenSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>createBoxesInDiagonalButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesInDiagonal</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>createBoxesAsTilesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesAsTiles</span><span class='o'>();</span>
    <span class='o'>});</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The Board class has changed to provide methods used in the MenuBar class. The select method select s boxes only. The line selection will be done in one of the next steps towards the Spiral 07.</p>

<p><strong>Code 06-07.02</strong>: The select method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selectBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Similarly, the deleteSelection, hideSelection and showHiddenSelection methods do not yet handle selected lines.</p>

<p><strong>Code 06-07.03</strong>: The deleteSelection method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>hideSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>hideSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>showHiddenSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>showHiddenBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The createBoxesInDiagonal method of the Board class generates boxes in a diagonal (Figure 06-07.01). The initialization of the x and y local variables is done in a single line of code. The <strong>while</strong> loop may seem to iterate forever, because its condition to loop is <strong>true</strong>. However, the <strong>false</strong> condition of the <strong>if</strong> statement enters the <strong>else</strong> part and the <strong>return</strong> statement stops the iterations by exiting the method. If the next box may be positioned diagonally within the board, the box is created in that position. The x and y variables are incremented by the two constants from the Box class before the next iteration.</p>

<p><strong>Code 06-07.04</strong>: Boxes created in a diagonal.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxesInDiagonal</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>while</span> <span class='o'>(</span><span class='kc'>true</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span> 
          <span class='o'>&amp;&amp;</span> <span class='n'>y</span> <span class='o'>&lt;=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>;</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><img src='/img/s06s07/BoxesInDiagonal.png' alt='Alt Figure 06-07.01: Five boxes created in a diagonal' /></p>

<p><strong>Figure 06-07.01</strong>: Five boxes created in a diagonal.</p>

<p>The createBoxesAsTiles method of the Board class generates boxes as tiles (Figure 06-07.02). If a new box may be positioned as a tile within the board, the box is created in that position. It is a value of the y variable that determines when the method will be returned to a caller.</p>

<p><strong>Code 06-07.05</strong>: Boxes created as tiles.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxesAsTiles</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>while</span> <span class='o'>(</span><span class='kc'>true</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span> <span class='o'>*</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span> <span class='o'>*</span> <span class='mi'>2</span><span class='o'>;</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>return</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><img src='/img/s06s07/BoxesAsTiles.png' alt='Alt Figure 06-07.02: Twelve boxes created as tiles' /></p>

<p><strong>Figure 06-07.02</strong>: Twelve boxes created as tiles.</p>

<p>The nav element of HTML5 contains an unordered list of items that are menus. Each menu contains another unordered list of items that are menu items.</p>

<p><strong>Code 06-07.06</strong>: The navigation section of HTML5.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;nav&gt;</span>
     <span class='nt'>&lt;ul&gt;</span>
       <span class='nt'>&lt;li&gt;</span>File
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>  
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Edit
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-all&quot;</span><span class='nt'>&gt;</span>
               Select All
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;delete-selection&quot;</span><span class='nt'>&gt;</span>
               Delete Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>View
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;hide-selection&quot;</span><span class='nt'>&gt;</span>
               Hide Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;show-hidden-selection&quot;</span><span class='nt'>&gt;</span>
               Show Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Create
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-in-diagonal&quot;</span><span class='nt'>&gt;</span>
               Boxes in Diagonal
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-as-tiles&quot;</span><span class='nt'>&gt;</span>
               Boxes As Tiles
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>About
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Magic Boxes in 
             <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;http://www.dart.org/&quot;</span><span class='nt'>&gt;</span>Dart<span class='nt'>&lt;/a&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Spiral 07<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>2011-12-23<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Dzenan Ridjanovic<span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>   
       <span class='nt'>&lt;/li&gt;</span>
     <span class='nt'>&lt;/ul&gt;</span>
    <span class='nt'>&lt;/nav&gt;</span>
</code></pre>
</div>
<p>The menu.css file has selectors that present the navigation section of the mb.html file as a menu bar with menus and drop down menu items.</p>

<p><strong>Code 06-07.07</strong>: CSS presentation of drop down menus.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>nav</span> <span class='p'>{</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>100</span><span class='o'>%</span><span class='p'>;</span>
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>30px</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>border-top</span><span class='o'>:</span> <span class='m'>2px</span> <span class='k'>solid</span> <span class='m'>#999999</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>margin</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span> 
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>inline</span><span class='p'>;</span> 
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>30px</span><span class='p'>;</span> 
    <span class='k'>float</span><span class='o'>:</span> <span class='k'>left</span><span class='p'>;</span> 
    <span class='k'>list-style</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>margin-left</span><span class='o'>:</span> <span class='m'>15px</span><span class='p'>;</span>
    <span class='k'>position</span><span class='o'>:</span> <span class='k'>relative</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='nt'>li</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>margin</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>padding-top</span><span class='o'>:</span> <span class='m'>8px</span><span class='p'>;</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>position</span><span class='o'>:</span> <span class='k'>absolute</span><span class='p'>;</span>
    <span class='k'>left</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>top</span><span class='o'>:</span> <span class='m'>20px</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>14px</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span><span class='nd'>:hover</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>block</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>180px</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
    <span class='k'>list-style</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>list-item</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:link</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#e6ffc8</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:visited</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#f2e1fb</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>button</span> <span class='p'>{</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>14px</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>button</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>Lines may be selected (Figure 06-07.03) and then hidden. The Line class two private attributes initialized both to <strong>false</strong> to state that a new line is neither selected nor hidden. A default line width is borrowed in the constructor of the Line class from the context attribute of the board. In the same constructor in Spiral 07 there is a double use of the draw method. The error is not repeated in this step.</p>

<p><strong>Code 06-07.08</strong>: New attributes in the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  
  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The line selection appears in the title of the Web page.</p>

<p><img src='/img/s06s07/LineSelection.png' alt='Alt Figure 06-07.03: Selected lines have a bigger width' /></p>

<p><strong>Figure 06-07.03</strong>: Selected lines have a bigger width.</p>

<p>The draw method of the Line class draws a line if it is not hidden. The width of a selected line is bigger for 2 pixels than the default width.</p>

<p><strong>Code 06-07.09</strong>: The draw method of the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> 
        <span class='n'>box1</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> 
        <span class='n'>box2</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span> <span class='o'>+</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The methods for the two private attributes are expressed in short notation.</p>

<p><strong>Code 06-07.10</strong>: Short notation used in select, hide and their related methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>select</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>deselect</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>toggleSelection</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>_selected</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isSelected</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span><span class='o'>;</span>
  
  <span class='n'>hide</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>show</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isHidden</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span><span class='o'>;</span>
</code></pre>
</div>
<p>The contains method of the Line class returns true if the given point is on the line between the centers of the two boxes with the error of delta in pixels. The method uses the Point class of Dart.</p>

<p><strong>Code 06-07.11</strong>: The contains method of the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>contains</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>point</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>delta</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>||</span> 
        <span class='n'>box2</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='n'>Point</span> <span class='n'>pointDif</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>inLineRectX</span><span class='o'>,</span> <span class='n'>inLineRectY</span><span class='o'>,</span> <span class='n'>inLineRect</span><span class='o'>;</span>
    <span class='kt'>double</span> <span class='n'>coord</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='c1'>// Rapid test: Verify if the point is in the line rectangle.</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='n'>inLineRect</span> <span class='o'>=</span> <span class='n'>inLineRectX</span> <span class='o'>&amp;&amp;</span> <span class='n'>inLineRectY</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>inLineRect</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='c1'>// If the line is horizontal or vertical </span>
    <span class='c1'>// there is no need to continue.</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>||</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&gt;</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> 
      <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> 
      <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>There are many additions and changes in the Board class to support different actions on lines.</p>

<p><strong>Code 06-07.12</strong>: Methods on lines in the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>lines</span><span class='o'>.</span><span class='na'>clear</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteLine</span><span class='o'>(</span><span class='n'>Line</span> <span class='n'>lineToDelete</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>==</span> <span class='n'>lineToDelete</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>lines</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>line</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>lines</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>countSelectedLines</span><span class='o'>()</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>deleteLine</span><span class='o'>(</span><span class='n'>line</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>selectLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>line</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selectBoxes</span><span class='o'>();</span>
    <span class='n'>selectLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>deselectLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>line</span><span class='o'>.</span><span class='na'>deselect</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deselect</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deselectBoxes</span><span class='o'>();</span>
    <span class='n'>deselectLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>hideSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>hide</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>hideSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>hideSelectedBoxes</span><span class='o'>();</span>
    <span class='n'>hideSelectedLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>showHiddenLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>show</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>showHiddenSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>showHiddenBoxes</span><span class='o'>();</span>
    <span class='n'>showHiddenLines</span><span class='o'>();</span>
  <span class='o'>}</span>

  <span class='kt'>int</span> <span class='nf'>countSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>int</span> <span class='nf'>countSelectedLinesContain</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>pointX</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>pointY</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Point</span> <span class='n'>delta</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>DELTA</span><span class='o'>,</span> <span class='n'>DELTA</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>()</span> 
          <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>pointX</span><span class='o'>,</span> <span class='n'>pointY</span><span class='o'>),</span> <span class='n'>delta</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='n'>Line</span> <span class='nf'>_lineContains</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>point</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Point</span> <span class='n'>delta</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>DELTA</span><span class='o'>,</span> <span class='n'>DELTA</span><span class='o'>);</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>,</span> <span class='n'>delta</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='n'>line</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The DELTA constant of the Board class has the value of 8 pixels. This means that within the 8 pixels surrounding a line, a click will select the line. The private lineContains method of the Board class returns a line that contains the given point with the DELTA error.</p>

<p>In the onMouseMethod of the Board class, if a click happens outside of an existing box and the select tool is on, the click point is passed to the private lineContains method. If the method returns a line, the toggleSelection method is applied to the line. Otherwise, selected boxes and lines are deselected.</p>

<p><strong>Code 06-07.13</strong>: The active select tool part of the onMouseDown method.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>Point</span> <span class='n'>clickedPoint</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>);</span>
        <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>_lineContains</span><span class='o'>(</span><span class='n'>clickedPoint</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='c1'>// Select or deselect the existing line.</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>toggleSelection</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='c1'>// Deselect all.</span>
          <span class='n'>deselect</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span> <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The draw method of the Box class must use the default line width in order draw the current box properly. Without the setLineWidth method, after a line is selected, the boxes may have the same line width as the selected line.</p>

<p><strong>Code 06-07.14</strong>: The defaultLineWidth attribute of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>titleNo</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>nextBoxNo</span><span class='o'>;</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='err'>…</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Board class has also the defaultLineWidth attribute that is used in drawing a border.</p>

<p><strong>Code 06-07.15</strong>: The defaultLineWidth attribute of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The defaultLineWidth attribute is used in drawing the diagram border.</p>

<p><strong>Code 06-07.16</strong>: The border has the default width.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>border</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>When deleting a box, if the box is one of the last two clicked boxes referenced by the lastBoxClicked attribute or the beforeLastBoxClicked attribute, the corresponding attribute must reference <strong>null</strong> instead of the deleted box. Otherwise, a new line may be created that is hanging in the air.</p>

<p><strong>Code 06-07.17</strong>: Nullifying one of the last two clicked boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>beforeLastBoxClicked</span> <span class='o'>==</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>lastBoxClicked</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>lastBoxClicked</span> <span class='o'>==</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The delete method of the Board class must delete all lines and boxes and the fixed tool should return to select.</p>

<p><strong>Code 06-07.18</strong>: The delete method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>delete</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteLines</span><span class='o'>();</span>
    <span class='n'>deleteBoxes</span><span class='o'>();</span>
    <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToSelectAsFixedTool</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private selectToolDblClicked attribute of the bool type is replaced by the private fixedTool attribute of the int type in the ToolBar class. This is done to resolve the problem of keeping the line tool active even without double-clicking on it. A tool may be on (active) after a click on it. Its active status determines the next action. However, after the action is done, the fixed tool becomes active. A tool becomes fixed after a double-click on it.</p>

<p><strong>Code 06-07.19</strong>: The ToolBar class with private onTool and fixedTool attributes.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span> 
  <span class='err'>…</span>
  <span class='kt'>int</span> <span class='n'>_onTool</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>_fixedTool</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>BOX</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>BOX</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>LINE</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>LINE</span><span class='o'>;</span>
    <span class='o'>});</span>
    
    <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='err'>…</span>
  
  <span class='kt'>void</span> <span class='nf'>backToFixedTool</span><span class='o'>()</span>  <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>_fixedTool</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>backToSelectAsFixedTool</span><span class='o'>()</span>  <span class='o'>{</span>
    <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
  <span class='o'>}</span>
  
<span class='o'>}</span>
</code></pre>
</div>
<p>After a selection of boxes and lines is deleted, a diagram may be empty. In that case the fixed tool must return to select.</p>

<p><strong>Code 06-07.20</strong>: When deleting a selection of all boxes and lines.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isEmpty</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToSelectAsFixedTool</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='n'>bool</span> <span class='nf'>isEmpty</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>boxes</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>==</span> <span class='mi'>0</span> <span class='o'>&amp;&amp;</span> <span class='n'>lines</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private boxExists method of the Board class returns <strong>true</strong> if the given box is a member of the boxes attribute.</p>

<p><strong>Code 06-07.21</strong>: The private boxExists method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>_boxExists</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>b</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>b</span> <span class='o'>==</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>This method is called in the onMouseDown method to check if the last two boxes clicked used in a new line creation do actually exist. After one of actions is done by the onMouseDown method, the fixed tool is back.</p>

<p><strong>Code 06-07.22</strong>: The onMouseDown method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>bool</span> <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='c1'>// Clicked on the existing box.</span>
        <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>Point</span> <span class='n'>clickedPoint</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>);</span>
        <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>_lineContains</span><span class='o'>(</span><span class='n'>clickedPoint</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='c1'>// Select or deselect the existing line.</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>toggleSelection</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='c1'>// Deselect all.</span>
          <span class='n'>deselect</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isBoxToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='c1'>// Create a box in the position of the mouse click on the board.</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isLineToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='c1'>// Create a line between the last two clicked boxes.</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>beforeLastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> <span class='n'>lastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> 
            <span class='n'>_boxExists</span><span class='o'>(</span><span class='n'>beforeLastBoxClicked</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> 
            <span class='n'>_boxExists</span><span class='o'>(</span><span class='n'>lastBoxClicked</span><span class='o'>))</span> <span class='o'>{</span>  
          <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>,</span> 
            <span class='n'>lastBoxClicked</span><span class='o'>);</span>
          <span class='n'>lines</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>line</span><span class='o'>);</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
      <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToFixedTool</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the onMouseDown method of the Box class, when a box is clicked on, before it becomes the last box clicked, the actual last box clicked first becomes the box clicked before the last one, but only if it is not <strong>null</strong> and if it is different from the current box.</p>

<p><strong>Code 06-07.23</strong>: Updating the two last boxes clicked.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>board</span><span class='o'>.</span><span class='na'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> 
        <span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>toggleSelection</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> 
          <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>!=</span> <span class='k'>this</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>beforeLastBoxClicked</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
        <em>Posted on 21 February 2012</em>
    
        <h2><a href="/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 05, there is a tool bar that provides a new way of creating, selecting and moving boxes. In Spiral 06, a menu bar provides four buttons to select all boxes, to delete selected boxes, to hide selected boxes and to show hidden boxes. A line tool in the tool bar, allows a line creation between the last two clicked boxes.</p>

<p>A simple menu bar provides two buttons to create 6 boxes and to delete all boxes (Figure 05-06.01).</p>

<p><img src='/img/s05s06/SimpleMenuBar.png' alt='Alt Figure 05-06.01: Simple menu bar' /></p>

<p><strong>Figure 05-06.01</strong>: Simple menu bar.</p>

<p>The new MenuBar class has two button attributes of the ButtonElement type. The class has also the board attribute, to have access to methods of the Board class.</p>

<p><strong>Code 05-06.01</strong>: The MenuBar class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>deleteBoxesButton</span><span class='o'>;</span>
  
  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>createBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>deleteBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>delete</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Menu bar events.</span>
    <span class='n'>createBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxes</span><span class='o'>(</span><span class='mi'>6</span><span class='o'>);</span>
    <span class='o'>});</span>
    
    <span class='n'>deleteBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>deleteBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>In the constructor of the MenuBar class the two button elements are found in the document by using the query method and element ids. The buttons are linked to click events in order to create 6 boxes by the first button and to delete all boxes by the second button.</p>

<p><strong>Code 05-06.02</strong>: The two methods of the MenuBar class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxes</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>n</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='kt'>int</span> <span class='n'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='n'>i</span> <span class='o'>&lt;</span> <span class='n'>n</span><span class='o'>;</span> <span class='n'>i</span><span class='o'>++)</span> <span class='o'>{</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
        <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>));</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>boxes</span><span class='o'>.</span><span class='na'>clear</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The for loop in the createBoxes method is initialized with the i variable of the int type. The loop is terminated when the value of the I variable becomes n. With each iteration the i variable is incremented by 1.</p>

<p>The menu bar is represented in the mb.html file by the nav element of HTML5, which defines a section of navigation links.</p>

<p><strong>Code 05-06.03</strong>: The navigation section.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;nav</span> <span class='na'>id=</span><span class='s'>&quot;menu&quot;</span> <span class='na'>class=</span><span class='s'>&quot;menu&quot;</span><span class='nt'>&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes&quot;</span><span class='nt'>&gt;</span>Create Boxes<span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;delete-boxes&quot;</span><span class='nt'>&gt;</span>Delete Boxes<span class='nt'>&lt;/button&gt;</span>
    <span class='nt'>&lt;/nav&gt;</span>
</code></pre>
</div>
<p>The presentation of the nav element is determined by the CSS class called menu. This user defined class is a CSS selector placed in the menu.css file, located in the css sub-folder of the project. The class name is prefixed with a dot. This name does not have to be unique, as an identifier name, within a page.</p>

<p><strong>Code 05-06.04</strong>: The menu class of CSS.</p>
<div class='highlight'><pre><code class='css'>  <span class='nc'>.menu</span> <span class='p'>{</span>
    <span class='k'>margin</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>0px</span> <span class='m'>0px</span> <span class='m'>0px</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#fffff0</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>The menu bar is an attribute of the Board class. It is created in the constructor of the Board class.</p>

<p><strong>Code 05-06.05</strong>: The menu bar attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>MenuBar</span> <span class='n'>menuBar</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>menuBar</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
</code></pre>
</div>
<p>The MenuBar class is updated to have four buttons to select all boxes, to delete selected boxes, to hide selected boxes and to show hidden boxes (Figure 05-06.02).</p>

<p><img src='/img/s05s06/MenuBar.png' alt='Alt Figure 05-06.02: Menu bar' /></p>

<p><strong>Figure 05-06.02</strong>: Menu bar.</p>

<p>The MenuBar class is completely changed to contain the four new buttons of the ButtonElement type. In the constructor of the class, the four buttons are obtained by the query method, and click events are linked to the buttons. A click on a button, triggers a corresponding action (a method of the Board class).</p>

<p><strong>Code 05-06.06</strong>: The menu bar with four buttons.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='n'>ButtonElement</span> <span class='n'>selectBoxesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>deleteSelectedBoxesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>hideSelectedBoxesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>showHiddenBoxesButton</span><span class='o'>;</span>
  
  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>selectBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>deleteSelectedBoxesButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>delete</span><span class='o'>-</span><span class='n'>selected</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>hideSelectedBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>hide</span><span class='o'>-</span><span class='n'>selected</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>showHiddenBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>show</span><span class='o'>-</span><span class='n'>hidden</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Menu bar events.</span>
    <span class='n'>selectBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>selectBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>deleteSelectedBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>deleteSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>hideSelectedBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>hideSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>showHiddenBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>showHiddenBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The selectBoxes method of the Board class is similar to the deselectBoxes method. As the deselectBoxes does not verify if a box is selected before it is deselected, the selectBoxes method does not check if a box is not selected before selecting it.</p>

<p><strong>Code 05-06.07</strong>: The selectBoxes method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>selectBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In a for loop over the boxes attribute, if a box is selected it is removed from the boxes attribute. To remove the box, its index (a sequential integer starting with zero for the first box in the boxes attribute) is found by the indexOf method of the List type. The box is removed by the removeRange method of the List type, which requires the index argument of the first object in the given range size, which is in our case 1.</p>

<p><strong>Code 05-06.08</strong>: The deleteSelectedMethod of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>However, only half of the boxes are removed from the list. From the ten selected boxes in Figure 05-06.03,</p>

<p><img src='/img/s05s06/SelectedBoxes.png' alt='Alt Figure 05-06.03: Ten selected boxes' /></p>

<p><strong>Figure 05-06.03</strong>: Ten selected boxes.</p>

<p>there are five boxes in Figure 05-06.04, which are left on the board after a click on the Delete Selected Boxes button.</p>

<p><img src='/img/s05s06/HalfDeletedBoxes.png' alt='Alt Figure 05-06.04: Five boxes left after deleting all selected boxes' /></p>

<p><strong>Figure 05-06.04</strong>: Five boxes left after deleting all selected boxes.</p>

<p>Obviously, this is a problem that will be resolved in the next step.</p>

<p>The hideSelectedBoxes and showHiddenBoxes of the Board class delegate the tasks to the Box class.</p>

<p><strong>Code 05-06.09</strong>: To hide and show selected boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>hideSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>hide</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>showHiddenBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>show</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private _hidden attribute is initialized to <strong>false</strong>. The hide method changes a value of the attribute to <strong>true</strong>, while the show method assigns <strong>false</strong> to the attribute. The isHidden method returns a boolean value of the private attribute.</p>

<p><strong>Code 05-06.10</strong>: To hide and show a box.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>bool</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  
  <span class='n'>hide</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>show</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isHidden</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span><span class='o'>;</span>
</code></pre>
</div>
<p>The draw method does its job only if a box is not hidden.</p>

<p><strong>Code 05-06.11</strong>: The draw method of the Box.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The menu bar gets a new look with the help of the button selector in the link.css file.</p>

<p><strong>Code 05-06.12</strong>: The class selector with the button name.</p>
<div class='highlight'><pre><code class='css'>  <span class='nc'>.button</span> <span class='p'>{</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>1px</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#ffcc99</span><span class='p'>;</span> 
    <span class='k'>border-right</span><span class='o'>:</span> <span class='m'>1px</span> <span class='k'>solid</span> <span class='m'>#999</span><span class='p'>;</span>
    <span class='k'>border-bottom</span><span class='o'>:</span> <span class='m'>1px</span> <span class='k'>solid</span> <span class='m'>#999</span><span class='p'>;</span>
    <span class='k'>border-style</span><span class='o'>:</span> <span class='k'>outset</span><span class='p'>;</span>
    <span class='k'>border-color</span><span class='o'>:</span> <span class='m'>#d7b9c9</span><span class='p'>;</span> 
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>text-align</span><span class='o'>:</span> <span class='k'>center</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>The for button elements are embedded within the nav element.</p>

<p><strong>Code 05-06.13</strong>: The navigation section with the button class.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;nav</span> <span class='na'>id=</span><span class='s'>&quot;menu&quot;</span> <span class='na'>class=</span><span class='s'>&quot;menu&quot;</span><span class='nt'>&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-boxes&quot;</span> <span class='na'>class=</span><span class='s'>&quot;button&quot;</span><span class='nt'>&gt;</span>
        Select All Boxes
      <span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;delete-selected-boxes&quot;</span> <span class='na'>class=</span><span class='s'>&quot;button&quot;</span><span class='nt'>&gt;</span>
        Delete Selected Boxes
      <span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;hide-selected-boxes&quot;</span> <span class='na'>class=</span><span class='s'>&quot;button&quot;</span><span class='nt'>&gt;</span>
        Hide Selected Boxes
      <span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;show-hidden-boxes&quot;</span> <span class='na'>class=</span><span class='s'>&quot;button&quot;</span><span class='nt'>&gt;</span>
        Show Hidden Boxes
      <span class='nt'>&lt;/button&gt;</span>
    <span class='nt'>&lt;/nav&gt;</span>
</code></pre>
</div>
<p>The problem of removing every second box from the list of boxes is resolved by making the deleteSelectedBoxes method of the Board class recursive. The method calls itself at the end of its body. When there are no more selected boxes to remove, the method terminates its action by the <strong>return</strong> statement.</p>

<p><strong>Code 05-06.14</strong>: The recursive method.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>countSelectedBoxes</span><span class='o'>()</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>deleteBox</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The deleteSelectedBoxes method starts with counting selected boxes by the countSelectedBoxes method of the Board class and comparing the count with zero. If the count is equal to zero, the task of removing all selected boxes is successfully done.</p>

<p><strong>Code 05-06.15</strong>: Counting selected boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='nf'>countSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A single box is removed from the boxes attribute by the deleteBox method of the Board class.</p>

<p><strong>Code 05-06.16</strong>: Removing a box from boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A for loop iterates over all boxes. In a single iteration, if a box to be deleted is equal to the box of that iteration, the sequential index of the box, which starts with 0 with the first box in the list, is found by the indexOf method of the List type. This index number of the int (integer) type is used to remove objects from the range of objects that starts with that index. The range size is 1. Thus, only one box is removed from boxes by the removeRange method of the List type.</p>

<p>In addition to boxes, lines may be now created between boxes (Figure 05-06.05). A new line is created first by selecting the line tool in the tool bar, second by clicking on two different boxes, then by clicking on an empty space in the board. A line may also be created by clicking on two different boxes, then by selecting the line tool in the tool bar, and finally by clicking on an empty space in the board. The line tool may be double-clicked to keep it active in order to create more than one line. The select tool must be double-clicked to return to the select mode.</p>

<p><img src='/img/s05s06/Lines.png' alt='Alt Figure 05-06.05: Boxes and lines' /></p>

<p><strong>Figure 05-06.05</strong>: Boxes and lines.</p>

<p>The ToolBar class is updated to accommodate the LINE tool. A boolean private attribute _selectToolDblClicked replaced the _boxToolDblClicked attribute.</p>

<p><strong>Code 05-06.17</strong>: Line button in the tool bar.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>LINE</span> <span class='o'>=</span> <span class='mi'>3</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>bool</span> <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  
  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>ButtonElement</span> <span class='n'>lineButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Tool bar events.</span>
    <span class='err'>…</span>
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>LINE</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>LINE</span><span class='o'>;</span>
      <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The isLineToolOn method is added to the ToolBar class, and the selectToolOn method is updated.</p>

<p><strong>Code 05-06.18</strong>: Two methods of the ToolBar class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>isLineToolOn</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>LINE</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span> 
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>selectToolOn</span><span class='o'>()</span>  <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_selectToolDblClicked</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Line class represents the line concept. It constructor accepts the board and two boxes as line ends. The line will be drawn between centers of the boxes. The moveTo method positions an imaginary pen to the center of the first box, while the lineTo method moves the pen to the center of the second box.</p>

<p><strong>Code 05-06.19</strong>: The Line class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Line</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='n'>Box</span> <span class='n'>box1</span><span class='o'>;</span>
  <span class='n'>Box</span> <span class='n'>box2</span><span class='o'>;</span>
  
  <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>draw</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span>
      <span class='n'>box1</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span>
      <span class='n'>box2</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The lines attribute of the Board class is of the List type. The type is parameterized to accept only objects of the Line class.</p>

<p><strong>Code 05-06.20</strong>: The lines attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>List</span><span class='o'>&lt;</span><span class='n'>Line</span><span class='o'>&gt;</span> <span class='n'>lines</span><span class='o'>;</span>
  
  <span class='n'>Box</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>;</span>
  <span class='n'>Box</span> <span class='n'>lastBoxClicked</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>lines</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>List</span><span class='o'>();</span>
</code></pre>
</div>
<p>There are also two box attributes that make references to two boxes that are last clicked on. Their values are determined in the onMouseDown method of the Box class.</p>

<p><strong>Code 05-06.21</strong>: The last box clicked on.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>board</span><span class='o'>.</span><span class='na'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>()</span> 
      <span class='o'>&amp;&amp;</span> <span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>toggleSelection</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>beforeLastBoxClicked</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span><span class='o'>;</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The main work of managing events conditionally on the active tool of the tool bar is done in the onMouseDown method of the Board class. If a click does not hit an existing box, three different modes are handled: select, box and line. If the tool bar is in the line mode, a new line is constructed, but only if there are boxes (different from <strong>null</strong>) to be connected by the line. The <strong>null</strong> symbol represents a non-existence of an object. If a variable is not (!) <strong>null</strong>, it means that it references an existing object.</p>

<p><strong>Code 05-06.22</strong>: Managing events based on the active tool.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>bool</span> <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>deselectBoxes</span><span class='o'>();</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isBoxToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>selectToolOn</span><span class='o'>();</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isLineToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>beforeLastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> <span class='n'>lastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>,</span> 
            <span class='n'>lastBoxClicked</span><span class='o'>);</span>
          <span class='n'>lines</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>line</span><span class='o'>);</span>
        <span class='o'>}</span>
        <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>selectToolOn</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The line button element is added to the footer of the main section of the page. The line.png image is located in the img folder of the application.</p>

<p><strong>Code 05-06.23</strong>: The line button.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section</span> <span class='na'>id=</span><span class='s'>&quot;main&quot;</span><span class='nt'>&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;630&quot;</span> <span class='na'>height=</span><span class='s'>&quot;580&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/select.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;box&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/box.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;line&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/line.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The tool buttons in the tool bar have a visual sign (Figure 05-06.06) which one is active (on). The active tool has a black border, while off buttons have a grey border.</p>

<p><img src='/img/s05s06/ToolBarOnBorder.png' alt='Alt Figure 05-06.06: Active tool in the tool bar has a black border' /></p>

<p><strong>Figure 05-06.06</strong>: Active tool in the tool bar has a black border.</p>

<p>The ToolBar class has now the three buttons as attributes.</p>

<p><strong>Code 05-06.24</strong>: The tool buttons as attributes.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='kt'>int</span> <span class='n'>_onTool</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_selectToolDblClicked</span><span class='o'>;</span>
  
  <span class='n'>ButtonElement</span> <span class='n'>selectButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>boxButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>lineButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>The button attributes are used in the new onTool method to change the color of button elements depending on the active tool.</p>

<p><strong>Code 05-06.25</strong>: The active button changes its border color to black.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>onTool</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>tool</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>tool</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>SELECT</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#000000&quot;</span><span class='o'>;</span> <span class='c1'>// black</span>
      <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
      <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>BOX</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
      <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#000000&quot;</span><span class='o'>;</span> <span class='c1'>// black</span>
      <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>LINE</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
      <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#808080&quot;</span><span class='o'>;</span> <span class='c1'>// grey</span>
      <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>style</span><span class='o'>.</span><span class='na'>borderColor</span> <span class='o'>=</span> <span class='s'>&quot;#000000&quot;</span><span class='o'>;</span> <span class='c1'>// black</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The onTool method is called in the constructor of the ToolBar class. Note that the _onTool and _selectToolDblClicked private attributes are now initialized in the constructor.</p>

<p><strong>Code 05-06.26</strong>: The use of the onTool method to put a tool on.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>selectButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>boxButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>box</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>lineButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Tool bar events.</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='o'>});</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
      <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>});</span>
    
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>BOX</span><span class='o'>);</span>
    <span class='o'>});</span>
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>BOX</span><span class='o'>);</span>
      <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
    <span class='o'>});</span>
    
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>LINE</span><span class='o'>);</span>
    <span class='o'>});</span>
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>LINE</span><span class='o'>);</span>
      <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>});</span>
    
    <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='n'>_selectToolDblClicked</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The onTool method is also called in the selectToolOn method of the ToolBar class.</p>

<p><strong>Code 05-06.27</strong>: The select tool becomes active.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>selectToolOn</span><span class='o'>()</span>  <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_selectToolDblClicked</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the right section of the page there is a new paragraph with two Web links.</p>

<p><strong>Code 05-06.28</strong>: The two Web links.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section</span> <span class='na'>id=</span><span class='s'>&quot;right&quot;</span><span class='nt'>&gt;</span> 
      <span class='nt'>&lt;header&gt;</span>
        <span class='nt'>&lt;h3&gt;</span>Creating and Moving Boxes and Lines<span class='nt'>&lt;/h3&gt;</span>
      <span class='nt'>&lt;/header&gt;</span>
        …
      <span class='nt'>&lt;p&gt;</span>
        The 
        <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;https://github.com/dzenanr/MagicBoxes&quot;</span><span class='nt'>&gt;</span>
          code
        <span class='nt'>&lt;/a&gt;</span> 
        is kept at 
        <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;https://github.com/&quot;</span><span class='nt'>&gt;</span>
          GitHub
        <span class='nt'>&lt;/a&gt;</span>.
      <span class='nt'>&lt;/p&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The two links are styled with link selectors in the link.css file. A Web link may have four different states: unvisited, visited, active and hoover. These four links states are controlled by pseudo classes of CSS, which are used to add special effects to some selectors.</p>

<p><strong>Code 05-06.29</strong>: The Web link CSS selectors.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>a</span><span class='nd'>:link</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#003366</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>a</span><span class='nd'>:visited</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#c50000</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>a</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ffffee</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#336799</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>a</span><span class='nd'>:active</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ff9911</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>The mb.html file uses a new style in the list.css file.</p>

<p><strong>Code 05-06.30</strong>: The list style CSS link.</p>
<div class='highlight'><pre><code class='html'>  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>charset=</span><span class='s'>&quot;utf-8&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>name=</span><span class='s'>&quot;author&quot;</span> <span class='na'>content=</span><span class='s'>&quot;Dzenan Ridjanovic&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/layout.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/layout2c.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/link.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/list.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/menu.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/page.css&quot;</span><span class='nt'>/&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
</code></pre>
</div>
<p>The Web links use the link class to provide additional style.</p>

<p><strong>Code 05-06.31</strong>: The link class.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;p&gt;</span>
        The 
        <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;https://github.com/dzenanr/MagicBoxes&quot;</span> <span class='na'>class=</span><span class='s'>&quot;link&quot;</span><span class='nt'>&gt;</span>
          code
        <span class='nt'>&lt;/a&gt;</span> 
        is kept at 
        <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;https://github.com/&quot;</span> <span class='na'>class=</span><span class='s'>&quot;link&quot;</span><span class='nt'>&gt;</span>
          GitHub
        <span class='nt'>&lt;/a&gt;</span>.
      <span class='nt'>&lt;/p&gt;</span>
</code></pre>
</div>
<p>The link class is defined in the list.css file.</p>

<p><strong>Code 05-06.32</strong>: The unordered list (ul) style.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>list-style</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>2px</span><span class='p'>;</span>
    <span class='k'>text-align</span><span class='o'>:</span> <span class='k'>left</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>padding-top</span><span class='o'>:</span> <span class='m'>1px</span><span class='p'>;</span>
    <span class='k'>padding-bottom</span><span class='o'>:</span> <span class='m'>1px</span><span class='p'>;</span>
    <span class='k'>padding-left</span><span class='o'>:</span> <span class='m'>18px</span><span class='p'>;</span>
  <span class='p'>}</span>	
    
  <span class='nc'>.link</span> <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='sx'>url(img/arrow-right.gif)</span> <span class='k'>no-repeat</span> <span class='m'>0</span> <span class='m'>50</span><span class='o'>%</span><span class='p'>;</span>
    <span class='k'>padding-top</span><span class='o'>:</span> <span class='m'>1px</span><span class='p'>;</span>
    <span class='k'>padding-bottom</span><span class='o'>:</span> <span class='m'>1px</span><span class='p'>;</span>
    <span class='k'>padding-left</span><span class='o'>:</span> <span class='m'>18px</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>Since the two Web links used in the HTML page are not put within the unordered list, this new style does not have any effect. In addition, the arrow-right.gif image cannot be found within the img folder. This is an example of what should not have been included in the current spiral. The spiral approach does not hide mistakes made. They may be corrected in one of future spirals.</p>
        <em>Posted on 15 February 2012</em>
    
        <h2><a href="/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 04, each box has a title with the sequential number and (x, y) coordinates, and the same four items. In Spiral 05, boxes have the same appearance, but there is a tool bar that provides a new way of creating, selecting and moving boxes.</p>

<p>First changes are small but many, in order to standardize the code.</p>

<p>An HTML document loaded into a Web browser becomes a document object. The document object provides access to all HTML elements in the page. The document object is a part of the window object and can also be reached through the window.document property.</p>

<p>The query method of the document object is used to find the canvas element within the document and attach events directly to the canvas object.</p>

<p><strong>Code 04-05.01</strong>: Canvas events in the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='c1'>// Canvas event</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>).</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseDown</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseDown</span><span class='o'>);</span>
    <span class='c1'>// Redraw every INTERVAL ms.</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>window</span><span class='o'>.</span><span class='na'>setInterval</span><span class='o'>(</span><span class='n'>redraw</span><span class='o'>,</span> <span class='n'>INTERVAL</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A click (a mouse down event in the Board class) outside the canvas (or the board) on the Web page does not cause any events.</p>

<p><strong>Code 04-05.02</strong>: Canvas events in the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='c1'>// Box events (actually, canvas events).</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>).</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseDown</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseDown</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>).</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseUp</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseUp</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>).</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseMove</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseMove</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Box class has now two constants that determine the box size.</p>

<p><strong>Code 04-05.03</strong>: Box size constants.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>DEFAULT_WIDTH</span> <span class='o'>=</span> <span class='mi'>100</span><span class='o'>;</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>DEFAULT_HEIGHT</span> <span class='o'>=</span> <span class='mi'>100</span><span class='o'>;</span>
</code></pre>
</div>
<p>The constants are used in the onMouseDown method of the Board class.</p>

<p><strong>Code 04-05.04</strong>: Changes in the onMouseDown method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Create a box in the position of the mouse click on the board, </span>
  <span class='c1'>// but not on an existing box.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>bool</span> <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> 
        <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A new box creation is moved to the if statement that allows for the construction of a box only if a mouse down event happens on an empty space of the board. The name of the clickedOnExistingBox is shortened to clickedOnBox without the loss of any signification. The name of the event parameter becomes e, to make the length of arguments in the Box constructor more reasonable. The if statements use now the curly brackets even if there is only one statement in their bodies. This will avoid potential problems in future when if bodies become more complex and the use of curly brackets become oversight.</p>

<p><strong>Code 04-05.05</strong>: if () {}.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='nf'>countSelectedBoxesContain</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>pointX</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>pointY</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>pointX</span><span class='o'>,</span> <span class='n'>pointY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The name of the countSelectedBoxesThatContain method is shorter for the “That” word.</p>

<p>The boolean attributes in the Box class are initialized to <strong>false</strong> to be, for comprehension purposes, explicit with initial values of attributes.</p>

<p><strong>Code 04-05.06</strong>: Explicit initialization.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
  <span class='n'>bool</span> <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
</code></pre>
</div>
<p>Several methods in the Box class are updated to follow decisions made in this spiral.</p>

<p><strong>Code 04-05.07</strong>: New forms of methods in the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>contains</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>pointX</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>pointY</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>pointX</span> <span class='o'>&gt;</span> <span class='n'>x</span> <span class='o'>&amp;&amp;</span> <span class='n'>pointX</span> <span class='o'>&lt;</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>)</span> 
        <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>pointY</span> <span class='o'>&gt;</span> <span class='n'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>pointY</span> <span class='o'>&lt;</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>else</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>toggleSelection</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>onMouseUp</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> <span class='n'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>_mouseDown</span> <span class='o'>&amp;&amp;</span> 
        <span class='n'>board</span><span class='o'>.</span><span class='na'>countSelectedBoxesContain</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>)</span> <span class='o'>&lt;</span> <span class='mi'>2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span>  <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>With a tool bar, which provides a new way to create and select boxes, MagicBoxes start to look as a tool (Figure 04-05.01).</p>

<p><img src='/img/s04s05/ToolBarWithoutCSS.png' alt='Alt Figure 04-05.01: Simple tool bar' /></p>

<p><strong>Figure 04-05.01</strong>: Simple tool bar.</p>

<p>A tool bar has two buttons, an arrow button for selection and a box button for creation. The selection button is on by default. Thus, in order to create a box, the creation button must be clicked on first. By clicking on an empty space of the board, a new box appears in that position, and the selection tool is on again. In order to create several boxes, the box tool must be double-clicked to stay active. To return to the select mode, the arrow button must be double-clicked.</p>

<p>There is a new class to represent the tool bar concept. The class is appropriately named ToolBar.</p>

<p><strong>Code 04-05.08</strong>: The ToolBar class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>SELECT</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>BOX</span> <span class='o'>=</span> <span class='mi'>2</span><span class='o'>;</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='kt'>int</span> <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_boxToolDblClicked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='err'>…</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The ToolBar class has two constants to represent two different states: SELECT and BOX. The class has a parent attribute to provide the reference to the context where the tool bar is created, which is the board. There are also two private attributes to indicate which tool is currently on and if the box tool is double-clicked.</p>

<p>In the constructor of the ToolBar class, the parent argument is accepted by the board parameter, which is immediately assigned to the board attribute of the class.</p>

<p><strong>Code 04-05.09</strong>: The constructor of the ToolBar class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>ButtonElement</span> <span class='n'>selectButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>ButtonElement</span> <span class='n'>boxButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>box</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Tool bar events.</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
      <span class='n'>_boxToolDblClicked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>BOX</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>BOX</span><span class='o'>;</span>
      <span class='n'>_boxToolDblClicked</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Two buttons of the ButtonElement type are obtained by the query method on the document object. The two buttons are identified by their ids that come from the mb.html file (Code 04-05.10). The two png images are located in the img folder of the mb project.</p>

<p>Each button will listen for the click and double-click (dblClick) events. In the case of the click event, the _onTool attribute of the class accepts the corresponding state constant. When the double-click event happens, the _onTool attribute accepts the corresponding state constant and the _boxToolDblClicked attributes becomes <strong>true</strong> for the BOX state and <strong>false</strong> for the SELECT state.</p>

<p><strong>Code 04-05.10</strong>: Two button elements in the mb.html file.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;800&quot;</span> <span class='na'>height=</span><span class='s'>&quot;600&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/select.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;box&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/box.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>Up to now, reactions of events have been defined in methods with appropriate names. For example, a click on the canvas of the board is handled in the onMouseDown method of the Board class. In the ToolBar class, events are registered and responses to them are defined at the same time in methods without names.</p>

<p><strong>Code 04-05.11</strong>: A method without a name but with the parameter and the statement body.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The toolbar attribute of the Board class is created in the constructor of the Board class.</p>

<p><strong>Code 04-05.12</strong>: Tool bar creation.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span> <span class='n'>toolBar</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>toolBar</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the on mouse down event of the Board class, several methods of the ToolBar class are used on the toolBar attribute.</p>

<p><strong>Code 04-05.13</strong>: Box selection and creation on the board.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>bool</span> <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>deselectBoxes</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isBoxToolOn</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>selectToolOn</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span> 
  <span class='o'>}</span>
</code></pre>
</div>
<p>If the selection tool is on, a box cannot be created. However, a box can be selected by clicking on it (or deselected if it is already selected). If there are selected boxes (one or more), all selected boxes are deselected by clicking on an empty space of the board. This is done by the deselectBoxes method of the Board class (Code 04-05.14).</p>

<p>If the box tool is on, a new box is created by clicking on an empty space of the board. After the box creation, the select(ion) tool is activated. If the box tool is on and a box is clicked on, test what happens and comment if that is desirable behavior.</p>

<p>Double-click on a tool bar tool keeps the tool on.</p>

<p><strong>Code 04-05.14</strong>: Deselecting boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deselectBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box</span><span class='o'>.</span><span class='na'>deselect</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The methods of the ToolBar class that start with is return a boolean value. They check what tool is on and return <strong>true</strong> if that tool is active. The selectToolOn method activates the select tool, but only if the box tool has not been double-clicked.</p>

<p><strong>Code 04-05.15</strong>: Tool bar methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>isSelectToolOn</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>SELECT</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span> 
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='n'>bool</span> <span class='nf'>isBoxToolOn</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_onTool</span> <span class='o'>==</span> <span class='n'>BOX</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span> 
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>selectToolOn</span><span class='o'>()</span>  <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>_boxToolDblClicked</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>_onTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>There are three methods in the Board class that are not used in this spiral. All three methods handle a collection of boxes. Many boxes may be created, selected and deleted by these methods. Find a way to use (test) them.</p>

<p><strong>Code 04-05.16</strong>: Unused methods of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxes</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>n</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='kt'>int</span> <span class='n'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='n'>i</span> <span class='o'>&lt;</span> <span class='n'>n</span><span class='o'>;</span> <span class='n'>i</span><span class='o'>++)</span> <span class='o'>{</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
        <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>));</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>boxes</span><span class='o'>.</span><span class='na'>clear</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>selectBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Several constants in the Box class have now an explicit type.</p>

<p><strong>Code 04-05.17</strong>: Explicit int type of constants.</p>
<div class='highlight'><pre><code class='java'>  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>SSS</span> <span class='o'>=</span> <span class='mi'>6</span><span class='o'>;</span> <span class='c1'>// selection square size</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>TBH</span> <span class='o'>=</span> <span class='mi'>20</span><span class='o'>;</span> <span class='c1'>// title box height</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>TOS</span> <span class='o'>=</span> <span class='mi'>4</span><span class='o'>;</span> <span class='c1'>// text offset size</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>IOS</span> <span class='o'>=</span> <span class='n'>TBH</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>;</span> <span class='c1'>// item offset size</span>
</code></pre>
</div>
<p>Note that there is a slight difference between the code in the draw method of the Box class of the MagicBoxes project and the mb project. However, this difference is not reflected in the Web application.</p>

<p><strong>Code 04-05.18</strong>: A slight difference in code.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='err'>…</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='err'>…</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>If the button elements of the tool bar are positioned after the script element, boxes cannot be created. This is reported by Chris Buckett as a bug in Dart. Just to be on the safe side, keep the script element closer to the end of the html code.</p>

<p><strong>Code 04-05.19</strong>: Boxes cannot be created.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;800&quot;</span> <span class='na'>height=</span><span class='s'>&quot;600&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/select.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;box&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/box.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The last changes in this spiral are related to the Web page presentation defined by Cascading Styles Sheets (Figure 04-05.02). While HTML provides the content, the CSS defines the presentation style of that content.</p>

<p><img src='/img/s04s05/ToolBarWithCSS.png' alt='Alt Figure 04-05.02: CSS presentation of the page' /></p>

<p><strong>Figure 04-05.02</strong>: CSS presentation of the page.</p>

<p>The mb.html file has links to CSS definitions in different files that are located in the css sub-folder of the project.</p>

<p><strong>Code 04-05.20</strong>: CSS links.</p>
<div class='highlight'><pre><code class='html'>  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>charset=</span><span class='s'>&quot;utf-8&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>name=</span><span class='s'>&quot;author&quot;</span> <span class='na'>content=</span><span class='s'>&quot;Dzenan Ridjanovic&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/layout.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/layout2c.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/link.css&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;link</span> <span class='na'>rel=</span><span class='s'>&quot;stylesheet&quot;</span> <span class='na'>href=</span><span class='s'>&quot;css/page.css&quot;</span><span class='nt'>/&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
</code></pre>
</div>
<p>There are 2 sections in the page: the main section with the board and tool bar (Code 04-05.21), and the right section with text only (Code 04-05.22). The canvas size is reduced from 800x600 to 630x580 pixels to accommodate the new section to the right of the main section.</p>

<p><strong>Code 04-05.21</strong>: The main section of the page.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section</span> <span class='na'>id=</span><span class='s'>&quot;main&quot;</span><span class='nt'>&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;630&quot;</span> <span class='na'>height=</span><span class='s'>&quot;580&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/select.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;box&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/box.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The page has a title, and the right section has a sub-title.</p>

<p><strong>Code 04-05.22</strong>: The right section of the page.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section</span> <span class='na'>id=</span><span class='s'>&quot;right&quot;</span><span class='nt'>&gt;</span> 
      <span class='nt'>&lt;header&gt;</span>
        <span class='nt'>&lt;h3&gt;</span>Creating and Moving Boxes<span class='nt'>&lt;/h3&gt;</span>
      <span class='nt'>&lt;/header&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        Click the box tool (button), in the tool bar, each time you  
        want to create a box, by clicking on an empty space in the 
        board.
      <span class='nt'>&lt;/p&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        To move a non selected box, click the box and keep the mouse 
        down while moving it. 
        A selected box cannot be moved.
      <span class='nt'>&lt;/p&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        Click the box to select it. Click again to deselect it. 
        If there are several selected boxes, you may deselect them all 
        by clicking on an empty space in the board.
      <span class='nt'>&lt;/p&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        If you want to create several boxes, double-click the box tool 
        to stay on. 
        To return to the select mode double-click the select tool.
      <span class='nt'>&lt;/p&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The basic layout of the page is defined in the layout.css file (Code 04-05.23), while the layout with two columns is detailed in the layout2c.css file (Code 04-05.24).</p>

<p>While HTML has elements with opening and closing tags, CSS has selectors with properties in curly brackets. A property has a value that is separated from its name by two columns. The property value is ended by a semi-column.</p>

<p>CSS selectors that are named as HTML elements, provide property definitions of those elements. Thus, the presentation of a header element used in the page is defined by property values of the header selector in the style sheet. The names of CSS properties are almost self-explanatory; for details see <a href='http://dochub.io/#css/'>dochub/CSS</a>. The CSS definitions used in the MagicBoxes project are influenced by <a href='http://simplebits.com/'>SimpleBits</a>. The comments used before and after CSS selectors should be self-evident.</p>

<p><strong>Code 04-05.23</strong>: The basic layout of the page.</p>
<div class='highlight'><pre><code class='css'><span class='c'>/* layout.css */</span>

<span class='c'>/* ===[ begin ]=== */</span>

<span class='c'>/*</span>
<span class='c'>  Title:                   Basic Layout Design Style</span>
<span class='c'>  Author:                  Dzenan Ridjanovic</span>
<span class='c'>  Influenced By:           http://www.simplebits.com/</span>
<span class='c'>  Created:                 2006-09-03</span>
<span class='c'>  Updated:                 2011-12-08</span>
<span class='c'>*/</span>

  <span class='nt'>header</span> <span class='p'>{</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#708491</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>6px</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#d7e9f7</span><span class='p'>;</span>
    <span class='k'>text-align</span><span class='o'>:</span> <span class='k'>center</span><span class='p'>;</span>
  <span class='p'>}</span>
    	
  <span class='nt'>footer</span> <span class='p'>{</span>
    <span class='k'>clear</span><span class='o'>:</span> <span class='k'>both</span><span class='p'>;</span>
    <span class='k'>font-family</span><span class='o'>:</span> <span class='n'>arial</span><span class='o'>,</span> <span class='k'>sans-serif</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>12px</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#fffff0</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#4b91d1</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>10px</span><span class='p'>;</span>
    <span class='k'>border-top</span><span class='o'>:</span> <span class='m'>2px</span> <span class='k'>solid</span> <span class='m'>#999999</span><span class='p'>;</span>
  <span class='p'>}</span>
    		
<span class='c'>/* ===[ end ]=== */</span>
</code></pre>
</div>
<p>User defined and named selectors that start with the hash character are called identifiers (id selectors). They are referred in HTML elements by id attributes.</p>

<p><strong>Code 04-05.24</strong>: The 2 column layout of the page.</p>
<div class='highlight'><pre><code class='css'>  <span class='nf'>#main</span> <span class='p'>{</span>
    <span class='k'>float</span><span class='o'>:</span> <span class='k'>left</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>70</span><span class='o'>%</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>The main selector is used in the web page as the id attribute of the first section.</p>

<p><strong>Code 04-05.25</strong>: The main section.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section</span> <span class='na'>id=</span><span class='s'>&quot;main&quot;</span><span class='nt'>&gt;</span> 
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The float property of the main selector positions the first section on the left of the page, while the width property reserves the 70% of the page. The next section that has the id attribute with the right value flows to the right of the first section. However, there is no right selector in the css files of this spiral, because there was no need to be more precise with the presentation style of the right section. As a consequence, the second section is displayed in the same way even without the id attribute.</p>

<p>CSS selectors from the link.css file are not used currently, because there is no a tag in the page.</p>

<p>How the page body, sections and paragraphs are presented is defined in the page.css file.</p>

<p><strong>Code 04-05.26</strong>: The basic page element selectors.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>body</span> <span class='p'>{</span>
    <span class='k'>font-family</span><span class='o'>:</span> <span class='n'>verdana</span><span class='o'>,</span> <span class='n'>arial</span><span class='o'>,</span> <span class='n'>helvetica</span><span class='o'>,</span> <span class='k'>sans-serif</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>14px</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#d7e9f7</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span><span class='m'>900px</span><span class='p'>;</span>
    <span class='k'>margin-left</span><span class='o'>:</span> <span class='m'>100px</span><span class='p'>;</span>
    <span class='k'>margin-right</span><span class='o'>:</span> <span class='m'>100px</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span><span class='m'>10px</span><span class='p'>;</span> 
  <span class='p'>}</span>

  <span class='nt'>section</span> <span class='p'>{</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>4px</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>p</span> <span class='p'>{</span>
    <span class='k'>line-height</span><span class='o'>:</span> <span class='m'>1.5em</span><span class='p'>;</span>
    <span class='k'>text-align</span><span class='o'>:</span> <span class='k'>justify</span><span class='p'>;</span>
    <span class='k'>margin-left</span><span class='o'>:</span> <span class='m'>2px</span><span class='p'>;</span>
    <span class='k'>margin-right</span><span class='o'>:</span> <span class='m'>2px</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
        <em>Posted on 10 February 2012</em>
    
</section>

<section>
    <header>
        <h2>All Posts</h2>
        <!-- -->
    </header>  
    
        <h2><a href="/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a></h2>
        <em>Posted on 21 February 2012</em>
    
        <h2><a href="/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a></h2>
        <em>Posted on 15 February 2012</em>
    
        <h2><a href="/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a></h2>
        <em>Posted on 10 February 2012</em>
    
        <h2><a href="/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a></h2>
        <em>Posted on 07 February 2012</em>
    
        <h2><a href="/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a></h2>
        <em>Posted on 02 February 2012</em>
    
        <h2><a href="/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a></h2>
        <em>Posted on 31 January 2012</em>
    
        <h2><a href="/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a></h2>
        <em>Posted on 23 January 2012</em>
    
        <h2><a href="/2012/01/14/first-post.html">First Post</a></h2>
        <em>Posted on 14 January 2012</em>
    
</section>

        </section>

        <section>
     
        </section>

        <footer>
          <a href="http://dzenanr.github.com/ondart.rss">
            <img src="/img/xml.gif" width=36 height=14 alt="RSS feed for this site" border=0>
          </a>
        </footer>

    </body>
</html>


