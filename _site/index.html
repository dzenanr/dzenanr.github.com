<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="Dzenan Ridjanovic"/>
        <title>On Dart</title> 
        <link rel="stylesheet" href="/css/code.css"/>  
        <link rel="stylesheet" href="/css/layout.css"/>
        <link rel="stylesheet" href="/css/link.css"/>
        <link rel="stylesheet" href="/css/list.css"/>
        <link rel="stylesheet" href="/css/menu.css"/>
        <link rel="stylesheet" href="/css/page.css"/>
    </head>

    <body>
        <header>  
            <h1>
                <a href="http://www.ondart.info/"><img src="/img/ondartb1.png"/></a>
               On Dart
               <!--  -->
            </h1>
        </header>

        <nav>
            <ul>
                <li>Dart
                    <ul>
                        <li>
                            <a href="http://www.dartlang.org/">Dart</a>
                        </li>
                        <li>
                            <a href="http://try.dartlang.org/">Dart Console</a>
                        </li>
                    </ul>  
                </li>
                <li>Magic Boxes
                    <ul>
                        <li>
                            <a href="http://goo.gl/I72z1">Browse Code</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Design Model</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes">Get Git</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes/tags">Get Spirals</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s00/MagicBoxes/MagicBoxes.html">Spiral 00</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s01/MagicBoxes/MagicBoxes.html">Spiral 01</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s02/MagicBoxes/MagicBoxes.html">Spiral 02</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s03/MagicBoxes/MagicBoxes.html">Spiral 03</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s04/MagicBoxes/MagicBoxes.html">Spiral 04</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s05/MagicBoxes/MagicBoxes.html">Spiral 05</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s06/MagicBoxes/MagicBoxes.html">Spiral 06</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s07/MagicBoxes/MagicBoxes.html">Spiral 07</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s08/MagicBoxes/MagicBoxes.html">Spiral 08</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s09/MagicBoxes/MagicBoxes.html">Spiral 09</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s10/MagicBoxes/MagicBoxes.html">Spiral 10</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Spiral 11</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s12/MagicBoxes/MagicBoxes.html">Spiral 12</a> 
                        </li>
                    </ul>  
                </li>
                <li>On Dart
                    <ul>
                        <li>
                            <a href="https://plus.google.com/u/0/b/113649577593294551754/113649577593294551754/posts">Google+ Page</a> 
                        </li>
                    </ul>  
                </li>
                <li>Posts
                    <ul>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/24/from-s07-to-s08.html">From Spiral07 To Spiral08</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/29/from-s08-to-s09.html">From Spiral08 To Spiral09</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/03/10/from-s09-to-s10.html">From Spiral09 To Spiral10</a> 
                        </li>
                        <li>
                            &nbsp; 
                        </li>
                    </ul>  
                </li>
                <li>About
                    <ul>
                        <li>
                            <a href="http://goo.gl/f1F2e">D. R. (CV in PDF)</a> 
                        </li>
                    </ul>  
                </li>
            </ul>
        </nav>

        <section>
            <section>
    
        <h2><a href="/2012/03/10/from-s09-to-s10.html">From Spiral09 To Spiral10</a></h2>
        <h2 id='code'>Code</h2>

<p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>The use of the script element in the MagicBoxes.html file has changed from</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
</code></pre>
</div>
<p>to</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;application/dart&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
<span class='nt'>&lt;script</span>
<span class='nt'>  </span><span class='na'>src=</span><span class='s'>&quot;http://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/script&gt;</span>
</code></pre>
</div>
<p>This change requires the Internet access when you run code in the Dart Editor.</p>

<p>If you use Spirals 00 … 11 locally, checkout branches s00a … s11a, where changes have been made.</p>

<h2 id='overview'>Overview</h2>

<p>In Spiral 09, line min..max cardinalities may be changed by getting the selected line with a click on the Get button in the tool bar, making changes and setting them with a click on the Set button. Line direction names may be added. A line direction with 1..1 cardinalities may become a part of the identifier of the source concept.</p>

<p>In Spiral 10, a relationship created between two concepts, may be changed to inheritance or is-a relationship, first by selecting the relationship line, second by getting information about the relationship in the tool bar, third by choosing the inheritance category in the pop-up list. Similarly, the obtained relationship may be categorized as reflexive or twin. A reflexive relationship will connect the parent concept to itself. Two relationships between the same two concepts will split apart when becoming twins.</p>

<p>A meta-model of domain models is shown in Figure 09-10.01. The Domain concept has a reflexive relationship, which is used to represent a tree of domains and sub-domains. A domain may have several models. A model contains concepts. A concept has properties. A property is either an attribute or a neighbor. There are two inheritance relationships, one between the Attribute and Property concepts, the other between the Neighbor and Property concepts. An attribute may have a type, which belongs to a domain. A concept may be a source of several relationship directions towards destination (neighbor) concepts. A concept may be also a destination to several relationship directions. This is represented as two twin relationships between the Concept and Neighbor concepts.</p>

<p><img src='/img/s09s10/MetaModel.png' alt='Alt Figure 09-10.01: Meta-model of domain models' /></p>

<p><strong>Figure 09-10.01</strong>: Meta-model of domain models.</p>

<p>The meta-model has also concepts that are modelling tool oriented. Thus, a concept is represented as a box, an attribute as an item, and a neighbor as a line. A model with its concepts and properties is related to a board.</p>

<h2 id='steps'>Steps</h2>

<p>The Board class has two new constants that determine the minimal size of the diagram.</p>

<p><strong>Code 09-10.01</strong>: Board size constants.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>MIN_WIDTH</span> <span class='o'>=</span> <span class='mi'>990</span><span class='o'>;</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>MIN_HEIGHT</span> <span class='o'>=</span> <span class='mi'>580</span><span class='o'>;</span>
</code></pre>
</div>
<p>There are two private attributes that contain the actual width and height of the diagram.</p>

<p><strong>Code 09-10.02</strong>: Board size private attributes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='n'>_width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>_height</span><span class='o'>;</span>
</code></pre>
</div>
<p>The two private attributes are initialized in the constructor of the Board class.</p>

<p><strong>Code 09-10.03</strong>: Initialization of the private attributes.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Board</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>_width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>_height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
</code></pre>
</div>
<p>The width and height properties are defined on the two private attributes.</p>

<p><strong>Code 09-10.04</strong>: Board size properties.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='n'>set</span> <span class='nf'>width</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_width</span> <span class='o'>=</span> <span class='n'>width</span><span class='o'>;</span>
    <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>int</span> <span class='n'>get</span> <span class='nf'>width</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='n'>_width</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='n'>set</span> <span class='nf'>height</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_height</span> <span class='o'>=</span> <span class='n'>height</span><span class='o'>;</span>
    <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>height</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>int</span> <span class='n'>get</span> <span class='nf'>height</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='n'>_height</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The canvas element of HTML5 is placed with the div element that has the scrollpane id.</p>

<p><strong>Code 09-10.05</strong>: The scrollpane div element.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;div</span> <span class='na'>id=</span><span class='s'>&quot;scrollpane&quot;</span><span class='nt'>&gt;</span>
        <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;990&quot;</span> <span class='na'>height=</span><span class='s'>&quot;580&quot;</span><span class='nt'>&gt;</span>
          Canvas is not supported in your browser.
        <span class='nt'>&lt;/canvas&gt;</span>  
      <span class='nt'>&lt;/div&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        …
      <span class='nt'>&lt;/footer&gt;</span>
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The scrollpane selector is defined in the layout.css file of the project. This definition provides scrolling capabilities for the contained canvas ().</p>

<p><strong>Code 09-10.06</strong>: The scrollpane CSS selector.</p>
<div class='highlight'><pre><code class='css'>  <span class='nf'>#scrollpane</span> <span class='p'>{</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>990px</span><span class='p'>;</span>
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>580px</span><span class='p'>;</span>
    <span class='k'>overflow</span><span class='o'>:</span> <span class='k'>auto</span><span class='p'>;</span>
    <span class='k'>border</span><span class='o'>:</span> <span class='k'>solid</span> <span class='m'>1px</span> <span class='nb'>white</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='nb'>white</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p><img src='/img/s09s10/BoardSize.png' alt='Alt Figure 09-10.02: Scrolling' /></p>

<p><strong>Figure 09-10.02</strong>: Scrolling.</p>

<p>The menu bar has rearranged menus. The Edit menu offers a deletion of a selection, while the Select menu has different menu items, each providing a different selection. There are two new selections. For selected boxes, all lines that are connected to them may be selected (Figure 09-10.03). For selected boxes, only lines that connect them may be selected (Figure 09-10.04).</p>

<p><strong>Code 09-10.07</strong>: Menu bar.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='c1'>// File</span>
  <span class='n'>ButtonElement</span> <span class='n'>saveAsPngButton</span><span class='o'>;</span>
  
  <span class='c1'>// Edit</span>
  <span class='n'>ButtonElement</span> <span class='n'>deleteSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// Select</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectAllButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectBoxesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectLinesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectBoxLinesButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectLinesBetweenBoxesButton</span><span class='o'>;</span>
  
  <span class='c1'>// View</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionHeightButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionHeightButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionWidthButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionWidthButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionSizeButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionSizeButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>hideSelectionButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>showHiddenSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// Create</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesInDiagonalButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesAsTilesButton</span><span class='o'>;</span>
</code></pre>
</div>
<p><img src='/img/s09s10/BoxLines.png' alt='Alt Figure 09-10.03: Selected lines of selected boxes' /></p>

<p><strong>Figure 09-10.03</strong>: Selected lines of selected boxes.</p>

<p><img src='/img/s09s10/LinesBetweenBoxes.png' alt='Alt Figure 09-10.04: Selected lines between selected boxes' /></p>

<p><strong>Figure 09-10.04</strong>: Selected lines between selected boxes.</p>

<p>The constructor of the MenuBar class starts with finding HTML elements and assigning them to menu item buttons.</p>

<p><strong>Code 09-10.08</strong>: Menu bar constructor.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>saveAsPngButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>save</span><span class='o'>-</span><span class='n'>as</span><span class='o'>-</span><span class='n'>png</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>deleteSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>delete</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>selectAllButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>all</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>selectBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>selectLinesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>lines</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>selectBoxLinesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>box</span><span class='o'>-</span><span class='n'>lines</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>selectLinesBetweenBoxesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>lines</span><span class='o'>-</span><span class='n'>between</span><span class='o'>-</span><span class='n'>boxes</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>increaseSelectionHeightButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>height</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionHeightButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>height</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>increaseSelectionWidthButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>width</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionWidthButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>width</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>increaseSelectionSizeButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>size</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionSizeButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>size</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>hideSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>hide</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>showHiddenSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>show</span><span class='o'>-</span><span class='n'>hidden</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>createBoxesInDiagonalButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>in</span><span class='o'>-</span><span class='n'>diagonal</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>createBoxesAsTilesButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>as</span><span class='o'>-</span><span class='n'>tiles</span><span class='err'>&#39;</span><span class='o'>);</span>
</code></pre>
</div>
<p>In the constructor of the MenuBar class, click events on menu item buttons are defined.</p>

<p><strong>Code 09-10.09</strong>: Menu bar events.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>saveAsPngButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>saveAsPng</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>deleteSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>deleteSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>selectAllButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>selectBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>selectBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>selectLinesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>selectLines</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>selectBoxLinesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>selectBoxLines</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>selectLinesBetweenBoxesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>selectLinesBetweenBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>increaseSelectionHeightButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseHeightOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionHeightButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseHeightOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>increaseSelectionWidthButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseWidthOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionWidthButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseWidthOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>increaseSelectionSizeButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseSizeOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionSizeButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseSizeOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>hideSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>hideSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>showHiddenSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>showHiddenSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>createBoxesInDiagonalButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesInDiagonal</span><span class='o'>();</span>
      <span class='c1'>//board.printBoxNames();</span>
    <span class='o'>});</span>
    <span class='n'>createBoxesAsTilesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesAsTiles</span><span class='o'>();</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>In the Board class, lines of the selected boxes are selected by verifying if a line in a list of lines is connected to the selected box.</p>

<p><strong>Code 09-10.10</strong>: Selecting lines of the selected boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>selectBoxLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span> <span class='o'>==</span> <span class='n'>box</span> <span class='o'>||</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span> <span class='o'>==</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
            <span class='n'>line</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
          <span class='o'>}</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>If two boxes of a line are selected, the line is selected as well.</p>

<p><strong>Code 09-10.11</strong>: Selecting lines between the selected boxes.</p>
<div class='highlight'><pre><code class='java'><span class='kt'>void</span> <span class='nf'>selectLinesBetweenBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The nav (navigator) section of HTML5 contains menus and menu items.</p>

<p><strong>Code 09-10.12</strong>: Menus and menu items in HTML.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;nav&gt;</span>
     <span class='nt'>&lt;ul&gt;</span>
       <span class='nt'>&lt;li&gt;</span>File
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;save-as-png&quot;</span><span class='nt'>&gt;</span>As .png<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>  
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Edit
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;delete-selection&quot;</span><span class='nt'>&gt;</span>Delete<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Select
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-all&quot;</span><span class='nt'>&gt;</span>All<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-boxes&quot;</span><span class='nt'>&gt;</span>Boxes<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-lines&quot;</span><span class='nt'>&gt;</span>Lines<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-box-lines&quot;</span><span class='nt'>&gt;</span>Box lines<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-lines-between-boxes&quot;</span><span class='nt'>&gt;</span>Between boxes<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>View
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-height&quot;</span><span class='nt'>&gt;</span>+ Height<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-height&quot;</span><span class='nt'>&gt;</span>- Height<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-width&quot;</span><span class='nt'>&gt;</span>+ Width<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-width&quot;</span><span class='nt'>&gt;</span>-Width<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-size&quot;</span><span class='nt'>&gt;</span>+ Size<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-size&quot;</span><span class='nt'>&gt;</span>- Size<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;hide-selection&quot;</span><span class='nt'>&gt;</span>Hide<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;show-hidden-selection&quot;</span><span class='nt'>&gt;</span>Show<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Create
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-in-diagonal&quot;</span><span class='nt'>&gt;</span>Diagonal<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-as-tiles&quot;</span><span class='nt'>&gt;</span>Tiles<span class='nt'>&lt;/button&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>About 
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Magic Boxes in <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;http://www.dart.org/&quot;</span><span class='nt'>&gt;</span>Dart<span class='nt'>&lt;/a&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Spiral 10<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>2012-01-04<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Dzenan Ridjanovic<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/ondart0.png&quot;</span><span class='nt'>/&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>   
       <span class='nt'>&lt;/li&gt;</span>
     <span class='nt'>&lt;/ul&gt;</span>
    <span class='nt'>&lt;/nav&gt;</span>
</code></pre>
</div>
<p>The ToolBar class has two input element that provide a change of the board size by a user.</p>

<p><strong>Code 09-10.13</strong>: Board size input elements.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>InputElement</span> <span class='n'>canvasWidthInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>canvasHeightInput</span><span class='o'>;</span>
</code></pre>
</div>
<p>The change of the board size is supported in the constructor of the ToolBar class. First, the input elements show the actual board size. Second, values entered by a user become the new board size.</p>

<p><strong>Code 09-10.14</strong>: Board size changes.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>canvasWidthInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvasWidth</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>canvasHeightInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvasHeight</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>canvasWidthInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>canvasWidthInput</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>input</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>Event</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>canvasWidthInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='n'>canvasHeightInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>canvasHeightInput</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>input</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>Event</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>canvasHeightInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span><span class='o'>;</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The footer section of the Web page contains the label and input elements for the board size.</p>

<p><strong>Code 09-10.15</strong>: Board size labels and inputs.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;label&gt;</span>Board<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;canvasWidth&quot;</span><span class='nt'>&gt;</span>width<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;number&quot;</span> <span class='na'>id=</span><span class='s'>&quot;canvasWidth&quot;</span> <span class='na'>min=</span><span class='s'>&quot;990&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;canvasHeight&quot;</span><span class='nt'>&gt;</span>height<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;number&quot;</span> <span class='na'>id=</span><span class='s'>&quot;canvasHeight&quot;</span> <span class='na'>min=</span><span class='s'>&quot;580&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;br/&gt;&lt;br/&gt;</span>
        …
      <span class='nt'>&lt;/footer&gt;</span>
</code></pre>
</div>
<p>There is a slight change in the menu.css file. The menu item width is updated from 180 to 200 pixels to accommodate two items on the same line.</p>

<p><strong>Code 09-10.16</strong>: Menu item width.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>nav</span> <span class='nt'>li</span><span class='nd'>:hover</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>block</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>200px</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>The tool bar has a new input element that displays a sequence number of a box item (Figure 09-10.05). This number may be edited by a user to change a position of the item within the box.</p>

<p><img src='/img/s09s10/ToolBar.png' alt='Alt Figure 09-10.05: Tool bar' /></p>

<p><strong>Figure 09-10.05</strong>: Tool bar.</p>

<p>The ToolBar class has a new attribute for the item sequence.</p>

<p><strong>Code 09-10.17</strong>: Item sequence input element.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>InputElement</span> <span class='n'>itemSequenceInput</span><span class='o'>;</span>
</code></pre>
</div>
<p>The item sequence element in the document is assigned to the input element attribute in the ToolBar constructor.</p>

<p><strong>Code 09-10.18</strong>: Obtaining the item sequence.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>itemSequenceInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>itemSequence</span><span class='err'>&#39;</span><span class='o'>);</span>
</code></pre>
</div>
<p>The item sequence element is defined in the footer section as a label and an input element with the itemSequence id.</p>

<p><strong>Code 09-10.19</strong>: Item sequence element.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;itemSequence&quot;</span><span class='nt'>&gt;</span>seq<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;number&quot;</span> <span class='na'>id=</span><span class='s'>&quot;itemSequence&quot;</span> <span class='na'>min=</span><span class='s'>&quot;1&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span> <span class='nt'>/&gt;</span>
</code></pre>
</div>
<p>In the constructor of the ToolBar class, for the last selected box, current item is set to <strong>null</strong> and the sequence number is initialized to 0.</p>

<p><strong>Code 09-10.20</strong>: Last selected box.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>focus</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>Event</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
        <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
        <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>attribute</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>When a new item is added, its sequence value becomes the value of the input element. The current item is not changed by adding a new item.</p>

<p><strong>Code 09-10.21</strong>: Add item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>addItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Item</span> <span class='n'>item</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Item</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>,</span> <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>sequence</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The Item class has the sequence attribute. The integer value of this attribute is calculated by finding a sequence number of the last item and adding 10 to it.</p>

<p><strong>Code 09-10.22</strong>: Item class with the sequence attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Item</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Box</span> <span class='n'>box</span><span class='o'>;</span>
  
  <span class='kt'>int</span> <span class='n'>sequence</span><span class='o'>;</span> <span class='c1'>// sequence number within the box: 1, 2, ...</span>
  <span class='n'>String</span> <span class='n'>name</span><span class='o'>;</span>
  <span class='n'>String</span> <span class='n'>category</span><span class='o'>;</span> <span class='c1'>// attribute, guid, identifier, required</span>
  
  <span class='n'>Item</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>box</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>category</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>sequence</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>findLastItemSequence</span><span class='o'>()</span> <span class='o'>+</span> <span class='mi'>10</span><span class='o'>;</span>
    <span class='n'>box</span><span class='o'>.</span><span class='na'>items</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>In the Box class, the last item is found and its sequence number is returned by the findLastItemSequence method.</p>

<p><strong>Code 09-10.23</strong>: Find the last item sequence number.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='nf'>findLastItemSequence</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>items</span><span class='o'>.</span><span class='na'>isEmpty</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>Item</span> <span class='n'>item</span> <span class='o'>=</span> <span class='n'>items</span><span class='o'>.</span><span class='na'>last</span><span class='o'>();</span>
      <span class='k'>return</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>sequence</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the constructor of the ToolBar class, for the last selected box, an item may be obtained by clicking on the Get button. The item name is used to find the item by the findItem method of the Box class. If the item is found by its name, the name is selected and the current item becomes the found item.</p>

<p><strong>Code 09-10.24</strong>: Get item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>getItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Item</span> <span class='n'>item</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>findItem</span><span class='o'>(</span><span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>;</span>
          <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>category</span><span class='o'>;</span>
          <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>sequence</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
          <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>When the item category is changed for the current item, the current item is updated. There is no need to use the Set button to make this change.</p>

<p><strong>Code 09-10.25</strong>: Current item change.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>change</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>=</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
        <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>=</span> <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
        <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The sequence number of the current item has not been changed!?</p>

<p>Another way to update the current item is to use the Set button in the tool bar.</p>

<p><strong>Code 09-10.26</strong>: Set item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>setItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>=</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>=</span> <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>sequence</span> <span class='o'>=</span> <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The current item may be removed by the Remove button.</p>

<p><strong>Code 09-10.27</strong>: Remove item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>removeItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>removeItem</span><span class='o'>(</span><span class='n'>currentItem</span><span class='o'>))</span> <span class='o'>{</span>
            <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
            <span class='n'>itemSequenceInput</span><span class='o'>.</span><span class='na'>valueAsNumber</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
            <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
            <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>attribute</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='o'>}</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>In the draw method of the Box class, the box items are sorted by their sequence numbers before they are displayed.</p>

<p><strong>Code 09-10.28</strong>: Sort items by the sequence number.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>sortItemsBySequence</span><span class='o'>();</span>
</code></pre>
</div>
<p>The sort method of the List type requires the use of a function that compares two elements of a list. The compare function is called for every two consecutive items. It takes two items as arguments and returns 0 if their sequence numbers are equal. It returns 1 if the sequence number of the first item is greater than the sequence number of the second item, while it returns -1 if the sequence number of the second item is greater than the sequence number of the first item.</p>

<p><strong>Code 09-10.29</strong>: Sort items by using the compare function.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>sortItemsBySequence</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>items</span><span class='o'>.</span><span class='na'>sort</span><span class='o'>(</span><span class='n'>compare</span><span class='o'>(</span><span class='n'>Item</span> <span class='n'>i1</span><span class='o'>,</span> <span class='n'>Item</span> <span class='n'>i2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>i1</span><span class='o'>.</span><span class='na'>sequence</span> <span class='o'>==</span> <span class='n'>i2</span><span class='o'>.</span><span class='na'>sequence</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='mi'>0</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>i1</span><span class='o'>.</span><span class='na'>sequence</span> <span class='o'>&gt;</span> <span class='n'>i2</span><span class='o'>.</span><span class='na'>sequence</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='o'>-</span><span class='mi'>1</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the Box class, the private name attribute is initialized to an empty space. Hence, a new box will not have a name.</p>

<p><strong>Code 09-10.30</strong>: No more Box as a default name.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>String</span> <span class='n'>_name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
</code></pre>
</div>
<p>The tool bar provides a pop-up list to determine a category of a relationship (Figure 09-10.05).</p>

<p>The TooolBar class has a new attribute of the OptionElement type, just before the Get and Set buttons for the last selected line.</p>

<p><strong>Code 09-10.31</strong>: Line option.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>OptionElement</span> <span class='n'>lineOption</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>getLineButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>setLineButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>The last selected line may appear in the tool bar by clicking on the Get line button. Then, a line option (category) may be changed by a user. By default, the option is relationship. Other categories are inheritance, reflexive and twin.</p>

<p>When a line option is changed, the current line is updated without using the Set button. However, if other line values are changed, the Set button must be clicked to accept the changes.</p>

<p><strong>Code 09-10.32</strong>: Line option change.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>lineOption</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>lineCategory</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>lineOption</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>change</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>=</span> <span class='n'>lineOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
        
        <span class='n'>line12Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Min</span><span class='o'>;</span>
        <span class='n'>line12MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Max</span><span class='o'>;</span>
        <span class='n'>line12IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Id</span><span class='o'>;</span>
        <span class='n'>line12NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Name</span><span class='o'>;</span>
        
        <span class='n'>line21Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Min</span><span class='o'>;</span>
        <span class='n'>line21MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Max</span><span class='o'>;</span>
        <span class='n'>line21IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Id</span><span class='o'>;</span>
        <span class='n'>line21NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Name</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The private attribute is defined in the Line class to categorize a line. In this step only relationship and inheritance values are offered to a user.</p>

<p><strong>Code 09-10.33</strong>: Line category private attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Line</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='n'>Box</span> <span class='n'>box1</span><span class='o'>;</span> <span class='c1'>// line begin box</span>
  <span class='n'>Box</span> <span class='n'>box2</span><span class='o'>;</span> <span class='c1'>// line end box</span>
  
  <span class='n'>String</span> <span class='n'>_category</span><span class='o'>;</span> <span class='c1'>// relationship, inheritance</span>
</code></pre>
</div>
<p>In the Line constructor, the category property is set to relationship.</p>

<p><strong>Code 09-10.34</strong>: Line default category.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>category</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>relationship</span><span class='err'>&#39;</span><span class='o'>;</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The category private attribute is used to define set and get property methods. In addition, two convenience methods that return a value of the bool type are declared in the shortcut syntax.</p>

<p><strong>Code 09-10.35</strong>: Category property methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='n'>set</span> <span class='nf'>category</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>category</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_category</span> <span class='o'>=</span> <span class='n'>category</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>relationship</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;N&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>inheritance</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>as</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>is</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span> 
  <span class='o'>}</span>
  
  <span class='n'>String</span> <span class='n'>get</span> <span class='nf'>category</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_category</span><span class='o'>;</span>
  
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>relationship</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>relationship</span><span class='err'>&#39;</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>inheritance</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>inheritance</span><span class='err'>&#39;</span><span class='o'>;</span>
</code></pre>
</div>
<p>Note that an inheritance relationship has specific default values.</p>

<p>In the footer section, which is used to represent the tool bar, the select element has two options: relationship and inheritance.</p>

<p><strong>Code 09-10.36</strong>: Select a line option in HTML.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;br/&gt;</span>
        <span class='nt'>&lt;label&gt;</span>Line<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;select</span> <span class='na'>id=</span><span class='s'>&quot;lineCategory&quot;</span><span class='nt'>&gt;</span>
          <span class='nt'>&lt;option&gt;</span>relationship<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>inheritance<span class='nt'>&lt;/option&gt;</span>
        <span class='nt'>&lt;/select&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;getLine&quot;</span><span class='nt'>&gt;</span>Get<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;setLine&quot;</span><span class='nt'>&gt;</span>Set<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;br/&gt;</span>   
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line12Box1&quot;</span><span class='nt'>&gt;</span>Box1<span class='nt'>&lt;/label&gt;</span> -&gt;
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line12Box2&quot;</span><span class='nt'>&gt;</span>Box2<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Min&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span> ..
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Max&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line12Id&quot;</span><span class='nt'>&gt;</span>identifier<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;checkbox&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Id&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line12Name&quot;</span><span class='nt'>&gt;</span>name<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Name&quot;</span><span class='nt'>/&gt;</span> 
        <span class='nt'>&lt;br/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line21Box2&quot;</span><span class='nt'>&gt;</span>Box2<span class='nt'>&lt;/label&gt;</span> -&gt;
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line21Box1&quot;</span><span class='nt'>&gt;</span>Box1<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Min&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span> ..
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Max&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line21Id&quot;</span><span class='nt'>&gt;</span>identifier<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;checkbox&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Id&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line21Name&quot;</span><span class='nt'>&gt;</span>name<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Name&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
</code></pre>
</div>
<p>The Get line button, for the last selected line, obtains the line values in the tool bar.</p>

<p><strong>Code 09-10.37</strong>: Get line.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>getLineButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>getLine</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>getLineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>lineOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>category</span><span class='o'>;</span>
        
        <span class='n'>line12Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Min</span><span class='o'>;</span>
        <span class='n'>line12MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Max</span><span class='o'>;</span>
        <span class='n'>line12IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Id</span><span class='o'>;</span>
        <span class='n'>line12NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Name</span><span class='o'>;</span>
        
        <span class='n'>line21Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Min</span><span class='o'>;</span>
        <span class='n'>line21MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Max</span><span class='o'>;</span>
        <span class='n'>line21IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Id</span><span class='o'>;</span>
        <span class='n'>line21NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Name</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>At the end of the ToolBar constructor, line elements are queried in the document.</p>

<p><strong>Code 09-10.38</strong>: Query line elements.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>line12Box1Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Box1</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12Box2Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Box2</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12MinInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Min</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12MaxInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Max</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12IdCheckbox</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Id</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12NameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Name</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>line21Box2Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Box2</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21Box1Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Box1</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21MinInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Min</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21MaxInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Max</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21IdCheckbox</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Id</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21NameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Name</span><span class='err'>&#39;</span><span class='o'>);</span>
</code></pre>
</div>
<p>In the draw method of the Line class, the center method of the Box class is used in order to avoid center point calculations.</p>

<p><strong>Code 09-10.39</strong>: Use of center.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
</code></pre>
</div>
<p>There are two private attributes in the Line class for twin lines.</p>

<p><strong>Code 09-10.40</strong>: Twin lines.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Line</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>String</span> <span class='n'>_category</span><span class='o'>;</span> <span class='c1'>// relationship, inheritance, reflexive, twin</span>
  <span class='n'>bool</span> <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
</code></pre>
</div>
<p>Depending on a line category, lines are drawn differently. For example, both ends of a reflexive line are connected to the same box (Figure 09-10.06). A hierarchy of directories is represented by a simple model.</p>

<p><img src='/img/s09s10/ReflexiveLine.png' alt='Alt Figure 09-10.06: Reflexive line' /></p>

<p><strong>Figure 09-10.06</strong>: Reflexive line.</p>

<p>A reflexive line is transformed from a selected relationship line between two different boxes by changing the relationship category to the reflexive category. After the transformation, the reflexive line is connected only to the parent box. The relationship directions have names based on the name of the concept (Directory in this case). The child-parent direction has 0..1 cardinalities, since the root directory does not have a parent.</p>

<p><strong>Code 09-10.41</strong>: Draw a line.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin1</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>reflexive</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
      <span class='o'>}</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span> <span class='o'>+</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='o'>}</span>
      <span class='n'>Point</span> <span class='n'>box1box2MinMaxPoint</span><span class='o'>;</span>
      <span class='n'>Point</span> <span class='n'>box2box1MinMaxPoint</span><span class='o'>;</span>
      <span class='n'>Point</span> <span class='n'>box1box2NamePoint</span><span class='o'>;</span>
      <span class='n'>Point</span> <span class='n'>box2box1NamePoint</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>reflexive</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>box1box2MinMaxPoint</span> <span class='o'>=</span> <span class='n'>calculateMinMaxPoint1</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>);</span>
        <span class='n'>box2box1MinMaxPoint</span> <span class='o'>=</span> <span class='n'>calculateMinMaxPoint2</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>);</span>
        <span class='n'>box1box2NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePoint1</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>);</span>
        <span class='n'>box2box1NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePoint2</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>box1box2MinMaxPoint</span> <span class='o'>=</span> <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>);</span>
        <span class='n'>box2box1MinMaxPoint</span> <span class='o'>=</span> <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>);</span>
        <span class='n'>box1box2NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>);</span>
        <span class='n'>box2box1NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>);</span>
      <span class='o'>}</span>
      
      <span class='n'>String</span> <span class='n'>box1box2MinMax</span> <span class='o'>=</span> <span class='n'>box1box2Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box1box2Max</span><span class='o'>;</span>
      <span class='n'>String</span> <span class='n'>box2box1MinMax</span> <span class='o'>=</span> <span class='n'>box2box1Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box2box1Max</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1box2Id</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1box2Min</span> <span class='o'>!=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box1box2MinMax</span><span class='o'>,</span> <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box1box2Name</span><span class='o'>,</span> <span class='n'>box1box2NamePoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1box2NamePoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box2box1Id</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box2box1Min</span> <span class='o'>!=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box2box1MinMax</span><span class='o'>,</span> <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box2box1Name</span><span class='o'>,</span> <span class='n'>box2box1NamePoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2box1NamePoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Two twin lines are transformed from two selected relationship lines by changing the relationship category to the twin category, then by entering direction names and checking identifiers (Figure 09-10.07).</p>

<p><img src='/img/s09s10/TwinLines.png' alt='Alt Figure 09-10.07: Twin lines' /></p>

<p><strong>Figure 09-10.07</strong>: Twin lines.</p>

<p>The set category property method is updated to allow for reflexive and twin categories.</p>

<p><strong>Code 09-10.42</strong>: Set category.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='n'>set</span> <span class='nf'>category</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>category</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_category</span> <span class='o'>=</span> <span class='n'>category</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>relationship</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;N&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>inheritance</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>as</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>is</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
      
      <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>reflexive</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box2</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>;</span>
      
      <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='n'>_putInEnglishPlural</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>.</span><span class='na'>toLowerCase</span><span class='o'>());</span>
      <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;N&#39;</span><span class='o'>;</span>
      <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>.</span><span class='na'>toLowerCase</span><span class='o'>();</span>
      <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
      <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      
      <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
      <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>  <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>twin</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Line</span> <span class='n'>twinLine</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>findTwinLine</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>twinLine</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>twinLine</span><span class='o'>.</span><span class='na'>twin</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
          <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>_twin1</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
          <span class='n'>_twin2</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
          <span class='n'>twinLine</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>twin</span><span class='err'>&#39;</span><span class='o'>;</span>
        <span class='o'>}</span>   
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In addition to the set property method, the get property method and other related methods are declared in the shortcut syntax.</p>

<p><strong>Code 09-10.43</strong>: Get category and related methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>String</span> <span class='n'>get</span> <span class='nf'>category</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_category</span><span class='o'>;</span>
  
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>relationship</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>relationship</span><span class='err'>&#39;</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>inheritance</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>inheritance</span><span class='err'>&#39;</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>reflexive</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>reflexive</span><span class='err'>&#39;</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>twin</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>twin</span><span class='err'>&#39;</span><span class='o'>;</span>
  
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>twin1</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_twin1</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>get</span> <span class='nf'>twin2</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_twin2</span><span class='o'>;</span>
</code></pre>
</div>
<p>The reflexive line requires a use of plural name for the parent-child relationship direction. This is done by the private putInEnglishPlural method.</p>

<p><strong>Code 09-10.44</strong>: Convert text to plural.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>String</span> <span class='nf'>_putInEnglishPlural</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>text</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>String</span> <span class='n'>plural</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
    <span class='k'>try</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>text</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>String</span> <span class='n'>lastCharacterString</span> <span class='o'>=</span> <span class='n'>text</span><span class='o'>.</span><span class='na'>substring</span><span class='o'>(</span><span class='n'>text</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>,</span>
            <span class='n'>text</span><span class='o'>.</span><span class='na'>length</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>lastCharacterString</span> <span class='o'>==</span> <span class='sc'>&#39;x&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>plural</span> <span class='o'>=</span> <span class='n'>text</span> <span class='o'>+</span> <span class='s'>&quot;es&quot;</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>lastCharacterString</span> <span class='o'>==</span> <span class='sc'>&#39;z&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>plural</span> <span class='o'>=</span> <span class='n'>text</span> <span class='o'>+</span> <span class='s'>&quot;zes&quot;</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>lastCharacterString</span> <span class='o'>==</span> <span class='sc'>&#39;y&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>String</span> <span class='n'>withoutLast</span> <span class='o'>=</span> <span class='n'>_dropEnd</span><span class='o'>(</span><span class='n'>text</span><span class='o'>,</span> <span class='n'>lastCharacterString</span><span class='o'>);</span>
          <span class='n'>plural</span> <span class='o'>=</span> <span class='n'>withoutLast</span> <span class='o'>+</span> <span class='s'>&quot;ies&quot;</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>plural</span> <span class='o'>=</span> <span class='n'>text</span> <span class='o'>+</span> <span class='s'>&quot;s&quot;</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>catch</span> <span class='o'>(</span><span class='n'>Exception</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='n'>text</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>plural</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private dropEnd method is used in the previous method.</p>

<p><strong>Code 09-10.45</strong>: Drop the end of text.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>String</span> <span class='nf'>_dropEnd</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>text</span><span class='o'>,</span> <span class='n'>String</span> <span class='n'>end</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>String</span> <span class='n'>withoutEnd</span> <span class='o'>=</span> <span class='n'>text</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>endPosition</span> <span class='o'>=</span> <span class='n'>text</span><span class='o'>.</span><span class='na'>lastIndexOf</span><span class='o'>(</span><span class='n'>end</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>endPosition</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='c1'>// Drop the end.</span>
      <span class='n'>withoutEnd</span> <span class='o'>=</span> <span class='n'>text</span><span class='o'>.</span><span class='na'>substring</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='n'>endPosition</span><span class='o'>);</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>withoutEnd</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The contains method is updated to consider reflexive and twin lines.</p>

<p><strong>Code 09-10.46</strong>: If a line contains a given point.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>contains</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>point</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>delta</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>||</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='n'>Point</span> <span class='n'>pointDif</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>inLineRectX</span><span class='o'>,</span> <span class='n'>inLineRectY</span><span class='o'>,</span> <span class='n'>inLineRect</span><span class='o'>;</span>
    <span class='kt'>double</span> <span class='n'>coord</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>beginPoint</span><span class='o'>;</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
      <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
      <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>reflexive</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>();</span>
      <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
      <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='c1'>// Rapid test: Verify if the point is in the line rectangle.</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='n'>inLineRect</span> <span class='o'>=</span> <span class='n'>inLineRectX</span> <span class='o'>&amp;&amp;</span> <span class='n'>inLineRectY</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>inLineRect</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='c1'>// If the line is horizontal or vertical there is no need to continue.</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>||</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&gt;</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The calculate methods are updated to consider twin lines.</p>

<p><strong>Code 09-10.47</strong>: Calculate a min max point.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>beginBox</span><span class='o'>,</span> <span class='n'>Box</span> <span class='n'>endBox</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>;</span>
    <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>lineEndPoint</span><span class='o'>);</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineEndPoint</span><span class='o'>,</span> <span class='n'>lineBeginPoint</span><span class='o'>);</span>
    
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x1</span> <span class='o'>&lt;=</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x1</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><strong>Code 09-10.48</strong>: Calculate a name point.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>beginBox</span><span class='o'>,</span> <span class='n'>Box</span> <span class='n'>endBox</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>reflexive</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>beginBox</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>x</span> <span class='o'>+</span> <span class='mi'>30</span><span class='o'>,</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>y</span> <span class='o'>+</span> <span class='mi'>30</span><span class='o'>);</span>
    <span class='o'>}</span>
    
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>;</span>
    <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>twin1</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>twin2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>twin2</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
      <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>lineEndPoint</span><span class='o'>);</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineEndPoint</span><span class='o'>,</span> <span class='n'>lineBeginPoint</span><span class='o'>);</span>
    
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x1</span> <span class='o'>&lt;=</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x1</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><strong>Code 09-10.49</strong>: Calculate min max and name points.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>calculateMinMaxPoint1</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>x</span> <span class='o'>-</span> <span class='mi'>30</span><span class='o'>,</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>y</span> <span class='o'>+</span> <span class='mi'>30</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>calculateMinMaxPoint2</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>x</span> <span class='o'>+</span> <span class='mi'>10</span><span class='o'>,</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>y</span> <span class='o'>+</span> <span class='mi'>30</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>calculateNamePoint1</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>x</span> <span class='o'>-</span> <span class='mi'>20</span><span class='o'>,</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive1</span><span class='o'>().</span><span class='na'>y</span> <span class='o'>-</span> <span class='mi'>20</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>calculateNamePoint2</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>x</span> <span class='o'>+</span> <span class='mi'>10</span><span class='o'>,</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>reflexive2</span><span class='o'>().</span><span class='na'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The select element has additional reflexive and twin options.</p>

<p><strong>Code 09-10.50</strong>: Line category.</p>
<div class='highlight'><pre><code class='html'>        <span class='nt'>&lt;select</span> <span class='na'>id=</span><span class='s'>&quot;lineCategory&quot;</span><span class='nt'>&gt;</span>
          <span class='nt'>&lt;option&gt;</span>relationship<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>inheritance<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>reflexive<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>twin<span class='nt'>&lt;/option&gt;</span>
        <span class='nt'>&lt;/select&gt;</span>
</code></pre>
</div>
<p>In the Box class, there are new methods for determining the twin and reflexive points.</p>

<p><strong>Code 09-10.51</strong>: Twin and reflexive methods return points.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>twin1</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>twinX</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>4</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>twinY</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>4</span><span class='o'>;</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>twinX</span><span class='o'>,</span> <span class='n'>twinY</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>twin2</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>twinX</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='o'>(</span><span class='n'>width</span> <span class='o'>/</span> <span class='mi'>4</span><span class='o'>)</span> <span class='o'>*</span> <span class='mi'>3</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>twinY</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='o'>(</span><span class='n'>height</span> <span class='o'>/</span> <span class='mi'>4</span><span class='o'>)</span> <span class='o'>*</span> <span class='mi'>3</span><span class='o'>;</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>twinX</span><span class='o'>,</span> <span class='n'>twinY</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>reflexive1</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>reflexiveX</span> <span class='o'>=</span> <span class='n'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>reflexiveY</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>reflexiveX</span><span class='o'>,</span> <span class='n'>reflexiveY</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='n'>Point</span> <span class='nf'>reflexive2</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>reflexiveX</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>reflexiveY</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>reflexiveX</span><span class='o'>,</span> <span class='n'>reflexiveY</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the Board class, a twin line may be found.</p>

<p><strong>Code 09-10.52</strong>: Find a twin line.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Line</span> <span class='nf'>findTwinLine</span><span class='o'>(</span><span class='n'>Line</span> <span class='n'>twin</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='n'>twin</span> <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span> <span class='o'>==</span> <span class='n'>twin</span><span class='o'>.</span><span class='na'>box1</span> <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span> <span class='o'>==</span> <span class='n'>twin</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='n'>line</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
        <em>Posted on 10 March 2012</em>
    
        <h2><a href="/2012/02/29/from-s08-to-s09.html">From Spiral08 To Spiral09</a></h2>
        <h2 id='code'>Code</h2>

<p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>The use of the script element in the MagicBoxes.html file has changed from</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
</code></pre>
</div>
<p>to</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;application/dart&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
<span class='nt'>&lt;script</span>
<span class='nt'>  </span><span class='na'>src=</span><span class='s'>&quot;http://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/script&gt;</span>
</code></pre>
</div>
<p>This change requires the Internet access when you run code in the Dart Editor.</p>

<p>If you use Spirals 00 … 11 locally, checkout branches s00a … s11a, where changes have been made.</p>

<h2 id='overview'>Overview</h2>

<p>In Spiral 08, for the last selected box, its title may be changed and an item may be added.</p>

<p>In Spiral 09, line min..max cardinalities may be changed by getting the selected line with a click on the Get button in the tool bar, making changes and setting them with a click on the Set button. Line direction names may be added. A line direction with 1..1 cardinalities may become a part of the identifier of the source concept.</p>

<p>Box sizes may be changed by using the View menu. There are menu items for increasing or decreasing the height, the width and the size of selected boxes.</p>

<p>Even a meta model, as one in Figure 08-09.01, may be designed with this spiral. The meta model represents what the MagicBoxes project tries to accomplish at the data level. Within a domain, there may be multiple models. A model may have several concepts. A concept consists of properties and neighbors. A concept may have several graphical representations (boxes), usually only one. A box may not be related to a concept (the minimum cardinality of zero from Box to Concept). The relationship direction from Concept to Box is named views. A property may have a type, which is a part of the parent domain.</p>

<p><img src='/img/s08s09/MetaModel.png' alt='Alt Figure 08-09.01: Meta model' /></p>

<p><strong>Figure 08-09.01</strong>: Meta model.</p>

<p>In a many-to-many relationship (Figure 08-09.02), between the Course and Student concepts, the third concept is introduced. The Enrollment concept breaks the many-to-many relationship into two one-to-many relationships with named directions. The (user oriented) identifier of the Enrollment concept consists of the two neighbor concepts. All these changes are done by selecting a relationship, getting it in the tool bar, making changes and then setting the relationship.</p>

<p><img src='/img/s08s09/ManyToMany.png' alt='Alt Figure 08-09.02: A many-to-many relationship' /></p>

<p><strong>Figure 08-09.02</strong>: A many-to-many relationship.</p>

<h2 id='steps'>Steps</h2>

<p>The menu bar has six new button elements.</p>

<p><strong>Code 08-09.01</strong>: View menu items.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='c1'>// View</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionHeightButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionHeightButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionWidthButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionWidthButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>increaseSelectionSizeButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>decreaseSelectionSizeButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>In the constructor of the MenuBar class, the button elements are initialized by the query method of the document representing the Web page. In addition, their click events are defined by unnamed methods. The reactions to clicks on the buttons are handled by methods in the Board class.</p>

<p><strong>Code 08-09.02</strong>: Reactions to click events of the View menu items.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>increaseSelectionHeightButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>height</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionHeightButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>height</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>increaseSelectionWidthButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>width</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionWidthButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>width</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>increaseSelectionSizeButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>increase</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>size</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>decreaseSelectionSizeButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>decrease</span><span class='o'>-</span><span class='n'>selection</span><span class='o'>-</span><span class='n'>size</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='err'>…</span>
    <span class='c1'>// Menu bar events.</span>
    <span class='err'>…</span>
    <span class='n'>increaseSelectionHeightButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseHeightOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionHeightButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseHeightOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>increaseSelectionWidthButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseWidthOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionWidthButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseWidthOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>increaseSelectionSizeButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>increaseSizeOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>decreaseSelectionSizeButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>decreaseSizeOfSelectedBoxes</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Those methods change the size of selected boxes.</p>

<p><strong>Code 08-09.03</strong>: Change size methods of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>increaseHeightOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>decreaseHeightOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>increaseWidthOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>decreaseWidthOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>increaseSizeOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>decreaseSizeOfSelectedBoxes</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_INCREMENT</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The incremental change in the size of boxes is defined by the constant in the Box class.</p>

<p><strong>Code 08-09.04</strong>: The box size change constant.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>DEFAULT_INCREMENT</span> <span class='o'>=</span> <span class='mi'>20</span><span class='o'>;</span>
</code></pre>
</div>
<p>The button elements with their corresponding ids are added to the View menu of the Web page.</p>

<p><strong>Code 08-09.05</strong>: Menu item buttons in HTML.</p>
<div class='highlight'><pre><code class='html'>       <span class='nt'>&lt;li&gt;</span>View
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-height&quot;</span><span class='nt'>&gt;</span>
               + Selection height
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-height&quot;</span><span class='nt'>&gt;</span>
               - Selection height
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-width&quot;</span><span class='nt'>&gt;</span>
               + Selection width
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-width&quot;</span><span class='nt'>&gt;</span>
               - Selection width
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;increase-selection-size&quot;</span><span class='nt'>&gt;</span>
             + Selection size
           <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;decrease-selection-size&quot;</span><span class='nt'>&gt;</span>
               - Selection size
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
</code></pre>
</div>
<p>The Figure 08-09.03 shows three boxes with different sizes.</p>

<p><img src='/img/s08s09/BoxSizes.png' alt='Alt Figure 08-09.03: Boxes with different sizes' /></p>

<p><strong>Figure 08-09.03</strong>: Boxes with different sizes.</p>

<p>There is a small change in the Board class to introduce the canvas attribute and its initialization by the constructor parameter with the same name.</p>

<p><strong>Code 08-09.06</strong>: The canvas attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>Board</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
</code></pre>
</div>
<p>The most recently selected line is kept in the corresponding attribute of the Board class.</p>

<p><strong>Code 08-09.07</strong>: Last line selected attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>Line</span> <span class='n'>lastLineSelected</span><span class='o'>;</span>
</code></pre>
</div>
<p>There are new attributes in the Line class for direction names and ids.</p>

<p><strong>Code 08-09.08</strong>: Line direction names and ids.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Line</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>String</span> <span class='n'>box1box2Name</span><span class='o'>;</span> <span class='c1'>// name from box1 to box2</span>
  <span class='n'>String</span> <span class='n'>box1box2Min</span><span class='o'>;</span> <span class='c1'>// min cardinality from box1 to box2</span>
  <span class='n'>String</span> <span class='n'>box1box2Max</span><span class='o'>;</span> <span class='c1'>// max cardinality from box1 to box2</span>
  <span class='n'>bool</span> <span class='n'>box1box2Id</span><span class='o'>;</span> <span class='c1'>// id from box1 to box2 </span>
  
  <span class='n'>String</span> <span class='n'>box2box1Name</span><span class='o'>;</span> <span class='c1'>// name from box2 to box1</span>
  <span class='n'>String</span> <span class='n'>box2box1Min</span><span class='o'>;</span> <span class='c1'>// min cardinality from box2 to box1</span>
  <span class='n'>String</span> <span class='n'>box2box1Max</span><span class='o'>;</span> <span class='c1'>// max cardinality from box2 to box1</span>
  <span class='n'>bool</span> <span class='n'>box2box1Id</span><span class='o'>;</span> <span class='c1'>// id from box2 to box1</span>
</code></pre>
</div>
<p>The new attributes are initialized in the constructor.</p>

<p><strong>Code 08-09.09</strong>: Default values for the line directions.</p>
<div class='highlight'><pre><code class='java'><span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>box1box2Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
    <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
    <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;N&#39;</span><span class='o'>;</span>
    <span class='n'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='n'>box2box1Name</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
    <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
    <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
    <span class='n'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In addition to min..max cardinalities, the line direction names and ids are displayed by the draw method of the Line class.</p>

<p><strong>Code 08-09.10</strong>: Drawing line directions.</p>
<div class='highlight'><pre><code class='java'><span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span> <span class='o'>+</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='o'>}</span>
      <span class='n'>Point</span> <span class='n'>box1box2MinMaxPoint</span> <span class='o'>=</span> 
        <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>);</span>
      <span class='n'>Point</span> <span class='n'>box2box1MinMaxPoint</span> <span class='o'>=</span> 
        <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>);</span>
      <span class='n'>Point</span> <span class='n'>box1box2NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>);</span>
      <span class='n'>Point</span> <span class='n'>box2box1NamePoint</span> <span class='o'>=</span> <span class='n'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>);</span>
      <span class='n'>String</span> <span class='n'>box1box2MinMax</span> <span class='o'>=</span> <span class='n'>box1box2Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box1box2Max</span><span class='o'>;</span>
      <span class='n'>String</span> <span class='n'>box2box1MinMax</span> <span class='o'>=</span> <span class='n'>box2box1Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box2box1Max</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1box2Id</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1box2Min</span> <span class='o'>!=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box1box2MinMax</span><span class='o'>,</span> <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> 
        <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box1box2Name</span><span class='o'>,</span> <span class='n'>box1box2NamePoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> 
        <span class='n'>box1box2NamePoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box2box1Id</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box2box1Min</span> <span class='o'>!=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box2box1MinMax</span><span class='o'>,</span> <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> 
        <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box2box1Name</span><span class='o'>,</span> <span class='n'>box2box1NamePoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> 
        <span class='n'>box2box1NamePoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The selection methods of the Line class handle the lastLineSelected attribute of the Board class.</p>

<p><strong>Code 08-09.11</strong>: The last line selected.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deselect</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>toggleSelection</span><span class='o'>()</span> <span class='o'>{</span> 
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>_selected</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_selected</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A line direction name is placed close to its line and the begin box. This location is determined by the calculateNamePointCloseToBeginBox method of the Line class.</p>

<p><strong>Code 08-09.12</strong>: Location for a line direction name.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>calculateNamePointCloseToBeginBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>beginBox</span><span class='o'>,</span> <span class='n'>Box</span> <span class='n'>endBox</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>lineEndPoint</span><span class='o'>);</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineEndPoint</span><span class='o'>,</span> <span class='n'>lineBeginPoint</span><span class='o'>);</span>
    
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x1</span> <span class='o'>&lt;=</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x1</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>5</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The line direction elements are declared as attributes in the ToolBar class.</p>

<p><strong>Code 08-09.13</strong>: Line direction elements as attributes.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>LabelElement</span> <span class='n'>line12Box1Label</span><span class='o'>;</span>
  <span class='n'>LabelElement</span> <span class='n'>line12Box2Label</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line12MinInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line12MaxInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line12IdCheckbox</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line12NameInput</span><span class='o'>;</span>
  
  <span class='n'>LabelElement</span> <span class='n'>line21Box2Label</span><span class='o'>;</span>
  <span class='n'>LabelElement</span> <span class='n'>line21Box1Label</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line21MinInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line21MaxInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line21IdCheckbox</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>line21NameInput</span><span class='o'>;</span>
  
  <span class='n'>ButtonElement</span> <span class='n'>getLineButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>setLineButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>The line direction attributes are initialized in the constructor of the ToolBar class.</p>

<p><strong>Code 08-09.14</strong>: Initialization of the line direction attributes.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>line12Box1Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Box1</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12Box2Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Box2</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12MinInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Min</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12MaxInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Max</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12IdCheckbox</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Id</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line12NameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line12Name</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>line21Box2Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Box2</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21Box1Label</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Box1</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21MinInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Min</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21MaxInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Max</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21IdCheckbox</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Id</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>line21NameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>line21Name</span><span class='err'>&#39;</span><span class='o'>);</span>
</code></pre>
</div>
<p>The get line button element reacts in the constructor of the ToolBar class to the click event by obtaining the last selected line.</p>

<p><strong>Code 08-09.15</strong>: Getting the last selected line.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>getLineButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>getLine</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>getLineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>line12Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line12MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Min</span><span class='o'>;</span>
        <span class='n'>line12MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Max</span><span class='o'>;</span>
        <span class='n'>line12IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Id</span><span class='o'>;</span>
        <span class='n'>line12NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Name</span><span class='o'>;</span>
        
        <span class='n'>line21Box2Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21Box1Label</span><span class='o'>.</span><span class='na'>text</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
        <span class='n'>line21MinInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Min</span><span class='o'>;</span>
        <span class='n'>line21MaxInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Max</span><span class='o'>;</span>
        <span class='n'>line21IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Id</span><span class='o'>;</span>
        <span class='n'>line21NameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Name</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The set line button element reacts in the constructor of the ToolBar class to the click event by accepting changes of the last selected line.</p>

<p><strong>Code 08-09.16</strong>: Accepting changes of the last selected line.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>setLineButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>setLine</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>setLineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastLineSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Min</span> <span class='o'>=</span> <span class='n'>line12MinInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Max</span> <span class='o'>=</span> <span class='n'>line12MaxInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Min</span> <span class='o'>==</span> <span class='sc'>&#39;1&#39;</span> <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Max</span> <span class='o'>==</span> <span class='sc'>&#39;1&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Id</span> <span class='o'>=</span> <span class='n'>line12IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>line12IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box1box2Name</span> <span class='o'>=</span> <span class='n'>line12NameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
        
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Min</span> <span class='o'>=</span> <span class='n'>line21MinInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Max</span> <span class='o'>=</span> <span class='n'>line21MaxInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Min</span> <span class='o'>==</span> <span class='sc'>&#39;1&#39;</span> <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Max</span> <span class='o'>==</span> <span class='sc'>&#39;1&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Id</span> <span class='o'>=</span> <span class='n'>line21IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>line21IdCheckbox</span><span class='o'>.</span><span class='na'>checked</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Id</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
        <span class='o'>}</span>  
        <span class='n'>line</span><span class='o'>.</span><span class='na'>box2box1Name</span> <span class='o'>=</span> <span class='n'>line21NameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>.</span><span class='na'>trim</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>The line elements have their HTML representation in the mb.html file.</p>

<p><strong>Code 08-09.17</strong>: Tool bar section with line elements.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;990&quot;</span> <span class='na'>height=</span><span class='s'>&quot;560&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;br/&gt;&lt;br/&gt;</span>       
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line12Box1&quot;</span><span class='nt'>&gt;</span>Box1<span class='nt'>&lt;/label&gt;</span> -&gt;
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line12Box2&quot;</span><span class='nt'>&gt;</span>Box2<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Min&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span> ..
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Max&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line12Id&quot;</span><span class='nt'>&gt;</span>Id<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;checkbox&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Id&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line12Name&quot;</span><span class='nt'>&gt;</span>Name<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line12Name&quot;</span><span class='nt'>/&gt;</span> |
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;getLine&quot;</span><span class='nt'>&gt;</span>Get<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;br/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line21Box2&quot;</span><span class='nt'>&gt;</span>Box2<span class='nt'>&lt;/label&gt;</span> -&gt;
        <span class='nt'>&lt;label</span> <span class='na'>id=</span><span class='s'>&quot;line21Box1&quot;</span><span class='nt'>&gt;</span>Box1<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Min&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span> ..
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Max&quot;</span> <span class='na'>size=</span><span class='s'>&quot;1&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line21Id&quot;</span><span class='nt'>&gt;</span>Id<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;checkbox&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Id&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;line21Name&quot;</span><span class='nt'>&gt;</span>Name<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;line21Name&quot;</span><span class='nt'>/&gt;</span> |   
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;setLine&quot;</span><span class='nt'>&gt;</span>Set<span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>In the page.css file, the width property of the body selector is updated to 1000 pixels.</p>

<p><strong>Code 08-09.18</strong>: Width of 1000 pixels.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>body</span> <span class='p'>{</span>
    <span class='k'>font-family</span><span class='o'>:</span> <span class='n'>verdana</span><span class='o'>,</span> <span class='n'>arial</span><span class='o'>,</span> <span class='n'>helvetica</span><span class='o'>,</span> <span class='k'>sans-serif</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>16px</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>1000px</span><span class='p'>;</span>
    <span class='k'>margin-left</span><span class='o'>:</span> <span class='k'>auto</span><span class='p'>;</span>
    <span class='k'>margin-right</span><span class='o'>:</span> <span class='k'>auto</span><span class='p'>;</span>
    <span class='k'>padding</span><span class='o'>:</span><span class='m'>10px</span><span class='p'>;</span> 
  <span class='p'>}</span>
</code></pre>
</div>
<p>The new width provides a better display of the tool bar in Figure 08-09.04. The figure shows the Order Items model.</p>

<p><img src='/img/s08s09/Orders.png' alt='Alt Figure 08-09.04: Order items model' /></p>

<p><strong>Figure 08-09.04</strong>: Order items model.</p>

<p>In the Board class, the saveAsPng method finds the model image element in the document and converts the canvas object to the PNG image.</p>

<p><strong>Code 08-09.19</strong>: Saving a model as a png image element.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>saveAsPng</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>ImageElement</span> <span class='n'>modelImage</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>modelImage</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>modelImage</span><span class='o'>.</span><span class='na'>src</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>toDataURL</span><span class='o'>(</span><span class='s'>&quot;image/png&quot;</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The image object is represented in HTML as the img element. The modelImage id is used to connect the image object in Dart with the image element in HTML.</p>

<p><strong>Code 08-09.20</strong>: Model displayed as an image in the Your Model section of the Web page.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span>
      <span class='nt'>&lt;header&gt;</span>
        <span class='nt'>&lt;h3&gt;</span>Your Model<span class='nt'>&lt;/h3&gt;</span>
      <span class='nt'>&lt;/header&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        In the File menu, save your model as a .png image:
      <span class='nt'>&lt;/p&gt;</span>
      <span class='nt'>&lt;img</span> <span class='na'>alt=</span><span class='s'>&quot;Your model saved as .png.&quot;</span> <span class='na'>id=</span><span class='s'>&quot;modelImage&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;p&gt;</span>
        You may save the model image as the model.png file in the mb/img directory.
      <span class='nt'>&lt;/p&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>The button element attribute is used in the MenuBar class to provide a way for a user to save a model as a PNG image.</p>

<p><strong>Code 08-09.21</strong>: File menu item as the button element attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='c1'>// File</span>
  <span class='n'>ButtonElement</span> <span class='n'>saveAsPngButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>The button element attribute is initialized in the constructor of the MenuBar class.</p>

<p><strong>Code 08-09.22</strong>: Initializing the save as button.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>saveAsPngButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>save</span><span class='o'>-</span><span class='n'>as</span><span class='o'>-</span><span class='n'>png</span><span class='err'>&#39;</span><span class='o'>);</span>
</code></pre>
</div>
<p>After the initialization of the button element attribute, the click event is defined.</p>

<p><strong>Code 08-09.23</strong>: Reacting to the button click.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>saveAsPngButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>saveAsPng</span><span class='o'>();</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>A model may be saved as an image file by using the File menu. The model appears first within the Web page (Figure 08-09.05) where it can be saved by using the right button of the mouse.</p>

<p><img src='/img/s08s09/PlaceForModel.png' alt='Alt Figure 08-09.05: Place where a model will appear after the save' /></p>

<p><strong>Figure 08-09.05</strong>: Place where a model will appear after the save.</p>

<p>In the mb.html file, the button element is added as the File menu item.</p>

<p><strong>Code 08-09.24</strong>: File menu item.</p>
<div class='highlight'><pre><code class='html'>       <span class='nt'>&lt;li&gt;</span>File
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;save-as-png&quot;</span><span class='nt'>&gt;</span>
               Save as .png
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>   
       <span class='nt'>&lt;/li&gt;</span>
</code></pre>
</div>
<p>There is also the About menu that is defined only in HTML. The About menu was introduced in one of the earlier spirals.</p>

<p><strong>Code 08-09.25</strong>: About menu.</p>
<div class='highlight'><pre><code class='html'>       <span class='nt'>&lt;li&gt;</span>About 
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Magic Boxes in <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;http://www.dart.org/&quot;</span><span class='nt'>&gt;</span>Dart<span class='nt'>&lt;/a&gt;&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Spiral 09<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>2012-01-02<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Dzenan Ridjanovic<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/ondart0.png&quot;</span><span class='nt'>/&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>   
       <span class='nt'>&lt;/li&gt;</span>
</code></pre>
</div>
<p>There are changes related to box items in the ToolBar class that should have been reported earlier. After an item of the last selected box is obtained based on its entered name, a value of the item option element is updated to a category of the item.</p>

<p><strong>Code 08-09.26</strong>: Getting the item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>getItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>getItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>getItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Item</span> <span class='n'>item</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>findItem</span><span class='o'>(</span><span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>;</span>
          <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>category</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>After changing the item of the last selected box, the category of the current item is updated.</p>

<p><strong>Code 08-09.27</strong>: Setting the item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>setItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>setItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>setItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>=</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>=</span> <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>After removing the item of the last selected box, the value of the item option comes back to the attribute default value.</p>

<p><strong>Code 08-09.28</strong>: Removing the item.</p>
<div class='highlight'><pre><code class='java'>    <span class='n'>removeItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>removeItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>removeItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>removeItem</span><span class='o'>(</span><span class='n'>currentItem</span><span class='o'>))</span> <span class='o'>{</span>
            <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
            <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
            <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>attribute</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='o'>}</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
</code></pre>
</div>
<p>In the Box class of Spiral 09, there are warnings in the getIntersectionPoint method: local variables x and y hide the x and y fields (attributes).</p>

<p><strong>Code 08-09.29</strong>: Local variables x and y have the same names as the x and y attributes.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>==</span> <span class='n'>x1</span><span class='o'>)</span> <span class='cm'>/* vertical line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x2</span><span class='o'>,</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>));</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>==</span> <span class='n'>y1</span><span class='o'>)</span> <span class='cm'>/* horizontal line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>((</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>),</span> <span class='n'>y2</span><span class='o'>);</span>

    <span class='kt'>double</span> <span class='n'>m</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>);</span>
    <span class='kt'>double</span> <span class='n'>fy</span> <span class='o'>=</span> <span class='n'>m</span> <span class='o'>*</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>y2</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span><span class='o'>;</span>
    <span class='cm'>/* float comparison, because fy may be bigger than the biggest integer */</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>fy</span> <span class='o'>&gt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>fy</span> <span class='o'>&lt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>fy</span><span class='o'>.</span><span class='na'>toInt</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>);</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='o'>((</span><span class='n'>fy</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>m</span><span class='o'>).</span><span class='na'>toInt</span><span class='o'>()</span> <span class='o'>+</span> <span class='n'>x2</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>After the local x and y variables are replaced by the new intersectionX and intersectionY variables, a problem is introduced. After creating two boxes with a line between them, moving one of the boxes jumps the box. Try to find out what the problem is?</p>

<p><strong>Code 08-09.30</strong>: Local variables intersectionX and intersectionY used.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>==</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='cm'>/* vertical line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x2</span><span class='o'>,</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='n'>y</span> <span class='o'>:</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>));</span>
    <span class='o'>}</span> 
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>==</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='cm'>/* horizontal line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>((</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='n'>x</span> <span class='o'>:</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>),</span> <span class='n'>y2</span><span class='o'>);</span>
    <span class='o'>}</span> 
      
    <span class='kt'>double</span> <span class='n'>m</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>intersectionX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='n'>x</span> <span class='o'>:</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>);</span>
    <span class='kt'>double</span> <span class='n'>fy</span> <span class='o'>=</span> <span class='n'>m</span> <span class='o'>*</span> <span class='o'>(</span><span class='n'>intersectionX</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>y2</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>intersectionY</span><span class='o'>;</span>
    <span class='cm'>/* float comparison, because fy may be bigger than the biggest integer */</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>fy</span> <span class='o'>&gt;=</span> <span class='n'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>fy</span> <span class='o'>&lt;=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>intersectionY</span> <span class='o'>=</span> <span class='n'>fy</span><span class='o'>.</span><span class='na'>toInt</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='n'>y</span> <span class='o'>:</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>);</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='o'>((</span><span class='n'>fy</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>m</span><span class='o'>).</span><span class='na'>toInt</span><span class='o'>()</span> <span class='o'>+</span> <span class='n'>x2</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>intersectionX</span><span class='o'>,</span> <span class='n'>intersectionY</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
        <em>Posted on 29 February 2012</em>
    
        <h2><a href="/2012/02/24/from-s07-to-s08.html">From Spiral07 To Spiral08</a></h2>
        <h2 id='code'>Code</h2>

<p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>The use of the script element in the MagicBoxes.html file has changed from</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
</code></pre>
</div>
<p>to</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;application/dart&quot;</span> <span class='na'>src=</span><span class='s'>&quot;MagicBoxes.dart&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
<span class='nt'>&lt;script</span>
<span class='nt'>  </span><span class='na'>src=</span><span class='s'>&quot;http://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js&quot;</span><span class='nt'>&gt;</span>
<span class='nt'>&lt;/script&gt;</span>
</code></pre>
</div>
<p>This change requires the Internet access when you run code in the Dart Editor.</p>

<p>If you use Spirals 00 … 11 locally, checkout branches s00a … s11a, where changes have been made.</p>

<h2 id='overview'>Overview</h2>

<p>In Spiral 07, a line may be selected and deleted.</p>

<p>In Spiral 08, for the last selected box, its title may be changed and an item may be added.</p>

<p>The tool bar has two input elements (fields), one for a box title (name) and the other for entering box items (Figure 07-08.01). A box may be seen as a concept (an entity) in modeling. Consequently, a box item may be considered as an attribute of the concept. In addition, an item may be declared as the globally unique identifier (guid), which has a universally unique value such as a time stamp. An item may be the identifier of its concept, or a part of the identifier (significant to a user). Finally, an item may be required (its value is required).</p>

<p><img src='/img/s07s08/ProjectTasksModel.png' alt='Alt Figure 07-08.01: A simple model with concepts, attributes and a relationship' /></p>

<p><strong>Figure 07-08.01</strong>: A simple model with concepts, attributes and a relationship.</p>

<p>A line between two boxes, may be considered as a relationship between two concepts. Thus, in Figure 07-08.01, a simple model has two concepts and one relationship. The Project and Task concepts have both three attributes. The project identifier is number (italics and bold). The objective attribute is required (bold). The description attribute is optional. A project may have from 0 to N (many) tasks. A task must belong to a project.</p>

<p>For the last selected box, its title may be changed by entering text in the Box field. For the last selected box, an item may be added by entering its name in the Item box, then clicking on the Add button. The choice of item categories is presented in the pop-up list. An existing item may be obtained by entering its name and clicking on the Get button. The obtained item may be changed (Set button) or even removed (Remove button).</p>

<h2 id='steps'>Steps</h2>

<p>Since there is no box number any more, the nextBoxNo property is removed from the Board class.</p>

<p><strong>Code 07-08.01</strong>: The nextBoxNo property is removed from the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='n'>get</span> <span class='nf'>nextBoxNo</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>+</span> <span class='mi'>1</span><span class='o'>;</span>
</code></pre>
</div>
<p>The Board class has the lastBoxSelected attribute that will be used to change the box name and to add items.</p>

<p><strong>Code 07-08.02</strong>: The lastBoxSelected attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>Box</span> <span class='n'>lastBoxSelected</span><span class='o'>;</span>
</code></pre>
</div>
<p>The printBoxNames method may be used in testing.</p>

<p><strong>Code 07-08.03</strong>: The printBoxNames method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>printBoxNames</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>print</span><span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>title</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>When a new box is constructed, its name is Box (without the box number and the position coordinates).</p>

<p><strong>Code 07-08.04</strong>: The private name attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>String</span> <span class='n'>_name</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>Box</span><span class='err'>&#39;</span><span class='o'>;</span>
</code></pre>
</div>
<p>There are no predefined items.</p>

<p><strong>Code 07-08.05</strong>: The draw method of the Box class.</p>
<div class='highlight'><pre><code class='java'><span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>title</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='o'>}</span> 
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Note that in the fillText method of the draw method, the title property is used instead of the private name attribute. The property name is title. There are two methods for handling the property. The method with the <strong>set</strong> keyword is used to update the private name attribute. The method with the get keyword is used to rea the property. Since the property uses the private attribute, it is not virtual.</p>

<p><strong>Code 07-08.06</strong>: The title property of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='n'>set</span> <span class='nf'>title</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>name</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_name</span> <span class='o'>=</span> <span class='n'>name</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='n'>String</span> <span class='n'>get</span> <span class='nf'>title</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='n'>_name</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The select, deselect and toggleSelection methods of the Boxclass keep the lastBoxSelected attribute of the Board class up to date.</p>

<p><strong>Code 07-08.07</strong>: Handling of the last box selected.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deselect</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>toggleSelection</span><span class='o'>()</span> <span class='o'>{</span> 
    <span class='n'>_selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>_selected</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>_selected</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The toString method stays in the Box class, but without the use of the box number. The method is not used in the drawing of a box.</p>

<p><strong>Code 07-08.08</strong>: No more box number.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>String</span> <span class='nf'>toString</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='err'>&#39;</span><span class='n'>$title</span> <span class='o'>(</span><span class='n'>$x</span><span class='o'>,</span> <span class='n'>$y</span><span class='o'>)</span><span class='err'>&#39;</span><span class='o'>;</span>
</code></pre>
</div>
<p>The ToolBar class has a new attribute of the InputElement type. This attribute, with the boxNameInput name, will be presented as a field in the tool bar.</p>

<p><strong>Code 07-08.09</strong>: The boxNameInput attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>InputElement</span> <span class='n'>boxNameInput</span><span class='o'>;</span>
</code></pre>
</div>
<p>In the constructor of the ToolBar class, the boxNameInput attribute references the boxName element of the document. There are two not named event methods added to the attribute. When the input element gets focus, its value becomes the title of the last selected box. When a user inputs a new box name, the title of the last box selected becomes the value of the input.</p>

<p><strong>Code 07-08.10</strong>: Two events to handle the box title display and update.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span> 
    <span class='n'>boxNameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>boxName</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>focus</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>Event</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>title</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
    <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>input</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>Event</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>box</span><span class='o'>.</span><span class='na'>title</span> <span class='o'>=</span> <span class='n'>boxNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Web page is updated to add a label element with the Box display, and an input element of the text type with the boxName id. This id is referenced by the label (for) and used in programming to make a connection between the input element and the boxNameInput attribute of the InputElement type in the ToolBar class.</p>

<p><strong>Code 07-08.11</strong>: The box name label and input field.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;890&quot;</span> <span class='na'>height=</span><span class='s'>&quot;560&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
      <span class='nt'>&lt;footer&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/select.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;box&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/box.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;line&quot;</span><span class='nt'>&gt;&lt;img</span> <span class='na'>src=</span><span class='s'>&quot;img/line.png&quot;</span><span class='nt'>/&gt;&lt;/button&gt;</span>
        <span class='ni'>&amp;nbsp;</span> <span class='ni'>&amp;nbsp;</span> <span class='ni'>&amp;nbsp;</span> <span class='ni'>&amp;nbsp;</span> <span class='ni'>&amp;nbsp;</span> <span class='ni'>&amp;nbsp;</span> 
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>&gt;</span>Box<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>/&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;application/dart&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
      <span class='nt'>&lt;script</span>
<span class='nt'>        </span><span class='na'>src=</span><span class='s'>&quot;http://dart.googlecode.com/svn/branches/bleeding_edge/dart/client/dart.js&quot;</span><span class='nt'>&gt;</span>
      <span class='nt'>&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>Note the change in the script element.</p>

<p>Two boxes with one line are created in Figure 07-08.02. Inittially, both boxes have the Box name. The first box is selected and its name is changed from Box to Project. Then, the second box is selected and its name is changed from Box to Task.</p>

<p><img src='/img/s07s08/BoxNames.png' alt='Alt Figure 07-08.02: Boxes may have names' /></p>

<p><strong>Figure 07-08.02</strong>: Boxes may have names.</p>

<p>The size of a box increased from 100 by 100 pixels to 120 by 120 pixels.</p>

<p><strong>Code 07-08.12</strong>: The box size increase.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>DEFAULT_WIDTH</span> <span class='o'>=</span> <span class='mi'>120</span><span class='o'>;</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>DEFAULT_HEIGHT</span> <span class='o'>=</span> <span class='mi'>120</span><span class='o'>;</span>
</code></pre>
</div>
<p>The box size is increased to accommodate user entered items (Figure 07-08.03).</p>

<p><img src='/img/s07s08/ItemNames.png' alt='Alt Figure 07-08.03: User entered item names' /></p>

<p><strong>Figure 07-08.03</strong>: User entered item names.</p>

<p>For the last selected box, an item may be added by entering its name in the Item box, then clicking on the Add button. A box may be seen as a concept (an entity) in modeling. Consequently, a box item may be considered as an attribute of the concept. A line between two boxes, may be considered as a relationship between two concepts.</p>

<p>Note that a line is covered by its boxes. Two simple changes enabled this desirable feature. In the redraw method of the Board class, the sequence of drawing is changed. Boxes are drawn after all lines are drawn.</p>

<p><strong>Code 07-08.13</strong>: Lines are drawn before boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>redraw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>clear</span><span class='o'>();</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>line</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the draw method of the Box class, before a box is drawn its rectangle is cleared, removing everything that has already been drawn within the box.</p>

<p><strong>Code 07-08.14</strong>: Box rectangle is cleared first.</p>
<div class='highlight'><pre><code class='java'><span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>clearRect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Box class has the items attribute of the List type.</p>

<p><strong>Code 07-08.15</strong>: The items attribute.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>List</span><span class='o'>&lt;</span><span class='n'>Item</span><span class='o'>&gt;</span> <span class='n'>items</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>items</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>List</span><span class='o'>();</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A list of items can accept only objects of the new Item class.</p>

<p><strong>Code 07-08.16</strong>: The Item class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Item</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Box</span> <span class='n'>box</span><span class='o'>;</span>
  
  <span class='n'>String</span> <span class='n'>name</span><span class='o'>;</span>
  
  <span class='n'>Item</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>box</span><span class='o'>,</span> <span class='n'>String</span> <span class='n'>name</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>this</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>=</span> <span class='n'>name</span><span class='o'>;</span>
    <span class='n'>box</span><span class='o'>.</span><span class='na'>items</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The Item class has two attributes: box and name. The box attribute references the parent container of the current item. The name attribute is the item name and is of the String type. In the constructor of the Item class, the shortcut notation is used for the box parameter, while the regular notation is used for the name parameter. In this regular notation, the <strong>this</strong> keyword is used to make a distinction between the name attribute and the name parameter, because they have the same name. The shortcut notation should have been used also for the name parameter.</p>

<p>The current item, represented by this, is added to the items attribute of the box attribute, which references the item’s box.</p>

<p>Within a box, items that are members of the items attribute are drawn by the draw method of the Box class.</p>

<p><strong>Code 07-08.17</strong>: Items are drawn within the for loop.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>clearRect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
      <span class='err'>…</span>
      <span class='kt'>int</span> <span class='n'>i</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
      <span class='k'>for</span> <span class='o'>(</span><span class='n'>Item</span> <span class='n'>item</span> <span class='n'>in</span> <span class='n'>items</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>i</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
          <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
        <span class='n'>i</span><span class='o'>++;</span>
      <span class='o'>}</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The x and y coordinates of an item are determined by its sequential position within the box with the help of constants.</p>

<p>The item name input and the add item button elements are added as the new attributes of the ToolBar class immediately after the box name input element.</p>

<p><strong>Code 07-08.18</strong>: Item input element.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>InputElement</span> <span class='n'>boxNameInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>itemNameInput</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>addItemButton</span><span class='o'>;</span>
</code></pre>
</div>
<p>In the constructor of the ToolBar class, the query method is used to find the corresponding elements in the document. The click event is linked to the add button. For the last selected box, the new item is constructed and a value entered by a user is selected in the Item field. The new item is linked to its box by its constructor.</p>

<p><strong>Code 07-08.19</strong>: Adding a new item.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span> 
    <span class='n'>itemNameInput</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>itemName</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>addItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>addItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>addItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>new</span> <span class='nf'>Item</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the mb.html file, three elements are added for a new item: a label with the Item text, an input with the itemName id used in the constructor of the ToolBar class, and a button with the addItem id.</p>

<p><strong>Code 07-08.20</strong>: Label, input and button elements for an item.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      …
      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>&gt;</span>Box<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;itemName&quot;</span><span class='nt'>&gt;</span>Item<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;itemName&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;addItem&quot;</span><span class='nt'>&gt;</span>Add<span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>In the Box class, there are two new methods to find and remove an item.</p>

<p><strong>Code 07-08.21</strong>: Find and remove item.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Item</span> <span class='nf'>findItem</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>name</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Item</span> <span class='n'>item</span> <span class='n'>in</span> <span class='n'>items</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>==</span> <span class='n'>name</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='n'>item</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>null</span><span class='o'>;</span>
  <span class='o'>}</span> 
  
  <span class='n'>bool</span> <span class='nf'>removeItem</span><span class='o'>(</span><span class='n'>Item</span> <span class='n'>item</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>items</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>item</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>index</span> <span class='o'>&gt;=</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>items</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The ToolBar class has four new attributes.</p>

<p><strong>Code 07-08.22</strong>: Get, set and remove item buttons and the current item.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>ButtonElement</span> <span class='n'>getItemButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>setItemButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>removeItemButton</span><span class='o'>;</span>
  
  <span class='n'>Item</span> <span class='n'>currentItem</span><span class='o'>;</span>
</code></pre>
</div>
<p>In the constructor of the ToolBar class, reactions to clicks on the get, set and remove buttons are defined.</p>

<p><strong>Code 07-08.23</strong>: Get, set and remove item events.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>getItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>getItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>getItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Item</span> <span class='n'>item</span> <span class='o'>=</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>findItem</span><span class='o'>(</span><span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
    
    <span class='n'>setItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>setItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>setItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>currentItem</span><span class='o'>.</span><span class='na'>name</span> <span class='o'>=</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>;</span>
          <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
    
    <span class='n'>removeItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>removeItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>removeItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>currentItem</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>removeItem</span><span class='o'>(</span><span class='n'>currentItem</span><span class='o'>))</span> <span class='o'>{</span>
            <span class='n'>currentItem</span> <span class='o'>=</span> <span class='kc'>null</span><span class='o'>;</span>
            <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span><span class='o'>;</span>
          <span class='o'>}</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the footer of the Web page, the button elements, with their ids used in the constructor of the ToolBar class, are added.</p>

<p><strong>Code 07-08.24</strong>: Get, set and remove item buttons.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      …
      <span class='nt'>&lt;footer&gt;</span>
        …
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;getItem&quot;</span><span class='nt'>&gt;</span>Get<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;setItem&quot;</span><span class='nt'>&gt;</span>Set<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;removeItem&quot;</span><span class='nt'>&gt;</span>Remove<span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p>An existing item may be obtained by entering its name and clicking on the Get button. The item name may be changed by the Set button or deleted by the Remove button (Figure 07-08.04).</p>

<p><img src='/img/s07s08/ItemNameChange.png' alt='Alt Figure 07-08.04: Updating an item name' /></p>

<p><strong>Figure 07-08.04</strong>: Updating an item name.</p>

<p>An item has a category.</p>

<p><strong>Code 07-08.25</strong>: The item category.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Item</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Box</span> <span class='n'>box</span><span class='o'>;</span>
  
  <span class='n'>String</span> <span class='n'>name</span><span class='o'>;</span>
  <span class='n'>String</span> <span class='n'>category</span><span class='o'>;</span>
  
  <span class='n'>Item</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>box</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>category</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>box</span><span class='o'>.</span><span class='na'>items</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='k'>this</span><span class='o'>);</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The item category is represented in the Web page (Figure 07-08.05) as a select element (pop-up list). By default, an item is an attribute. In addition, it may be declared as guid (globally unique identifier&#8211;not significant to a user), identifier (significant to a user) or required (mandatory value).</p>

<p><strong>Code 07-08.26</strong>: The select element with the itemCategory id.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;section&gt;</span> 
      …
      <span class='nt'>&lt;footer&gt;</span>
        … 
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>&gt;</span>Box<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;boxName&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;label</span> <span class='na'>for=</span><span class='s'>&quot;itemName&quot;</span><span class='nt'>&gt;</span>Item<span class='nt'>&lt;/label&gt;</span>
        <span class='nt'>&lt;input</span> <span class='na'>type=</span><span class='s'>&quot;text&quot;</span> <span class='na'>id=</span><span class='s'>&quot;itemName&quot;</span><span class='nt'>/&gt;</span>
        <span class='nt'>&lt;select</span> <span class='na'>id=</span><span class='s'>&quot;itemCategory&quot;</span><span class='nt'>&gt;</span>
          <span class='nt'>&lt;option&gt;</span>attribute<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>guid<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>identifier<span class='nt'>&lt;/option&gt;</span>
          <span class='nt'>&lt;option&gt;</span>required<span class='nt'>&lt;/option&gt;</span>
        <span class='nt'>&lt;/select&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;addItem&quot;</span><span class='nt'>&gt;</span>Add<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;getItem&quot;</span><span class='nt'>&gt;</span>Get<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;setItem&quot;</span><span class='nt'>&gt;</span>Set<span class='nt'>&lt;/button&gt;</span>
        <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;removeItem&quot;</span><span class='nt'>&gt;</span>Remove<span class='nt'>&lt;/button&gt;</span>
      <span class='nt'>&lt;/footer&gt;</span>
      …
    <span class='nt'>&lt;/section&gt;</span>
</code></pre>
</div>
<p><img src='/img/s07s08/ModelConceptAttribute.png' alt='Alt Figure 07-08.05: Selecting an item category' /></p>

<p><strong>Figure 07-08.05</strong>: Selecting an item category.</p>

<p>The ToolBar class has the itemOption attribute of the OptionElement type.</p>

<p><strong>Code 07-08.27</strong>: The item option (category).</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span>
  <span class='err'>…</span>
  <span class='n'>InputElement</span> <span class='n'>boxNameInput</span><span class='o'>;</span>
  <span class='n'>InputElement</span> <span class='n'>itemNameInput</span><span class='o'>;</span>
  <span class='n'>OptionElement</span> <span class='n'>itemOption</span><span class='o'>;</span>
</code></pre>
</div>
<p>The itemOption attribute gets its value from the query method of the document. After a click on the add button, the new item becomes the current item.</p>

<p><strong>Code 07-08.28</strong>: The constructor of the ToolBar class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>itemOption</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>itemCategory</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>addItemButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>addItem</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>addItemButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxSelected</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>currentItem</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Item</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>value</span><span class='o'>,</span> <span class='n'>itemOption</span><span class='o'>.</span><span class='na'>value</span><span class='o'>);</span>
        <span class='n'>itemNameInput</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Items are displayed differently based on their categories.</p>

<p><strong>Code 07-08.29</strong>: An item display in the draw method of the Box class.</p>
<div class='highlight'><pre><code class='java'><span class='k'>for</span> <span class='o'>(</span><span class='n'>Item</span> <span class='n'>item</span> <span class='n'>in</span> <span class='n'>items</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>attribute</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>i</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
            <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>guid</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>i</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
            <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>identifier</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='n'>italic</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>i</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
            <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>category</span> <span class='o'>==</span> <span class='err'>&#39;</span><span class='n'>required</span><span class='err'>&#39;</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;</span><span class='n'>bold</span> <span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
          <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span><span class='o'>.</span><span class='na'>name</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>i</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
            <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
        <span class='o'>}</span>
        <span class='n'>i</span><span class='o'>++;</span>
      <span class='o'>}</span>
</code></pre>
</div>
<p>The Line class has new attributes for min and max cardinalities in both directions – from box1 to box2 and from box2 to box1.</p>

<p><strong>Code 07-08.30</strong>: Line cardinalities.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Line</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='n'>Box</span> <span class='n'>box1</span><span class='o'>;</span> <span class='c1'>// line begin box</span>
  <span class='n'>Box</span> <span class='n'>box2</span><span class='o'>;</span> <span class='c1'>// line end box</span>
  
  <span class='n'>String</span> <span class='n'>box1box2Min</span><span class='o'>;</span> <span class='c1'>// min cardinality from box1 to box2</span>
  <span class='n'>String</span> <span class='n'>box1box2Max</span><span class='o'>;</span> <span class='c1'>// max cardinality from box1 to box2</span>
  
  <span class='n'>String</span> <span class='n'>box2box1Min</span><span class='o'>;</span> <span class='c1'>// min cardinality from box2 to box1</span>
  <span class='n'>String</span> <span class='n'>box2box1Max</span><span class='o'>;</span> <span class='c1'>// max cardinality from box2 to box1</span>
  
  <span class='n'>bool</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  
  <span class='n'>String</span> <span class='n'>textFontSize</span> <span class='o'>=</span> <span class='mi'>12</span><span class='o'>;</span>
  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
</code></pre>
</div>
<p>The cardinalities are initialized in the constructor of the Line class. The box1 parameter represents a parent and the box2 parameter a child. A parent has from 0 to N children, and a child has one and only one parent.</p>

<p><strong>Code 07-08.31</strong>: The Line class constructor.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>box1box2Min</span> <span class='o'>=</span> <span class='sc'>&#39;0&#39;</span><span class='o'>;</span>
    <span class='n'>box1box2Max</span> <span class='o'>=</span> <span class='sc'>&#39;N&#39;</span><span class='o'>;</span>
    <span class='n'>box2box1Min</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
    <span class='n'>box2box1Max</span> <span class='o'>=</span> <span class='sc'>&#39;1&#39;</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The min..max cardinalities are displayed in the draw method of the Line class.</p>

<p><strong>Code 07-08.32</strong>: The draw method of the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='err'>&#39;&#39;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='n'>px</span> <span class='n'>sans</span><span class='o'>-</span><span class='n'>serif</span><span class='err'>&#39;</span><span class='o'>;</span>
      <span class='n'>Point</span> <span class='n'>box1box2MinMaxPoint</span> <span class='o'>=</span> 
        <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>,</span> <span class='n'>box2</span><span class='o'>);</span>
      <span class='n'>Point</span> <span class='n'>box2box1MinMaxPoint</span> <span class='o'>=</span> 
        <span class='n'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>,</span> <span class='n'>box1</span><span class='o'>);</span>
      <span class='n'>String</span> <span class='n'>box1box2MinMax</span> <span class='o'>=</span> <span class='n'>box1box2Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box1box2Max</span><span class='o'>;</span>
      <span class='n'>String</span> <span class='n'>box2box1MinMax</span> <span class='o'>=</span> <span class='n'>box2box1Min</span> <span class='o'>+</span> <span class='err'>&#39;</span><span class='o'>..</span><span class='err'>&#39;</span> <span class='o'>+</span> <span class='n'>box2box1Max</span><span class='o'>;</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box1box2MinMax</span><span class='o'>,</span> 
        <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box1box2MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>box2box1MinMax</span><span class='o'>,</span> 
        <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>box2box1MinMaxPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The calculateMinMaxPointCloseToBeginBox method returns a point where the min..max cardinalities close to the first box given will be positioned. The point is calculated with the help of the getIntersectionPoint method of the Box class.</p>

<p><strong>Code 07-08.33</strong>: The point where min and max cardinalities will be displayed.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>calculateMinMaxPointCloseToBeginBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>beginBox</span><span class='o'>,</span> <span class='n'>Box</span> <span class='n'>endBox</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>lineBeginPoint</span> <span class='o'>=</span> <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>lineEndPoint</span> <span class='o'>=</span> <span class='n'>endBox</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> 
      <span class='n'>beginBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>lineEndPoint</span><span class='o'>);</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> 
      <span class='n'>endBox</span><span class='o'>.</span><span class='na'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>lineEndPoint</span><span class='o'>,</span> <span class='n'>lineBeginPoint</span><span class='o'>);</span>
    
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x1</span> <span class='o'>&lt;=</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>x1</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y1</span> <span class='o'>&lt;=</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y1</span> <span class='o'>+</span> <span class='mi'>1</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y2</span> <span class='o'>+</span> <span class='mi'>7</span> <span class='o'>*</span> <span class='o'>((</span><span class='n'>y1</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='mi'>8</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The getIntersectionPoint method in Spiral 08, uses the x and y local variables that hide values of the x and y attributes of the Box class. In order to make a distinction between local variables and attributes, the <strong>this</strong> keyword is used to qualify the attributes of the Box class.</p>

<p><strong>Code 07-08.34</strong>: The getIntersectionPoint of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>==</span> <span class='n'>x1</span><span class='o'>)</span> <span class='cm'>/* vertical line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x2</span><span class='o'>,</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>));</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>==</span> <span class='n'>y1</span><span class='o'>)</span> <span class='cm'>/* horizontal line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>((</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>),</span> <span class='n'>y2</span><span class='o'>);</span>

    <span class='kt'>double</span> <span class='n'>m</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>);</span>
    <span class='kt'>double</span> <span class='n'>fy</span> <span class='o'>=</span> <span class='n'>m</span> <span class='o'>*</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>y2</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y</span><span class='o'>;</span>
    <span class='cm'>/* float comparison, because fy may be bigger than the biggest integer */</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>fy</span> <span class='o'>&gt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>fy</span> <span class='o'>&lt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>fy</span><span class='o'>.</span><span class='na'>toInt</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>);</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='o'>((</span><span class='n'>fy</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>m</span><span class='o'>).</span><span class='na'>toInt</span><span class='o'>()</span> <span class='o'>+</span> <span class='n'>x2</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The x and y local variables are renamed intersectionX and intersectionY in this step.</p>

<p><strong>Code 07-08.35</strong>: The getIntersectionPoint of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>==</span> <span class='n'>x1</span><span class='o'>)</span> <span class='cm'>/* vertical line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x2</span><span class='o'>,</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>));</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>==</span> <span class='n'>y1</span><span class='o'>)</span> <span class='cm'>/* horizontal line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>((</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>),</span> <span class='n'>y2</span><span class='o'>);</span>

    <span class='kt'>double</span> <span class='n'>m</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>intersectionX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>);</span>
    <span class='kt'>double</span> <span class='n'>fy</span> <span class='o'>=</span> <span class='n'>m</span> <span class='o'>*</span> <span class='o'>(</span><span class='n'>intersectionX</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>y2</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>intersectionY</span><span class='o'>;</span>
    <span class='cm'>/* float comparison, because fy may be bigger than the biggest integer */</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>fy</span> <span class='o'>&gt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>fy</span> <span class='o'>&lt;=</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>intersectionY</span> <span class='o'>=</span> <span class='n'>fy</span><span class='o'>.</span><span class='na'>toInt</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>:</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>);</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='o'>((</span><span class='n'>fy</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>m</span><span class='o'>).</span><span class='na'>toInt</span><span class='o'>()</span> <span class='o'>+</span> <span class='n'>x2</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>intersectionX</span><span class='o'>,</span> <span class='n'>intersectionY</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Since local variables do not have the same names as the attributes, the <strong>this</strong> keyword is removed from the next step.</p>

<p><strong>Code 07-08.36</strong>: The getIntersectionPoint of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Point</span> <span class='nf'>getIntersectionPoint</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>lineBeginPoint</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>lineEndPoint</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y1</span> <span class='o'>=</span> <span class='n'>lineBeginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>x2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>y2</span> <span class='o'>=</span> <span class='n'>lineEndPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>==</span> <span class='n'>x1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='cm'>/* vertical line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>x2</span><span class='o'>,</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='n'>y</span> <span class='o'>:</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>));</span>
    <span class='o'>}</span> 
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>==</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='cm'>/* horizontal line */</span>
      <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>((</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='n'>x</span> <span class='o'>:</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>),</span> <span class='n'>y2</span><span class='o'>);</span>
    <span class='o'>}</span> 
      
    <span class='kt'>double</span> <span class='n'>m</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>-</span> <span class='n'>y1</span><span class='o'>)</span> <span class='o'>/</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>-</span> <span class='n'>x1</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>intersectionX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>x2</span> <span class='o'>&lt;</span> <span class='n'>x1</span> <span class='o'>?</span> <span class='n'>x</span> <span class='o'>:</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>);</span>
    <span class='kt'>double</span> <span class='n'>fy</span> <span class='o'>=</span> <span class='n'>m</span> <span class='o'>*</span> <span class='o'>(</span><span class='n'>intersectionX</span> <span class='o'>-</span> <span class='n'>x2</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>y2</span><span class='o'>;</span>
    <span class='kt'>int</span> <span class='n'>intersectionY</span><span class='o'>;</span>
    <span class='cm'>/* float comparison, because fy may be bigger than the biggest integer */</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>fy</span> <span class='o'>&gt;=</span> <span class='n'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>fy</span> <span class='o'>&lt;=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>intersectionY</span> <span class='o'>=</span> <span class='n'>fy</span><span class='o'>.</span><span class='na'>toInt</span><span class='o'>();</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>y2</span> <span class='o'>&lt;</span> <span class='n'>y1</span> <span class='o'>?</span> <span class='n'>y</span> <span class='o'>:</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>);</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='o'>((</span><span class='n'>fy</span> <span class='o'>-</span> <span class='n'>y2</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>m</span><span class='o'>).</span><span class='na'>toInt</span><span class='o'>()</span> <span class='o'>+</span> <span class='n'>x2</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='k'>new</span> <span class='nf'>Point</span><span class='o'>(</span><span class='n'>intersectionX</span><span class='o'>,</span> <span class='n'>intersectionY</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A meta model is a model about models. A simple meta model, shown in Figure 07-08.06, representing models, model concepts and concept attributes is designed in the last step of Spiral 08.</p>

<p><img src='/img/s07s08/SimpleMetaModel.png' alt='Alt Figure 07-08.06: Cardinalities in a simple meta model' /></p>

<p><strong>Figure 07-08.06</strong>: Cardinalities in a simple meta model.</p>
        <em>Posted on 24 February 2012</em>
    
</section>

<section>
    <header>
        <h2>All Posts</h2>
        <!-- -->
    </header>  
    
        <h2><a href="/2012/03/10/from-s09-to-s10.html">From Spiral09 To Spiral10</a></h2>
        <em>Posted on 10 March 2012</em>
    
        <h2><a href="/2012/02/29/from-s08-to-s09.html">From Spiral08 To Spiral09</a></h2>
        <em>Posted on 29 February 2012</em>
    
        <h2><a href="/2012/02/24/from-s07-to-s08.html">From Spiral07 To Spiral08</a></h2>
        <em>Posted on 24 February 2012</em>
    
        <h2><a href="/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a></h2>
        <em>Posted on 21 February 2012</em>
    
        <h2><a href="/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a></h2>
        <em>Posted on 15 February 2012</em>
    
        <h2><a href="/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a></h2>
        <em>Posted on 10 February 2012</em>
    
        <h2><a href="/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a></h2>
        <em>Posted on 07 February 2012</em>
    
        <h2><a href="/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a></h2>
        <em>Posted on 02 February 2012</em>
    
        <h2><a href="/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a></h2>
        <em>Posted on 31 January 2012</em>
    
        <h2><a href="/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a></h2>
        <em>Posted on 23 January 2012</em>
    
        <h2><a href="/2012/01/14/first-post.html">First Post</a></h2>
        <em>Posted on 14 January 2012</em>
    
</section>

        </section>

        <section>
     
        </section>

        <footer>
          <a href="http://dzenanr.github.com/ondart.rss">
            <img src="/img/xml.gif" width=36 height=14 alt="RSS feed for this site" border=0>
          </a>
        </footer>

    </body>
</html>


