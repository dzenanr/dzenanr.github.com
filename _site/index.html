<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="Dzenan Ridjanovic"/>
        <title>On Dart</title> 
        <link rel="stylesheet" href="/css/code.css"/>  
        <link rel="stylesheet" href="/css/layout.css"/>
        <link rel="stylesheet" href="/css/link.css"/>
        <link rel="stylesheet" href="/css/list.css"/>
        <link rel="stylesheet" href="/css/menu.css"/>
        <link rel="stylesheet" href="/css/page.css"/>
    </head>

    <body>
        <header>  
            <h1>
                <a href="http://www.ondart.info/"><img src="/img/ondartb1.png"/></a>
               On Dart
               <!--  -->
            </h1>
        </header>

        <nav>
            <ul>
                <li>Dart
                    <ul>
                        <li>
                            <a href="http://www.dartlang.org/">Dart</a>
                        </li>
                        <li>
                            <a href="http://try.dartlang.org/">Dart Console</a>
                        </li>
                    </ul>  
                </li>
                <li>Magic Boxes
                    <ul>
                        <li>
                            <a href="http://goo.gl/I72z1">Browse Code</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Design Model</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes">Get Git</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes/tags">Get Spirals</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s00/MagicBoxes/MagicBoxes.html">Spiral 00</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s01/MagicBoxes/MagicBoxes.html">Spiral 01</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s02/MagicBoxes/MagicBoxes.html">Spiral 02</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s03/MagicBoxes/MagicBoxes.html">Spiral 03</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s04/MagicBoxes/MagicBoxes.html">Spiral 04</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s05/MagicBoxes/MagicBoxes.html">Spiral 05</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s06/MagicBoxes/MagicBoxes.html">Spiral 06</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s07/MagicBoxes/MagicBoxes.html">Spiral 07</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s08/MagicBoxes/MagicBoxes.html">Spiral 08</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s09/MagicBoxes/MagicBoxes.html">Spiral 09</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s10/MagicBoxes/MagicBoxes.html">Spiral 10</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Spiral 11</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s12/MagicBoxes/MagicBoxes.html">Spiral 12</a> 
                        </li>
                    </ul>  
                </li>
                <li>On Dart
                    <ul>
                        <li>
                            <a href="https://plus.google.com/u/0/b/113649577593294551754/113649577593294551754/posts">Google+ Page</a> 
                        </li>
                    </ul>  
                </li>
                <li>Posts
                    <ul>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a> 
                        </li>
                        <li>
                            &nbsp; 
                        </li>
                    </ul>  
                </li>
                <li>About
                    <ul>
                        <li>
                            <a href="http://goo.gl/f1F2e">D. R. (CV in PDF)</a> 
                        </li>
                    </ul>  
                </li>
            </ul>
        </nav>

        <section>
            <section>
    
        <h2><a href="/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 03, a box may be created by clicking on an empty space in the board, selected and then moved. In Spiral 04, each box has a title and the same four items. A box title has an incremental number and its (x, y) coordinates within the board. A box is moved only if it is selected and if the mouse is pressed down.</p>

<p>The first step towards Spiral 04 is to display a box title with an incremental number (Figure 03-04.01).</p>

<p><img src='/img/s03s04/BoxesWithTitle.png' alt='Alt Figure 03-04.01: Boxes with title' /></p>

<p><strong>Figure 03-04.01</strong>: Boxes with title.</p>

<p>A box is divided into sections. A smaller section is dedicated to a box title. A box title consists of the Box word and the box number. The first box created has the number 1 in its title. For each new box, this number is incremented by 1.</p>

<p>The title section height is determined by the TBH constant of 20 pixels. The title is displayed with the offset of 4 pixels. The font size is 12. The title number is obtained at the beginning of the constructor from the nextBoxNo property of the board.</p>

<p><strong>Code 03-04.01</strong>: Box title preparations.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>SSS</span> <span class='o'>=</span> <span class='mi'>6</span><span class='o'>;</span> <span class='c1'>// selection square size</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>TBH</span> <span class='o'>=</span> <span class='mi'>20</span><span class='o'>;</span> <span class='c1'>// title section height</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>TOS</span> <span class='o'>=</span> <span class='mi'>4</span><span class='o'>;</span> <span class='c1'>// text offset size</span>
  
  <span class='err'>…</span>
  
  <span class='n'>String</span> <span class='n'>textFontSize</span> <span class='o'>=</span> <span class='mi'>12</span><span class='o'>;</span>
  <span class='n'>String</span> <span class='n'>title</span> <span class='o'>=</span> <span class='s'>&quot;Box&quot;</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>titleNo</span><span class='o'>;</span>
  
  <span class='err'>…</span>
  
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>titleNo</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>nextBoxNo</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseDown</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseDown</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseUp</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseUp</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseMove</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseMove</span><span class='o'>);</span>
  <span class='o'>}</span>
  <span class='err'>…</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>There is no attribute with the nextBoxNo name in the Board class. However, there is a method with the nextBoxNo name and no parameters, with the <strong>get</strong> keyword in front of the method name. This method represents a derived property of the Board class that may be referenced as if it was an attribute of the class. The <strong>get</strong> keyword allows a retrieval of a value that is obtained from the length of the boxes attribute incremented by 1. Without the <strong>get</strong> keyword, we could not make a simple reference to board.nextBoxNo. Without the <strong>get</strong> keyword, the next box number could have been obtained by board.nextBoxNo().</p>

<p><strong>Code 03-04.02</strong>: The nextBoxNo derived property of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='n'>get</span> <span class='nf'>nextBoxNo</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>+</span> <span class='mi'>1</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>After the rectangle of a box is prepared, the line that separates the title from the rest of the box is defined. First, the drawing cursor is moved to the beginning of a line position – the same x, but y is down for the TBH constant. Second, the lineTo method is led to the end of the line position. The font attribute specifies the font of the title. The textAlign attribute determines the horizontal alignment of the text. The textBaseline attribute specifies the vertical alignment of the title. The fillText method prepares the text to be drawn, together with everything else defined between the beginPath and closePath methods, by the stroke method. The fillText method accepts three arguments: the text to display, and the (x,y) coordinates to define where to render it. The fourth argument is optional. It is the maximum width of the text.</p>

<p><strong>Code 03-04.03</strong>: The title section drawing.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='s'>&quot;bold &quot;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='s'>&quot;px sans-serif&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textAlign</span> <span class='o'>=</span> <span class='s'>&quot;start&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textBaseline</span> <span class='o'>=</span> <span class='s'>&quot;top&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>title</span> <span class='o'>+</span> <span class='s'>&quot; &quot;</span> <span class='o'>+</span> <span class='n'>titleNo</span><span class='o'>,</span> 
      <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The property getter is shortened in the Board class from the previous version that is put under the /* … */ comment, so that the whole method becomes one liner. The expression after the =&gt; sign is evaluated and its result is returned to a caller of the method.</p>

<p><strong>Code 03-04.04</strong>: The shorthand notation for methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='cm'>/*</span>
<span class='cm'>  int get nextBoxNo() {</span>
<span class='cm'>    return boxes.length + 1;</span>
<span class='cm'>  }</span>
<span class='cm'>  */</span> 
  <span class='kt'>int</span> <span class='n'>get</span> <span class='nf'>nextBoxNo</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>+</span> <span class='mi'>1</span><span class='o'>;</span>
</code></pre>
</div>
<p>The size of a new box is changed from 60 by 100 to 100 by 100 pixels (Code 03-04.05), so that a new title with box coordinates may be displayed within the box (Figure 03-04.02).</p>

<p><img src='/img/s03s04/BoxesWithCoordinates.png' alt='Alt Figure 03-04.02: Boxes with coordinates in title' /></p>

<p><strong>Figure 03-04.02</strong>: Boxes with coordinates in title.</p>

<p>If a new box is positioned outside the west and south borders of the board, the box is moved back to the board. This time, the updated x and y coordinates are smaller for 1 pixel in order to see the moved back box in full.</p>

<p><strong>Code 03-04.05</strong>: Small changes in the onMouseDown method.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Create a box in the position of the mouse click on the board, </span>
  <span class='c1'>// but not on an existing box.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> <span class='mi'>100</span><span class='o'>,</span> <span class='mi'>100</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnExistingBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> 
        <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> 
        <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The selected attribute of the Box class has a new name. It is now _selected to indicate that it should not be used directly from outside of the Box class. The private _selected attribute is not initialized to the <strong>false</strong> value, since Boolean variables are by default <strong>false</strong>.</p>

<p><strong>Code 03-04.06</strong>: The private attributes.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// bool default is false.</span>
  <span class='n'>bool</span> <span class='n'>_selected</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_mouseDown</span><span class='o'>;</span>
</code></pre>
</div>
<p>In addition, a new private attribute _mouseDown is defined to keep the mouse down state. A box may be moved only if it is selected and if the mouse is pressed down within the box and kept pressed down while moving the box.</p>

<p><strong>Code 03-04.07</strong>: Mouse down state for moving a box.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='n'>toggleSelection</span><span class='o'>();</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>onMouseUp</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>)</span> 
      <span class='o'>&amp;&amp;</span> <span class='n'>_mouseDown</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The selection methods from the previous spiral are now condensed into 4 lines of code.</p>

<p><strong>Code 03-04.08</strong>: The shorthand notation for selection and string methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>select</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>deselect</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>toggleSelection</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>_selected</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isSelected</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span><span class='o'>;</span>
  
  <span class='n'>String</span> <span class='nf'>toString</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='err'>&#39;</span><span class='n'>$title$titleNo</span> <span class='o'>(</span><span class='n'>$x</span><span class='o'>,</span> <span class='n'>$y</span><span class='o'>)</span><span class='err'>&#39;</span><span class='o'>;</span>
</code></pre>
</div>
<p>Similarly, the toString method of the Box class returns the text by combining values of the four variables into a title, which is then used in the fillText method.</p>

<p><strong>Code 03-04.09</strong>: The box title with coordinates.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='s'>&quot;bold &quot;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='s'>&quot;px sans-serif&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textAlign</span> <span class='o'>=</span> <span class='s'>&quot;start&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textBaseline</span> <span class='o'>=</span> <span class='s'>&quot;top&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>toString</span><span class='o'>(),</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The canvas size is increased to 800 by 600 pixels in the mb.html file. This increase allows for more boxes to be drawn on the board.</p>

<p><strong>Code 03-04.10</strong>: The increased canvas size.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;800&quot;</span> <span class='na'>height=</span><span class='s'>&quot;600&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
</code></pre>
</div>
<p>In addition to a title with the sequential number and (x, y) coordinates, each new box has 4 items displayed in the second section of the box. Item names are, for the time being, the same in all boxes (Figure 03-04.03).</p>

<p><img src='/img/s03s04/BoxesWithItems.png' alt='Alt Figure 03-04.03: Boxes with items' /></p>

<p><strong>Figure 03-04.03</strong>: Boxes with items.</p>

<p>The new item attribute is initialized to the “Item” value.</p>

<p><strong>Code 03-04.11</strong>: Item preparations.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>SSS</span> <span class='o'>=</span> <span class='mi'>6</span><span class='o'>;</span> <span class='c1'>// selection square size</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>TBH</span> <span class='o'>=</span> <span class='mi'>20</span><span class='o'>;</span> <span class='c1'>// title box height</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>TOS</span> <span class='o'>=</span> <span class='mi'>4</span><span class='o'>;</span> <span class='c1'>// text offset size</span>
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>IOS</span> <span class='o'>=</span> <span class='n'>TBH</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>;</span> <span class='c1'>// item offset size</span>
  <span class='err'>…</span>
  <span class='n'>String</span> <span class='n'>item</span> <span class='o'>=</span> <span class='s'>&quot;Item&quot;</span><span class='o'>;</span>
</code></pre>
</div>
<p>The IOS constant is used to draw the four items properly.</p>

<p><strong>Code 03-04.12</strong>: Item drawing.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>font</span> <span class='o'>=</span> <span class='s'>&quot;bold &quot;</span> <span class='o'>+</span> <span class='n'>textFontSize</span> <span class='o'>+</span> <span class='s'>&quot;px sans-serif&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textAlign</span> <span class='o'>=</span> <span class='s'>&quot;start&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>textBaseline</span> <span class='o'>=</span> <span class='s'>&quot;top&quot;</span><span class='o'>;</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>toString</span><span class='o'>(),</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span> <span class='o'>+</span> <span class='mi'>1</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span><span class='o'>,</span> 
      <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span> <span class='o'>+</span> <span class='mi'>2</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='n'>IOS</span><span class='o'>,</span> 
      <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span> <span class='o'>+</span> <span class='mi'>3</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='mi'>2</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span>
      <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span><span class='n'>item</span> <span class='o'>+</span> <span class='mi'>4</span><span class='o'>,</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>TOS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>TOS</span> <span class='o'>+</span> <span class='n'>TBH</span> <span class='o'>+</span> <span class='mi'>3</span> <span class='o'>*</span> <span class='n'>IOS</span><span class='o'>,</span> 
      <span class='n'>width</span> <span class='o'>-</span> <span class='n'>TOS</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>When a selected box is moved over another selected box, its movement is stopped to prevent the moving box to become a monster. This is accomplished by using the countSelectedBoxesThatContain method (Code 03-04.13) of the Board class in the onMouseMove method (Code 03-04.14) of the Box class.</p>

<p><strong>Code 03-04.13</strong>: Counting selected boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>int</span> <span class='nf'>countSelectedBoxesThatContain</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>px</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>py</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>px</span><span class='o'>,</span> <span class='n'>py</span><span class='o'>))</span> <span class='n'>count</span><span class='o'>++;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The countSelectedBoxesThatContain method counts the number of selected boxes that contain a given point. This point becomes the event offset in the onMouseMove method. If there is no other selected box that contains the same point, the current box is moved freely.</p>

<p><strong>Code 03-04.14</strong>: Selected boxes counted.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>ex</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>;</span> 
    <span class='kt'>int</span> <span class='n'>ey</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>ex</span><span class='o'>,</span> <span class='n'>ey</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> <span class='n'>isSelected</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> <span class='n'>_mouseDown</span> 
        <span class='o'>&amp;&amp;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>countSelectedBoxesThatContain</span><span class='o'>(</span><span class='n'>ex</span><span class='o'>,</span> <span class='n'>ey</span><span class='o'>)</span> <span class='o'>&lt;</span> <span class='mi'>2</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span>  <span class='n'>ex</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>ey</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>However, if there is another selected box that contains the same mouse event point, the current box cannot move over the other box in order to prevent that the two boxes overlap each other and move together as one (Figure 03-04.04).</p>

<p><img src='/img/s03s04/TwoSelectedBoxes.png' alt='Alt Figure 03-04.04: Two selected boxes cannot overlap each other' /></p>

<p><strong>Figure 03-04.04</strong>: Two selected boxes cannot overlap each other.</p>
        <em>Posted on 07 February 2012</em>
    
        <h2><a href="/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 02, three boxes may be moved within the board. In Spiral 03, a box may be created by clicking on an empty space in the board, selected and then moved.</p>

<p>In order to create many boxes, the <a href='http://api.dartlang.org/dart_core/List.html'>List</a> data structure is added to the Board class as a new attribute. List is a part of the Collection library of Dart that includes different ways to organize data. List is an indexable collection of objects that may be sorted. In our example (Code 02-03.01), the List has the Box class as a parameter. As a consequence, the boxes attribute may accept only objects of the Box class.</p>

<p><strong>Code 02-03.01</strong>: The boxes attribute of the List type.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
    
  <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>INTERVAL</span> <span class='o'>=</span> <span class='mi'>10</span><span class='o'>;</span> <span class='c1'>// ms</span>
 
  <span class='kt'>int</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span><span class='o'>;</span>
  
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span><span class='o'>;</span>
  
  <span class='n'>List</span><span class='o'>&lt;</span><span class='n'>Box</span><span class='o'>&gt;</span> <span class='n'>boxes</span><span class='o'>;</span>
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
    <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='n'>boxes</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>List</span><span class='o'>();</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseDown</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseDown</span><span class='o'>);</span>
    <span class='c1'>// Redraw every INTERVAL ms.</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>window</span><span class='o'>.</span><span class='na'>setInterval</span><span class='o'>(</span><span class='n'>redraw</span><span class='o'>,</span> <span class='n'>INTERVAL</span><span class='o'>);</span>
  <span class='o'>}</span>
  <span class='err'>…</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The boxes attribute is created in the constructor of the Board class. After the creation, the list of boxes is empty. A new box will be created by clicking on the board. This event will be implemented by the onMouseDown method (Code 02-03.02) of the Board class. This method is added to the on mouse down events of the document object. Thus, the document is a listener of events. When a mouse down event happens, a listener of that event is informed by Dart and the registered (added) method is executed by Dart with the event argument (of the MouseEvent type) prepared by Dart.</p>

<p><strong>Code 02-03.02</strong>: The onMouseDown method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Create a box in the position of the mouse click on the board.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>100</span><span class='o'>);</span>
    <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A new box created by the constructor of the Box class is added to the boxes attribute. The add method belongs to the <a href='http://api.dartlang.org/dart_core/List.html'>List interface</a>. An interface is a type that defines what methods a class, which implements the interface, provides. All types in Dart are either interfaces or classes. The redraw method is changed to traverse (iterate over) the list of created boxes and to display all of them (Figure 02-03.01).</p>

<p><img src='/img/s02s03/CreatedBoxes.png' alt='Alt Figure 02-03.01: Creating boxes by clicking on the board' /></p>

<p><strong>Figure 02-03.01</strong>: Creating boxes by clicking on the board.</p>

<p>The iteration is done by the <strong>for</strong> loop (statement). Each box of the Box type in the boxes attribute is visited and then drawn.</p>

<p><strong>Code 02-03.03</strong>: The redraw method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>redraw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>clear</span><span class='o'>();</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>box</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>If a Web browser does not support the canvas element of HTML5, the message about that fact will be displayed. The message is placed between the opening and closing canvas tags.</p>

<p><strong>Code 02-03.04</strong>: A canvas message if canvas is not supported by a browser.</p>
<div class='highlight'><pre><code class='html'>      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;600&quot;</span> <span class='na'>height=</span><span class='s'>&quot;400&quot;</span><span class='nt'>&gt;</span>
        Canvas is not supported in your browser.
      <span class='nt'>&lt;/canvas&gt;</span>
</code></pre>
</div>
<p>A new box may be created only if a user clicks on an empty space on the board. This check is done by traversing boxes and verifying if the event’s click is done within an existing box. If so, the <strong>for</strong> iteration is interrupted by the <strong>break</strong> statement and the execution of the code is continued immediately after the <strong>for</strong> loop. The negation symbol (!) is used to switch the Boolean (bool) value of the clickedOnExistingBox variable. If that variable is <strong>false</strong>, and it is false only if no box was clicked on, the switch will produce <strong>true</strong>, which will allow the new box to be added to the boxes attribute.</p>

<p><strong>Code 02-03.05</strong>: A new box cannot be created by clicking on an existing box.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Create a box in the position of the mouse click on the board, </span>
  <span class='c1'>// but not on an existing box.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>100</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnExistingBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The isPointInside method of the Box class is renamed to the contains verb in order to provide smother reading of the code. It is more natural to ask if a box contains a point than to state if a point, which is represented as a pair of x and y arguments, is inside a box.</p>

<p><strong>Code 02-03.06</strong>: The contains method of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>contains</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>px</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>py</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>px</span> <span class='o'>&gt;</span> <span class='n'>x</span> <span class='o'>&amp;&amp;</span> <span class='n'>px</span> <span class='o'>&lt;</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>py</span> <span class='o'>&gt;</span> <span class='n'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>py</span> <span class='o'>&lt;</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>))</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>If, during a new box creation, a mouse click is close to the west or to the south border of the board (or even outside the border), so that the new box would be positioned outside the border, its position is brought back to the board. The mouse event object has the offset attributes that position a mouse click with respect to the canvas object. In order to understand better a difference between x and y of a box and different positions of a mouse event, display different points within a box, but only after increasing the box size.</p>

<p><strong>Code 02-03.07</strong>: A new box stays within the board on the west or south side.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>100</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>clickedOnExistingBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnExistingBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> 
        <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
      <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>A new box, by default, is not selected. The Box class has a new attribute called selected, which is initialized to the <strong>false</strong> value.</p>

<p>A box may be selected by clicking on it and releasing the mouse. The selection event will be implemented by the onMouseUp method of the Box class. This method is added to the on mouse up events of the document object.</p>

<p><strong>Code 02-03.08</strong>: The selected attribute and the constructor with event registrations.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='n'>selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseMove</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseMove</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseUp</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseUp</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The onMouseUp method checks if the box contains the point of the click and if so, a value of the selected property is changed by the negation symbol.</p>

<p><strong>Code 02-03.09</strong>: The onMouseUp method of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseUp</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='n'>selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>selected</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The redraw method of the Board class displays all boxes, selected or not (Figure 02-03.02). The actual drawing of each box is delegated to the draw method of the Box class.</p>

<p><img src='/img/s02s03/SelectedBoxes.png' alt='Alt Figure 02-03.02: Selected box with selection rectangles' /></p>

<p><strong>Figure 02-03.02</strong>: Selected box with selection rectangles.</p>

<p>It is the draw method of the Box class that checks if a box is selected. If selected, small rectangles are positioned in each corner of the box (Code 02-03.10).</p>

<p><strong>Code 02-03.10</strong>: The selection rectangles.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>selected</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>6</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>6</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>,</span> <span class='mi'>6</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The draw method uses the number 6 many times. This number represents the size of a selection rectangle in pixels. If we want to change the size from 6 to 8 pixels, we will need to change it many times. Thus, the SSS constant is declared at the beginning of the Box class (Code 02-03.11). It is recommended by <a href='http://www.dartlang.org/articles/style-guide/'>Dart Style Guide</a> that a constant name is in capital letters.</p>

<p><strong>Code 02-03.11</strong>: The SSS constant.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>SSS</span> <span class='o'>=</span> <span class='mi'>6</span><span class='o'>;</span> <span class='c1'>// selection square size</span>
  
  <span class='err'>…</span>
  
  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>selected</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The constant has the <strong>final</strong> keyword, which forbids a change of its value. The <strong>static</strong> keyword indicates that the constant value is not repeated with each new box as is the case with regular attributes. The constant definition exists only at the class level and not at the level of objects.</p>

<p>Only selected boxes may be moved now.</p>

<p><strong>Code 02-03.12</strong>: Is box selected?</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>selected</span> <span class='o'>&amp;&amp;</span> <span class='n'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The board attribute of the Box class references the parent object of a box. It is important to be able to have access to the board object from a box (the board argument is provided in the Board class to the Box constructor), so that the attributes and methods of the Board class are reachable within the Box class. This is how a box is drawn – the context of the board is used to draw rectangles. The parent of a box is the board, one and only board where boxes are created, selected and moved. This parent will not be changed and the <strong>final</strong> keyword underlines that fact.</p>

<p><strong>Code 02-03.13</strong>: The <strong>final</strong> board.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='kd'>static</span> <span class='kd'>final</span> <span class='n'>SSS</span> <span class='o'>=</span> <span class='mi'>6</span><span class='o'>;</span> <span class='c1'>// selection square size</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
</code></pre>
</div>
<p>The selected attribute of the Box class has four corresponding methods that show how this attribute may be changed and used. These methods carry more action oriented meaning than the attribute itself.</p>

<p><strong>Code 02-03.14</strong>: The corresponding methods of the selected attribute.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deselect</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>toggleSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>selected</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='n'>bool</span> <span class='nf'>isSelected</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>return</span> <span class='n'>selected</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The draw method of the Box class uses now the isSelected method.</p>

<p><strong>Code 02-03.15</strong>: The corresponding methods of the selected attribute.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>,</span> <span class='n'>SSS</span><span class='o'>);</span>
    <span class='o'>}</span> 
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the same way, the onMouseMove method of the Box class uses the isSelected method and not the selected attribute.</p>

<p>The onMouseUp method of the Box class uses the toggleSelection method.</p>

<p><strong>Code 02-03.16</strong>: The use of the toggleSelection method.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseUp</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='n'>toggleSelection</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The onMouseDown method is added to the on mouse down events of the document object.</p>

<p><strong>Code 02-03.17</strong>: Mouse events.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseDown</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseDown</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseUp</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseUp</span><span class='o'>);</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseMove</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseMove</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>However, the method body is put under the comment to allow you to easily explore differences between events.</p>

<p><strong>Code 02-03.18</strong>: The onMouseDown method of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='c1'>// if (contains(event.offsetX, event.offsetY)) toggleSelection();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>What happened to that bad habit of eating boxes by moving monsters?</p>
        <em>Posted on 02 February 2012</em>
    
        <h2><a href="/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps. For example, to explain a transition from Spiral 01 to Spiral 02 (01-02), the transition is decomposed into small changes (01, 02, &#8230;).</p>

<p>In Spiral 01, two static boxes were displayed on the board. In Spiral 02, three boxes may be moved within the board.</p>

<p>The document global variable represents the HTML page. The page is part of a window. Thus, from the document objet, the window object may be reached (document.window). The setInterval method on the window object defines what method will be run (the first argument) and how frequently (the second argument). This means that the redraw method of the Board class will be called every 10 milliseconds (ms).</p>

<p><strong>Code 01-02.01</strong>: Interval.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
    <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='n'>init</span><span class='o'>();</span>
    <span class='c1'>// Redraw every 10 ms.</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>window</span><span class='o'>.</span><span class='na'>setInterval</span><span class='o'>(</span><span class='n'>redraw</span><span class='o'>,</span> <span class='mi'>10</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the Box class, a mouse move event is defined. The event is detailed in the onMouseMove method.</p>

<p><strong>Code 01-02.02</strong>: Destination of the mouse move event.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>;</span>
    <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The method is added in the constructor of the Box class to the document.on.mouseMove object. The mouse move event will be watched by the document and the onMouseMove method will be executed with each move of the mouse.</p>

<p><strong>Code 01-02.03</strong>: Source of the mouse move event.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>mouseMove</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>onMouseMove</span><span class='o'>);</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The onMouseMove method has the event parameter, of the MountEvent class, which is supplied by Dart. The offsetX attribute of the event object gives an x coordinate of the mouse. The offset is calculated relative to the x = 0 coordinate of the board (canvas) object. The offset attribute of the event object gives a y coordinate of the mouse. The offset is calculated relative to the y = 0 coordinate of the board (canvas) object. With each mouse move, one of boxes will change its position with the update of its x and y coordinates (the attributes of the Box class). Since the board will be redrawn very quickly, each new position of the same box will appear as a new box (Figure 01-02.01).</p>

<p><img src='/img/s01s02/ManyBoxes.png' alt='Alt Figure 01-02.01: “Many” boxes' /></p>

<p><strong>Figure 01-02.01</strong>: “Many” boxes.</p>

<p>In order to show only new positions of boxes, the board must be cleared from the previous positions. Note that there are now three boxes (two horizontal boxes and one vertical box) on the board.</p>

<p><strong>Code 01-02.04</strong>: Clearing the board.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='kt'>int</span> <span class='n'>INTERVAL</span> <span class='o'>=</span> <span class='mi'>10</span><span class='o'>;</span> <span class='c1'>// ms</span>
 
  <span class='kt'>int</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span><span class='o'>;</span>
  
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span><span class='o'>;</span>
  
  <span class='n'>Box</span> <span class='n'>box1</span><span class='o'>;</span>
  <span class='n'>Box</span> <span class='n'>box2</span><span class='o'>;</span>
  <span class='n'>Box</span> <span class='n'>box3</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
    <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='n'>init</span><span class='o'>();</span>
    <span class='c1'>// Redraw every INTERVAL ms.</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>window</span><span class='o'>.</span><span class='na'>setInterval</span><span class='o'>(</span><span class='n'>redraw</span><span class='o'>,</span> <span class='n'>INTERVAL</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>init</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>box1</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>80</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
    <span class='n'>box2</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='mi'>120</span><span class='o'>,</span> <span class='mi'>220</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>80</span><span class='o'>);</span>
    <span class='n'>box3</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>80</span><span class='o'>,</span> <span class='mi'>80</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>border</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>clear</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>clearRect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>border</span><span class='o'>();</span>
  <span class='o'>}</span> 
  
  <span class='kt'>void</span> <span class='nf'>redraw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>clear</span><span class='o'>();</span> 
    <span class='n'>box1</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
    <span class='n'>box2</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
    <span class='n'>box3</span><span class='o'>.</span><span class='na'>draw</span><span class='o'>();</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The clear method clears the rectangle that is occupied by the context of the canvas, and the border is drawn again. The clear method is called in the redraw method before the three boxes are drawn. The interval of redrawing the board is still 10 ms, but it is defined at the beginning of the Board class as the <strong>final</strong> integer. The final value cannot be changed, representing a constant. A name of a constant is expressed in capital letters. The INTERVAL constant, with the value of 10, is used in the setInterval method.</p>

<p>When the code is run in the Chrome browser, one of horizontal boxes is “eaten” by the other horizontal box, and the vertical box is captured as a prisoner of the two horizontal boxes.</p>

<p>The isPointInside method returns <strong>true</strong>, if the (x, y) point is inside the current box.</p>

<p><strong>Code 01-02.05</strong>: Is point inside of the current box?</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>isPointInside</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>px</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>py</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>px</span> <span class='o'>&gt;</span> <span class='n'>x</span> <span class='o'>&amp;&amp;</span> <span class='n'>px</span> <span class='o'>&lt;</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> <span class='o'>(</span><span class='n'>py</span> <span class='o'>&gt;</span> <span class='n'>y</span> <span class='o'>&amp;&amp;</span> <span class='n'>py</span> <span class='o'>&lt;</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>height</span><span class='o'>))</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Boolean method checks if a position of the mouse is inside the box of interest, and only then the box will “move”. However, the box may be moved only down and right.</p>

<p><strong>Code 01-02.06</strong>: Is mouse inside of the current box?</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isPointInside</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The new position of the current box will be now in the middle of the box. This allows a user to move the box also up and left. However, the box may be moved outside the board.</p>

<p><strong>Code 01-02.07</strong>: Box center.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isPointInside</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The upper left corner of a box (x, y) is displayed close to that corner, so that you can check the exact positions of boxes (Figure 01-02.02) .</p>

<p><img src='/img/s01s02/xyDisplayed.png' alt='Alt Figure 01-02.02: (x, y) displayed.' /></p>

<p><strong>Figure 01-02.02</strong>: (x, y) displayed.</p>

<p><strong>Code 01-02.08</strong>: x, y displayed in the upper left corner.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>fillText</span><span class='o'>(</span>
      <span class='n'>x</span><span class='o'>.</span><span class='na'>toString</span><span class='o'>()</span> <span class='o'>+</span> <span class='sc'>&#39;,&#39;</span> <span class='o'>+</span> <span class='n'>y</span><span class='o'>.</span><span class='na'>toString</span><span class='o'>(),</span> <span class='n'>x</span> <span class='o'>+</span> <span class='mi'>1</span><span class='o'>,</span> <span class='n'>y</span> <span class='o'>+</span> <span class='mi'>10</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In order to keep boxes inside the board, a new position of the current box is brought back to the board, if it was found outside the board.</p>

<p><strong>Code 01-02.09</strong>: Back to board.</p>
<div class='highlight'><pre><code class='java'>  <span class='c1'>// Change a position of the box with mouse mouvements.</span>
  <span class='kt'>void</span> <span class='nf'>onMouseMove</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>event</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isPointInside</span><span class='o'>(</span><span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>x</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='n'>y</span> <span class='o'>=</span> <span class='n'>event</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>1</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Since there is only one statement in the body of ifs inside the outer if of the onMouseMove method, there is no need to use {}.</p>

<p>Explain what happens if the following code is used instead.</p>

<p><strong>Code 01-02.10</strong>: Different coordinates.</p>
<div class='highlight'><pre><code class='java'>      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>)</span> <span class='n'>x</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='n'>width</span><span class='o'>;</span>
      <span class='err'>…</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&lt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>)</span> <span class='n'>y</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='n'>height</span><span class='o'>;</span>
</code></pre>
</div>
        <em>Posted on 31 January 2012</em>
    
        <h2><a href="/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a></h2>
        <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. You can execute the code by selecting the spiral number in the MagicBoxes menu at the beginning of the post.</p>

<p>In Spiral 00, the code was generated by Dart Editor. The &#8220;Hello World!&#8221; text is displayed in a web page. In Spiral 01, the code from Spiral 00 is changed to display two rectangles (boxes).</p>

<p>The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several sub-spirals. For example, to explain a transition from Spiral 00 to Spiral 01 (00-01), the transition is decomposed into small changes (01, 02, &#8230;).</p>

<p><strong>Code 00-01.01</strong>: mb.dart from Spiral 00.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='kd'>class</span> <span class='nc'>mb</span> <span class='o'>{</span>

  <span class='n'>mb</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>run</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>write</span><span class='o'>(</span><span class='s'>&quot;Hello World!&quot;</span><span class='o'>);</span>
  <span class='o'>}</span><span class='nl'>http:</span><span class='c1'>//dzenanr.github.com/</span>

  <span class='kt'>void</span> <span class='nf'>write</span><span class='o'>(</span><span class='n'>String</span> <span class='n'>message</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='c1'>// the HTML library defines a global &quot;document&quot; variable</span>
    <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>status</span><span class='err'>&#39;</span><span class='o'>).</span><span class='na'>innerHTML</span> <span class='o'>=</span> <span class='n'>message</span><span class='o'>;</span>
  <span class='o'>}</span>
<span class='o'>}</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='k'>new</span> <span class='nf'>mb</span><span class='o'>().</span><span class='na'>run</span><span class='o'>();</span>
<span class='o'>}</span>
</code></pre>
</div>
<p><strong>Code 00-01.02</strong>: mb.html from Spiral 00.</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;html&gt;</span>
  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
  <span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;h1&gt;</span>mb<span class='nt'>&lt;/h1&gt;</span>
    <span class='nt'>&lt;h2</span> <span class='na'>id=</span><span class='s'>&quot;status&quot;</span><span class='nt'>&gt;</span>dart is not running<span class='nt'>&lt;/h2&gt;</span>
    <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre>
</div>
<p>The generated code displays the “Hello World!” message in a web page (Figure 00-01.01).</p>

<p><img src='/img/s00s01/HelloWorld.png' alt='Alt Figure 00-01.01: Hello World!' /></p>

<p><strong>Figure 00-01.01</strong>: Hello World!</p>

<p>This code was a starting point for producing Spiral 01 (Figure 00-01.02).</p>

<p><img src='/img/s00s01/TwoBoxes.png' alt='Alt Figure 00-01.02: Two static boxes.' /></p>

<p><strong>Figure 00-01.02</strong>: Two static boxes.</p>

<p>Here, the changes from Spiral 00 to Spiral 01 will be presented as sub-spirals.</p>

<p>The first change is the simplification of the main method.</p>

<p><strong>Code 00-01.03</strong>: The minimal main method.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s00.s01</span>

<span class='c1'>// Use Ctrl-Shift-J in Chrome to see the Console with the printed text.</span>

<span class='n'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='n'>print</span><span class='o'>(</span><span class='err'>&#39;</span><span class='n'>Hello</span> <span class='n'>mb</span><span class='err'>&#39;</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The main method does not have any parameters. The print function belongs to the dart:core library. It prints a text given as the argument of the function to the Console of the Chrome browser. The console is opened by using the Ctrl-Shift-J keys.</p>

<p><strong>Code 00-01.04</strong>: The minimal html code.</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;html&gt;</span>
  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
  <span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;h1&gt;</span>mb<span class='nt'>&lt;/h1&gt;</span>
    <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
  <span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre>
</div>
<p>Note that the JavaScript file name is now mb.dart.app.js.</p>

<p>The next step is to modify both mb.dart and mb.html to add to the main function the code for drawing a border and two boxes.</p>

<p><strong>Code 00-01.05</strong>: Drawings in the main method.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>
<span class='c1'>// s01.s00</span>

<span class='n'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>var</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='n'>var</span> <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
  <span class='n'>var</span> <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
  <span class='n'>var</span> <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
  <span class='c1'>// border</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
  <span class='c1'>// box 1</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
  <span class='c1'>// box 2</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The main function first finds the canvas element in the html page and converts it into a variable with the canvas name. The getContext method on the canvas object (object.method) returns a two dimensional context of the canvas. The width and height variables are initialized to the corresponding values of the canvas object, which are defined in mb.html.</p>

<p><strong>Code 00-01.06</strong>: Width and height of canvas.</p>
<div class='highlight'><pre><code class='html'><span class='nt'>&lt;html&gt;</span>
  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
  
  <span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;header&gt;</span>
        <span class='nt'>&lt;h2&gt;</span>Two Boxes<span class='nt'>&lt;/h2&gt;</span>
      <span class='nt'>&lt;/header&gt;</span>
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;600&quot;</span> <span class='na'>height=</span><span class='s'>&quot;400&quot;</span><span class='nt'>&gt;&lt;/canvas&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
  <span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre>
</div>
<p>A border is prepared to be drawn by the rect method as a rectangle with its relative position with respect to canvas at the (x, y) point, and its size equal to the size of canvas. Two boxes are prepared in the similar way. The drawing is defined between the beginPath and closePath methods. The actual drawing is done by the stroke method.</p>

<p>The next change is to introduce types of variables, or more precisely classes of objects. Types are useful in Dart Editor. When they are used, after the current object and the dot after it, Dart Editor offers a list of possible methods.</p>

<p><strong>Code 00-01.07</strong>: Types (classes).</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s01.s01</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
  <span class='kt'>int</span> <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
  <span class='c1'>// border</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
  <span class='c1'>// box 1</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
  <span class='c1'>// box 2</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The CanvasElement class defines a canvas. The CanvasRenderingContext2D class defines a two-dimensional context of canvas. The int class represents integer values. The main method delegates its work to methods of the CanvasRenderingContext2D class. However, it does not return a value or an object of a class, which is pointed out by the void keyword.</p>

<p>The main method is used as the entry point for the code execution. In general, it should be made short by delegating work to other functions.</p>

<p><strong>Code 00-01.08</strong>: Function.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s01.s02</span>

<span class='kt'>void</span> <span class='nf'>displayBoxes</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
  <span class='kt'>int</span> <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
  <span class='c1'>// border</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
  <span class='c1'>// box 1</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
  <span class='c1'>// box 2</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
<span class='o'>}</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='n'>displayBoxes</span><span class='o'>(</span><span class='n'>canvas</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>After the canvas object is obtained, it is passed as an argument to the displayBoxes function.</p>

<p>The next step is to keep one objective for each function.</p>

<p><strong>Code 00-01.09</strong>: Functions.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s01.s03</span>

<span class='kt'>void</span> <span class='nf'>displayBoxes</span><span class='o'>(</span><span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span><span class='o'>)</span> <span class='o'>{</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
<span class='o'>}</span>

<span class='kt'>void</span> <span class='nf'>displayBord</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
  <span class='kt'>int</span> <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
  <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='n'>displayBoxes</span><span class='o'>(</span><span class='n'>context</span><span class='o'>);</span>
<span class='o'>}</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='n'>displayBord</span><span class='o'>(</span><span class='n'>canvas</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>The objective of the main function is to obtain canvas and to delegate drawings to the displayBord function. The objective of the displayBord function is to draw a border and to delegate drawings of boxes to the displayBoxes function.</p>

<p>Up to now, our code consists of functions. The same can be accomplished by defining the Board class that will handle drawings. The class is defined within Dart Editor by using the File menu and the New File… menu item. The new file is named Border.dart. By doing this, Dart Editor adds the #source(‘Board.dart’); to the mb.dart file.</p>

<p>The main method of mb.dart creates a board as an object of the Board class. This is accomplished by using the new keyword and by the constructor method of the Board class.</p>

<p><strong>Code 00-01.10</strong>: The main function creates an object of the Board class.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>
<span class='err'>#</span><span class='n'>source</span><span class='o'>(</span><span class='err'>&#39;</span><span class='n'>Board</span><span class='o'>.</span><span class='na'>dart</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s01.s04</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='k'>new</span> <span class='nf'>Board</span><span class='o'>(</span><span class='n'>canvas</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre>
</div>
<p><strong>Code 00-01.11</strong>: The Board class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  
  <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span><span class='o'>;</span>
  
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
    <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='n'>init</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>init</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>border</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>Conceptually, the Board class represents a place where boxes will be drawn. Its constructor accepts a canvas object of the CanvasElement class. The getContext method of the CanvasElement class applied to the canvas object returns a two dimensional context of the canvas. This context is an attribute (or a field) of the Board class. While methods represent operations, attributes stand for data. Other attributes of the Board class are x, y, width and height. Their values are of the int (integer) type. The x and y attributes are initialized to zero, while the values of the width and height attributes are obtained from the corresponding attributes of the canvas object.</p>

<p>At the end of the construction process, a border of the board is drawn with the border method. Finally, the board is initialized with two boxes drawn by the init method. Methods of the class have a direct access to attributes of the class.</p>

<p>The HTML document is declared to be of the html type. The simple DOCTYPE syntax is introduced by HML5. Two meta elements in the head element, define a character set as utf-8, and an author of the page as Dzenan Ridjanovic. The body element has now the header element that displays the title of the page, in addition to the title of the section where canvas is placed.</p>

<p><strong>Code 00-01.12</strong>: The HTML file.</p>
<div class='highlight'><pre><code class='html'><span class='cp'>&lt;!DOCTYPE html&gt;</span>

<span class='nt'>&lt;html&gt;</span>
  <span class='nt'>&lt;head&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>charset=</span><span class='s'>&quot;utf-8&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;meta</span> <span class='na'>name=</span><span class='s'>&quot;author&quot;</span> <span class='na'>content=</span><span class='s'>&quot;Dzenan Ridjanovic&quot;</span><span class='nt'>/&gt;</span>
    <span class='nt'>&lt;title&gt;</span>mb<span class='nt'>&lt;/title&gt;</span>
  <span class='nt'>&lt;/head&gt;</span>
  
  <span class='nt'>&lt;body&gt;</span>
    <span class='nt'>&lt;header&gt;</span>
      <span class='nt'>&lt;h1&gt;</span>Magic Boxes in Dart<span class='nt'>&lt;/h1&gt;</span>
    <span class='nt'>&lt;/header&gt;</span>
    
    <span class='nt'>&lt;section&gt;</span> 
      <span class='nt'>&lt;header&gt;</span>
        <span class='nt'>&lt;h2&gt;</span>Two Boxes<span class='nt'>&lt;/h2&gt;</span>
      <span class='nt'>&lt;/header&gt;</span>
      <span class='nt'>&lt;canvas</span> <span class='na'>id=</span><span class='s'>&quot;canvas&quot;</span> <span class='na'>width=</span><span class='s'>&quot;600&quot;</span> <span class='na'>height=</span><span class='s'>&quot;400&quot;</span><span class='nt'>&gt;&lt;/canvas&gt;</span>
      <span class='nt'>&lt;script </span><span class='na'>type=</span><span class='s'>&quot;text/javascript&quot;</span> <span class='na'>src=</span><span class='s'>&quot;mb.dart.app.js&quot;</span><span class='nt'>&gt;&lt;/script&gt;</span>
    <span class='nt'>&lt;/section&gt;</span>
  <span class='nt'>&lt;/body&gt;</span>
<span class='nt'>&lt;/html&gt;</span>
</code></pre>
</div>
<p>Finally, the Box.dart file is created by using the File menu and the New File… menu item.</p>

<p><strong>Code 00-01.13</strong>: The Box class.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Box</span> <span class='o'>{</span>
  
  <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='kt'>int</span> <span class='n'>x</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>y</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span><span class='o'>;</span>
  
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>draw</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The constructor method of the Box class accepts five arguments that are assigned automatically to the corresponding attributes of the class. The this keyword represents the current object of the Box class, and its use as a qualifier of the five parameters indicates the assignment shortcut. A box is drawn by the draw method. The five attributes are used to accomplish the drawing task.</p>

<p>The init method of the Board class constructs two boxes.</p>

<p><strong>Code 00-01.14</strong>: Construction of two boxes.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>Board</span> <span class='o'>{</span>
  
  <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>width</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>height</span><span class='o'>;</span>
  
  <span class='n'>CanvasRenderingContext2D</span> <span class='n'>context</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>context</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>getContext</span><span class='o'>(</span><span class='s'>&quot;2d&quot;</span><span class='o'>);</span>
    <span class='n'>width</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>width</span><span class='o'>;</span>
    <span class='n'>height</span> <span class='o'>=</span> <span class='n'>canvas</span><span class='o'>.</span><span class='na'>height</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='n'>init</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>init</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>new</span> <span class='nf'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>20</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>);</span>
    <span class='k'>new</span> <span class='nf'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='mi'>120</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>,</span> <span class='mi'>60</span><span class='o'>,</span> <span class='mi'>40</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>border</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The main method adds a redundant object. Since the board object is not used further in the main method, there was no reason to introduce it.</p>

<p><strong>Code 00-01.15</strong>: Box source.</p>
<div class='highlight'><pre><code class='java'><span class='err'>#</span><span class='n'>import</span><span class='o'>(</span><span class='err'>&#39;</span><span class='nl'>dart:</span><span class='n'>html</span><span class='err'>&#39;</span><span class='o'>);</span>
<span class='err'>#</span><span class='n'>source</span><span class='o'>(</span><span class='err'>&#39;</span><span class='n'>Board</span><span class='o'>.</span><span class='na'>dart</span><span class='err'>&#39;</span><span class='o'>);</span>
<span class='err'>#</span><span class='n'>source</span><span class='o'>(</span><span class='err'>&#39;</span><span class='n'>Box</span><span class='o'>.</span><span class='na'>dart</span><span class='err'>&#39;</span><span class='o'>);</span>

<span class='c1'>// s01.s05</span>

<span class='kt'>void</span> <span class='nf'>main</span><span class='o'>()</span> <span class='o'>{</span>
  <span class='c1'>// Get a reference to the canvas.</span>
  <span class='n'>CanvasElement</span> <span class='n'>canvas</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>canvas</span><span class='err'>&#39;</span><span class='o'>);</span>
  <span class='n'>Board</span> <span class='n'>board</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Board</span><span class='o'>(</span><span class='n'>canvas</span><span class='o'>);</span>
<span class='o'>}</span>
</code></pre>
</div>
<p>Even if the Box class is not used directly by the main method, its source is added by Dart Editor.</p>
        <em>Posted on 23 January 2012</em>
    
        <h2><a href="/2012/01/14/first-post.html">First Post</a></h2>
        <p>On this blog I will present my learning and development experience on Dart.</p>
        <em>Posted on 14 January 2012</em>
    
</section>

<section>
    <header>
        <h2>All Posts</h2>
        <!-- -->
    </header>  
    
        <h2><a href="/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a></h2>
        <em>Posted on 07 February 2012</em>
    
        <h2><a href="/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a></h2>
        <em>Posted on 02 February 2012</em>
    
        <h2><a href="/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a></h2>
        <em>Posted on 31 January 2012</em>
    
        <h2><a href="/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a></h2>
        <em>Posted on 23 January 2012</em>
    
        <h2><a href="/2012/01/14/first-post.html">First Post</a></h2>
        <em>Posted on 14 January 2012</em>
    
</section>

        </section>

        <section>
     
        </section>

        <footer>
          <a href="http://dzenanr.github.com/ondart.rss">
            <img src="/img/xml.gif" width=36 height=14 alt="RSS feed for this site" border=0>
          </a>
        </footer>

    </body>
</html>


