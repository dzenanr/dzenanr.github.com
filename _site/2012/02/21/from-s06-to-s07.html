<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="author" content="Dzenan Ridjanovic"/>
        <title>From Spiral06 To Spiral07</title> 
        <link rel="stylesheet" href="/css/code.css"/>  
        <link rel="stylesheet" href="/css/layout.css"/>
        <link rel="stylesheet" href="/css/link.css"/>
        <link rel="stylesheet" href="/css/list.css"/>
        <link rel="stylesheet" href="/css/menu.css"/>
        <link rel="stylesheet" href="/css/page.css"/>
    </head>

    <body>
        <header>  
            <h1>
                <a href="http://www.ondart.info/"><img src="/img/ondartb1.png"/></a>
               From Spiral06 To Spiral07
               <!--  -->
            </h1>
        </header>

        <nav>
            <ul>
                <li>Dart
                    <ul>
                        <li>
                            <a href="http://www.dartlang.org/">Dart</a>
                        </li>
                        <li>
                            <a href="http://try.dartlang.org/">Dart Console</a>
                        </li>
                    </ul>  
                </li>
                <li>Magic Boxes
                    <ul>
                        <li>
                            <a href="http://goo.gl/I72z1">Browse Code</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Design Model</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes">Get Git</a> 
                        </li>
                        <li>
                            <a href="https://github.com/dzenanr/MagicBoxes/tags">Get Spirals</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s00/MagicBoxes/MagicBoxes.html">Spiral 00</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s01/MagicBoxes/MagicBoxes.html">Spiral 01</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s02/MagicBoxes/MagicBoxes.html">Spiral 02</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s03/MagicBoxes/MagicBoxes.html">Spiral 03</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s04/MagicBoxes/MagicBoxes.html">Spiral 04</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s05/MagicBoxes/MagicBoxes.html">Spiral 05</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s06/MagicBoxes/MagicBoxes.html">Spiral 06</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s07/MagicBoxes/MagicBoxes.html">Spiral 07</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s08/MagicBoxes/MagicBoxes.html">Spiral 08</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s09/MagicBoxes/MagicBoxes.html">Spiral 09</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s10/MagicBoxes/MagicBoxes.html">Spiral 10</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s11/MagicBoxes/MagicBoxes.html">Spiral 11</a> 
                        </li>
                        <li>
                            <a href="/mb/spirals/s12/MagicBoxes/MagicBoxes.html">Spiral 12</a> 
                        </li>
                    </ul>  
                </li>
                <li>On Dart
                    <ul>
                        <li>
                            <a href="https://plus.google.com/u/0/b/113649577593294551754/113649577593294551754/posts">Google+ Page</a> 
                        </li>
                    </ul>  
                </li>
                <li>Posts
                    <ul>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/23/from-s00-to-s01.html">From Spiral00 To Spiral01</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/01/31/from-s01-to-s02.html">From Spiral01 To Spiral02</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/02/from-s02-to-s03.html">From Spiral02 To Spiral03</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/07/from-s03-to-s04.html">From Spiral03 To Spiral04</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/10/from-s04-to-s05.html">From Spiral04 To Spiral05</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/15/from-s05-to-s06.html">From Spiral05 To Spiral06</a> 
                        </li>
                        <li>
                            <a href="http://dzenanr.github.com/2012/02/21/from-s06-to-s07.html">From Spiral06 To Spiral07</a> 
                        </li>
                        <li>
                            &nbsp; 
                        </li>
                    </ul>  
                </li>
                <li>About
                    <ul>
                        <li>
                            <a href="http://goo.gl/f1F2e">D. R. (CV in PDF)</a> 
                        </li>
                    </ul>  
                </li>
            </ul>
        </nav>

        <section>
            <p>The code for the MagicBoxes project is at <a href='https://github.com/dzenanr/MagicBoxes'>MagicBoxes on GitHub</a>. The code for the mb project is at <a href='https://github.com/dzenanr/mb'>mb on GitHub</a>. For teaching or learning purposes, each spiral in MagicBoxes is decomposed into several steps in mb.</p>

<p>In Spiral 06, a line tool in the tool bar, allows a line creation between the last two clicked boxes.</p>

<p>In Spiral 07, a line may be selected and deleted. A menu bar has Edit, View and Create menus. The Edit menu has menu items for selecting all boxes and lines, and for deleting selected boxes and lines. The View menu has menu items for hiding and showing selected boxes and lines. The Create menu has menu items for generating boxes in a diagonal and as tiles.</p>

<p>The MenuBar class has a new content with six buttons.</p>

<p><strong>Code 06-07.01</strong>: The MenuBar class with six buttons.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>MenuBar</span> <span class='o'>{</span>
  
  <span class='kd'>final</span> <span class='n'>Board</span> <span class='n'>board</span><span class='o'>;</span>
  
  <span class='c1'>// Edit</span>
  <span class='n'>ButtonElement</span> <span class='n'>selectAllButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>deleteSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// View</span>
  <span class='n'>ButtonElement</span> <span class='n'>hideSelectionButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>showHiddenSelectionButton</span><span class='o'>;</span>
  
  <span class='c1'>// Creaete</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesInDiagonalButton</span><span class='o'>;</span>
  <span class='n'>ButtonElement</span> <span class='n'>createBoxesAsTilesButton</span><span class='o'>;</span>
  
  <span class='n'>MenuBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>selectAllButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>select</span><span class='o'>-</span><span class='n'>all</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>deleteSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>delete</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>hideSelectionButton</span> <span class='o'>=</span> <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>hide</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>showHiddenSelectionButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>show</span><span class='o'>-</span><span class='n'>hidden</span><span class='o'>-</span><span class='n'>selection</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='n'>createBoxesInDiagonalButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>in</span><span class='o'>-</span><span class='n'>diagonal</span><span class='err'>&#39;</span><span class='o'>);</span>
    <span class='n'>createBoxesAsTilesButton</span> <span class='o'>=</span> 
      <span class='n'>document</span><span class='o'>.</span><span class='na'>query</span><span class='o'>(</span><span class='err'>&#39;#</span><span class='n'>create</span><span class='o'>-</span><span class='n'>boxes</span><span class='o'>-</span><span class='n'>as</span><span class='o'>-</span><span class='n'>tiles</span><span class='err'>&#39;</span><span class='o'>);</span>
    
    <span class='c1'>// Menu bar events.</span>
    <span class='n'>selectAllButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>deleteSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>deleteSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>hideSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>hideSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>showHiddenSelectionButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>showHiddenSelection</span><span class='o'>();</span>
    <span class='o'>});</span>
    
    <span class='n'>createBoxesInDiagonalButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesInDiagonal</span><span class='o'>();</span>
    <span class='o'>});</span>
    <span class='n'>createBoxesAsTilesButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>click</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>createBoxesAsTiles</span><span class='o'>();</span>
    <span class='o'>});</span>
  <span class='o'>}</span>

<span class='o'>}</span>
</code></pre>
</div>
<p>The Board class has changed to provide methods used in the MenuBar class. The select method select s boxes only. The line selection will be done in one of the next steps towards the Spiral 07.</p>

<p><strong>Code 06-07.02</strong>: The select method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selectBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>Similarly, the deleteSelection, hideSelection and showHiddenSelection methods do not yet handle selected lines.</p>

<p><strong>Code 06-07.03</strong>: The deleteSelection method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>hideSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>hideSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>showHiddenSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>showHiddenBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The createBoxesInDiagonal method of the Board class generates boxes in a diagonal (Figure 06-07.01). The initialization of the x and y local variables is done in a single line of code. The <strong>while</strong> loop may seem to iterate forever, because its condition to loop is <strong>true</strong>. However, the <strong>false</strong> condition of the <strong>if</strong> statement enters the <strong>else</strong> part and the <strong>return</strong> statement stops the iterations by exiting the method. If the next box may be positioned diagonally within the board, the box is created in that position. The x and y variables are incremented by the two constants from the Box class before the next iteration.</p>

<p><strong>Code 06-07.04</strong>: Boxes created in a diagonal.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxesInDiagonal</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>while</span> <span class='o'>(</span><span class='kc'>true</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span> 
          <span class='o'>&amp;&amp;</span> <span class='n'>y</span> <span class='o'>&lt;=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>;</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><img src='/img/s06s07/BoxesInDiagonal.png' alt='Alt Figure 06-07.01: Five boxes created in a diagonal' /></p>

<p><strong>Figure 06-07.01</strong>: Five boxes created in a diagonal.</p>

<p>The createBoxesAsTiles method of the Board class generates boxes as tiles (Figure 06-07.02). If a new box may be positioned as a tile within the board, the box is created in that position. It is a value of the y variable that determines when the method will be returned to a caller.</p>

<p><strong>Code 06-07.05</strong>: Boxes created as tiles.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>createBoxesAsTiles</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span> <span class='kt'>int</span> <span class='n'>y</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>while</span> <span class='o'>(</span><span class='kc'>true</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>x</span> <span class='o'>&lt;=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='n'>x</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span> <span class='o'>*</span> <span class='mi'>2</span><span class='o'>;</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>x</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
        <span class='n'>y</span> <span class='o'>=</span> <span class='n'>y</span> <span class='o'>+</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span> <span class='o'>*</span> <span class='mi'>2</span><span class='o'>;</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>y</span> <span class='o'>&gt;</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='k'>return</span><span class='o'>;</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p><img src='/img/s06s07/BoxesAsTiles.png' alt='Alt Figure 06-07.02: Twelve boxes created as tiles' /></p>

<p><strong>Figure 06-07.02</strong>: Twelve boxes created as tiles.</p>

<p>The nav element of HTML5 contains an unordered list of items that are menus. Each menu contains another unordered list of items that are menu items.</p>

<p><strong>Code 06-07.06</strong>: The navigation section of HTML5.</p>
<div class='highlight'><pre><code class='html'>    <span class='nt'>&lt;nav&gt;</span>
     <span class='nt'>&lt;ul&gt;</span>
       <span class='nt'>&lt;li&gt;</span>File
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>  
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Edit
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;select-all&quot;</span><span class='nt'>&gt;</span>
               Select All
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;delete-selection&quot;</span><span class='nt'>&gt;</span>
               Delete Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>View
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;hide-selection&quot;</span><span class='nt'>&gt;</span>
               Hide Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;show-hidden-selection&quot;</span><span class='nt'>&gt;</span>
               Show Selection
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>Create
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-in-diagonal&quot;</span><span class='nt'>&gt;</span>
               Boxes in Diagonal
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>
             <span class='nt'>&lt;button</span> <span class='na'>id=</span><span class='s'>&quot;create-boxes-as-tiles&quot;</span><span class='nt'>&gt;</span>
               Boxes As Tiles
             <span class='nt'>&lt;/button&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>
       <span class='nt'>&lt;/li&gt;</span>
       <span class='nt'>&lt;li&gt;</span>About
         <span class='nt'>&lt;ul&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Magic Boxes in 
             <span class='nt'>&lt;a</span> <span class='na'>href=</span><span class='s'>&quot;http://www.dart.org/&quot;</span><span class='nt'>&gt;</span>Dart<span class='nt'>&lt;/a&gt;</span>
           <span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Spiral 07<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>2011-12-23<span class='nt'>&lt;/li&gt;</span>
           <span class='nt'>&lt;li&gt;</span>Dzenan Ridjanovic<span class='nt'>&lt;/li&gt;</span>
         <span class='nt'>&lt;/ul&gt;</span>   
       <span class='nt'>&lt;/li&gt;</span>
     <span class='nt'>&lt;/ul&gt;</span>
    <span class='nt'>&lt;/nav&gt;</span>
</code></pre>
</div>
<p>The menu.css file has selectors that present the navigation section of the mb.html file as a menu bar with menus and drop down menu items.</p>

<p><strong>Code 06-07.07</strong>: CSS presentation of drop down menus.</p>
<div class='highlight'><pre><code class='css'>  <span class='nt'>nav</span> <span class='p'>{</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>100</span><span class='o'>%</span><span class='p'>;</span>
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>30px</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>border-top</span><span class='o'>:</span> <span class='m'>2px</span> <span class='k'>solid</span> <span class='m'>#999999</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>margin</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span> 
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>inline</span><span class='p'>;</span> 
    <span class='k'>height</span><span class='o'>:</span> <span class='m'>30px</span><span class='p'>;</span> 
    <span class='k'>float</span><span class='o'>:</span> <span class='k'>left</span><span class='p'>;</span> 
    <span class='k'>list-style</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>margin-left</span><span class='o'>:</span> <span class='m'>15px</span><span class='p'>;</span>
    <span class='k'>position</span><span class='o'>:</span> <span class='k'>relative</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>ul</span> <span class='nt'>li</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>margin</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>padding-top</span><span class='o'>:</span> <span class='m'>8px</span><span class='p'>;</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>position</span><span class='o'>:</span> <span class='k'>absolute</span><span class='p'>;</span>
    <span class='k'>left</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>top</span><span class='o'>:</span> <span class='m'>20px</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>14px</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span><span class='nd'>:hover</span> <span class='nt'>ul</span> <span class='p'>{</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>block</span><span class='p'>;</span>
    <span class='k'>width</span><span class='o'>:</span> <span class='m'>180px</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='p'>{</span>
    <span class='k'>padding</span><span class='o'>:</span> <span class='m'>0px</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
    <span class='k'>list-style</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>display</span><span class='o'>:</span> <span class='k'>list-item</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:link</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#e6ffc8</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:visited</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#f2e1fb</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>a</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>text-decoration</span><span class='o'>:</span> <span class='k'>none</span><span class='p'>;</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>background</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>button</span> <span class='p'>{</span>
    <span class='k'>color</span><span class='o'>:</span> <span class='m'>#663117</span><span class='p'>;</span>
    <span class='k'>font-size</span><span class='o'>:</span> <span class='m'>14px</span><span class='p'>;</span>
    <span class='k'>font-weight</span><span class='o'>:</span> <span class='k'>bold</span><span class='p'>;</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#ffffff</span><span class='p'>;</span>
  <span class='p'>}</span>

  <span class='nt'>nav</span> <span class='nt'>li</span> <span class='nt'>li</span> <span class='nt'>button</span><span class='nd'>:hover</span> <span class='p'>{</span>
    <span class='k'>background-color</span><span class='o'>:</span> <span class='m'>#d9ece2</span><span class='p'>;</span>
  <span class='p'>}</span>
</code></pre>
</div>
<p>Lines may be selected (Figure 06-07.03) and then hidden. The Line class two private attributes initialized both to <strong>false</strong> to state that a new line is neither selected nor hidden. A default line width is borrowed in the constructor of the Line class from the context attribute of the board. In the same constructor in Spiral 07 there is a double use of the draw method. The error is not repeated in this step.</p>

<p><strong>Code 06-07.08</strong>: New attributes in the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  
  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box1</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>box2</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The line selection appears in the title of the Web page.</p>

<p><img src='/img/s06s07/LineSelection.png' alt='Alt Figure 06-07.03: Selected lines have a bigger width' /></p>

<p><strong>Figure 06-07.03</strong>: Selected lines have a bigger width.</p>

<p>The draw method of the Line class draws a line if it is not hidden. The width of a selected line is bigger for 2 pixels than the default width.</p>

<p><strong>Code 06-07.09</strong>: The draw method of the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>moveTo</span><span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> 
        <span class='n'>box1</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineTo</span><span class='o'>(</span><span class='n'>box2</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>,</span> 
        <span class='n'>box2</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>/</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span> <span class='o'>+</span> <span class='mi'>2</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The methods for the two private attributes are expressed in short notation.</p>

<p><strong>Code 06-07.10</strong>: Short notation used in select, hide and their related methods.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>select</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>deselect</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>toggleSelection</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span> <span class='o'>=</span> <span class='o'>!</span><span class='n'>_selected</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isSelected</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_selected</span><span class='o'>;</span>
  
  <span class='n'>hide</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
  <span class='n'>show</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='n'>bool</span> <span class='nf'>isHidden</span><span class='o'>()</span> <span class='o'>=&gt;</span> <span class='n'>_hidden</span><span class='o'>;</span>
</code></pre>
</div>
<p>The contains method of the Line class returns true if the given point is on the line between the centers of the two boxes with the error of delta in pixels. The method uses the Point class of Dart.</p>

<p><strong>Code 06-07.11</strong>: The contains method of the Line class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>contains</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>point</span><span class='o'>,</span> <span class='n'>Point</span> <span class='n'>delta</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>box1</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>||</span> 
        <span class='n'>box2</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='n'>Point</span> <span class='n'>pointDif</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
    <span class='n'>bool</span> <span class='n'>inLineRectX</span><span class='o'>,</span> <span class='n'>inLineRectY</span><span class='o'>,</span> <span class='n'>inLineRect</span><span class='o'>;</span>
    <span class='kt'>double</span> <span class='n'>coord</span><span class='o'>;</span>
    
    <span class='n'>Point</span> <span class='n'>beginPoint</span> <span class='o'>=</span> <span class='n'>box1</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    <span class='n'>Point</span> <span class='n'>endPoint</span> <span class='o'>=</span> <span class='n'>box2</span><span class='o'>.</span><span class='na'>center</span><span class='o'>();</span>
    
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    
    <span class='c1'>// Rapid test: Verify if the point is in the line rectangle.</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectX</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>inLineRectY</span> <span class='o'>=</span> <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&gt;=</span> <span class='o'>(</span><span class='n'>endPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>))</span> <span class='o'>&amp;&amp;</span> 
      <span class='o'>(</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>&lt;=</span> <span class='o'>(</span><span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>));</span>
    <span class='o'>}</span>
    <span class='n'>inLineRect</span> <span class='o'>=</span> <span class='n'>inLineRectX</span> <span class='o'>&amp;&amp;</span> <span class='n'>inLineRectY</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>inLineRect</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='c1'>// If the line is horizontal or vertical </span>
    <span class='c1'>// there is no need to continue.</span>
    <span class='k'>if</span> <span class='o'>((</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>||</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&gt;</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>+</span> 
      <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>y</span><span class='o'>;</span>
    <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
      <span class='n'>coord</span> <span class='o'>=</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>+</span> 
      <span class='o'>(((</span><span class='n'>point</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>-</span> <span class='n'>beginPoint</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>*</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>x</span><span class='o'>)</span> <span class='o'>/</span> <span class='n'>pointDif</span><span class='o'>.</span><span class='na'>y</span><span class='o'>)</span> <span class='o'>-</span> <span class='n'>point</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
      <span class='k'>return</span> <span class='n'>coord</span><span class='o'>.</span><span class='na'>abs</span><span class='o'>()</span> <span class='o'>&lt;=</span> <span class='n'>delta</span><span class='o'>.</span><span class='na'>x</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>There are many additions and changes in the Board class to support different actions on lines.</p>

<p><strong>Code 06-07.12</strong>: Methods on lines in the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>lines</span><span class='o'>.</span><span class='na'>clear</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteLine</span><span class='o'>(</span><span class='n'>Line</span> <span class='n'>lineToDelete</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>==</span> <span class='n'>lineToDelete</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>lines</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>line</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>lines</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>countSelectedLines</span><span class='o'>()</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>deleteLine</span><span class='o'>(</span><span class='n'>line</span><span class='o'>);</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>selectLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>line</span><span class='o'>.</span><span class='na'>select</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>select</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>selectBoxes</span><span class='o'>();</span>
    <span class='n'>selectLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>deselectLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>line</span><span class='o'>.</span><span class='na'>deselect</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>deselect</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deselectBoxes</span><span class='o'>();</span>
    <span class='n'>deselectLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>hideSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>hide</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>hideSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>hideSelectedBoxes</span><span class='o'>();</span>
    <span class='n'>hideSelectedLines</span><span class='o'>();</span>
  <span class='o'>}</span>
    
  <span class='kt'>void</span> <span class='nf'>showHiddenLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>line</span><span class='o'>.</span><span class='na'>show</span><span class='o'>();</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>showHiddenSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>showHiddenBoxes</span><span class='o'>();</span>
    <span class='n'>showHiddenLines</span><span class='o'>();</span>
  <span class='o'>}</span>

  <span class='kt'>int</span> <span class='nf'>countSelectedLines</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='kt'>int</span> <span class='nf'>countSelectedLinesContain</span><span class='o'>(</span><span class='kt'>int</span> <span class='n'>pointX</span><span class='o'>,</span> <span class='kt'>int</span> <span class='n'>pointY</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Point</span> <span class='n'>delta</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>DELTA</span><span class='o'>,</span> <span class='n'>DELTA</span><span class='o'>);</span>
    <span class='kt'>int</span> <span class='n'>count</span> <span class='o'>=</span> <span class='mi'>0</span><span class='o'>;</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>isSelected</span><span class='o'>()</span> 
          <span class='o'>&amp;&amp;</span> <span class='n'>line</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>pointX</span><span class='o'>,</span> <span class='n'>pointY</span><span class='o'>),</span> <span class='n'>delta</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='n'>count</span><span class='o'>++;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='n'>count</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='n'>Line</span> <span class='nf'>_lineContains</span><span class='o'>(</span><span class='n'>Point</span> <span class='n'>point</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>Point</span> <span class='n'>delta</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>DELTA</span><span class='o'>,</span> <span class='n'>DELTA</span><span class='o'>);</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Line</span> <span class='n'>line</span> <span class='n'>in</span> <span class='n'>lines</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>point</span><span class='o'>,</span> <span class='n'>delta</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='n'>line</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The DELTA constant of the Board class has the value of 8 pixels. This means that within the 8 pixels surrounding a line, a click will select the line. The private lineContains method of the Board class returns a line that contains the given point with the DELTA error.</p>

<p>In the onMouseMethod of the Board class, if a click happens outside of an existing box and the select tool is on, the click point is passed to the private lineContains method. If the method returns a line, the toggleSelection method is applied to the line. Otherwise, selected boxes and lines are deselected.</p>

<p><strong>Code 06-07.13</strong>: The active select tool part of the onMouseDown method.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>Point</span> <span class='n'>clickedPoint</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>);</span>
        <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>_lineContains</span><span class='o'>(</span><span class='n'>clickedPoint</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='c1'>// Select or deselect the existing line.</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>toggleSelection</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='c1'>// Deselect all.</span>
          <span class='n'>deselect</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span> <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The draw method of the Box class must use the default line width in order draw the current box properly. Without the setLineWidth method, after a line is selected, the boxes may have the same line width as the selected line.</p>

<p><strong>Code 06-07.14</strong>: The defaultLineWidth attribute of the Box class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>x</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>y</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>width</span><span class='o'>,</span> <span class='k'>this</span><span class='o'>.</span><span class='na'>height</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>titleNo</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>nextBoxNo</span><span class='o'>;</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>draw</span><span class='o'>();</span>
    <span class='err'>…</span>
  <span class='o'>}</span>

  <span class='kt'>void</span> <span class='nf'>draw</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>isHidden</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
      <span class='err'>…</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The Board class has also the defaultLineWidth attribute that is used in drawing a border.</p>

<p><strong>Code 06-07.15</strong>: The defaultLineWidth attribute of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>num</span> <span class='n'>defaultLineWidth</span><span class='o'>;</span>
  
  <span class='n'>Board</span><span class='o'>(</span><span class='n'>CanvasElement</span> <span class='n'>canvas</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>defaultLineWidth</span> <span class='o'>=</span> <span class='n'>context</span><span class='o'>.</span><span class='na'>lineWidth</span><span class='o'>;</span>
    <span class='n'>border</span><span class='o'>();</span>
    <span class='err'>…</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The defaultLineWidth attribute is used in drawing the diagram border.</p>

<p><strong>Code 06-07.16</strong>: The border has the default width.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>border</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>beginPath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>rect</span><span class='o'>(</span><span class='mi'>0</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>,</span> <span class='n'>width</span><span class='o'>,</span> <span class='n'>height</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>setLineWidth</span><span class='o'>(</span><span class='n'>defaultLineWidth</span><span class='o'>);</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>closePath</span><span class='o'>();</span>
    <span class='n'>context</span><span class='o'>.</span><span class='na'>stroke</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>When deleting a box, if the box is one of the last two clicked boxes referenced by the lastBoxClicked attribute or the beforeLastBoxClicked attribute, the corresponding attribute must reference <strong>null</strong> instead of the deleted box. Otherwise, a new line may be created that is hanging in the air.</p>

<p><strong>Code 06-07.17</strong>: Nullifying one of the last two clicked boxes.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteBox</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>boxToDelete</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='kt'>int</span> <span class='n'>index</span> <span class='o'>=</span> <span class='n'>boxes</span><span class='o'>.</span><span class='na'>indexOf</span><span class='o'>(</span><span class='n'>box</span><span class='o'>,</span> <span class='mi'>0</span><span class='o'>);</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>removeRange</span><span class='o'>(</span><span class='n'>index</span><span class='o'>,</span> <span class='mi'>1</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>beforeLastBoxClicked</span> <span class='o'>==</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span> <span class='o'>==</span> <span class='n'>lastBoxClicked</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>lastBoxClicked</span> <span class='o'>==</span> <span class='kc'>null</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>return</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The delete method of the Board class must delete all lines and boxes and the fixed tool should return to select.</p>

<p><strong>Code 06-07.18</strong>: The delete method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>delete</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteLines</span><span class='o'>();</span>
    <span class='n'>deleteBoxes</span><span class='o'>();</span>
    <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToSelectAsFixedTool</span><span class='o'>();</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private selectToolDblClicked attribute of the bool type is replaced by the private fixedTool attribute of the int type in the ToolBar class. This is done to resolve the problem of keeping the line tool active even without double-clicking on it. A tool may be on (active) after a click on it. Its active status determines the next action. However, after the action is done, the fixed tool becomes active. A tool becomes fixed after a double-click on it.</p>

<p><strong>Code 06-07.19</strong>: The ToolBar class with private onTool and fixedTool attributes.</p>
<div class='highlight'><pre><code class='java'><span class='kd'>class</span> <span class='nc'>ToolBar</span> <span class='o'>{</span> 
  <span class='err'>…</span>
  <span class='kt'>int</span> <span class='n'>_onTool</span><span class='o'>;</span>
  <span class='kt'>int</span> <span class='n'>_fixedTool</span><span class='o'>;</span>
  <span class='err'>…</span>
  <span class='n'>ToolBar</span><span class='o'>(</span><span class='k'>this</span><span class='o'>.</span><span class='na'>board</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='err'>…</span>
    <span class='n'>selectButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
    <span class='n'>boxButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>BOX</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>BOX</span><span class='o'>;</span>
    <span class='o'>});</span>
    <span class='err'>…</span>
    <span class='n'>lineButton</span><span class='o'>.</span><span class='na'>on</span><span class='o'>.</span><span class='na'>dblClick</span><span class='o'>.</span><span class='na'>add</span><span class='o'>((</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>LINE</span><span class='o'>);</span>
      <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>LINE</span><span class='o'>;</span>
    <span class='o'>});</span>
    
    <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
  <span class='o'>}</span>
  
  <span class='err'>…</span>
  
  <span class='kt'>void</span> <span class='nf'>backToFixedTool</span><span class='o'>()</span>  <span class='o'>{</span>
      <span class='n'>onTool</span><span class='o'>(</span><span class='n'>_fixedTool</span><span class='o'>);</span>
  <span class='o'>}</span>
  
  <span class='kt'>void</span> <span class='nf'>backToSelectAsFixedTool</span><span class='o'>()</span>  <span class='o'>{</span>
    <span class='n'>onTool</span><span class='o'>(</span><span class='n'>SELECT</span><span class='o'>);</span>
    <span class='n'>_fixedTool</span> <span class='o'>=</span> <span class='n'>SELECT</span><span class='o'>;</span>
  <span class='o'>}</span>
  
<span class='o'>}</span>
</code></pre>
</div>
<p>After a selection of boxes and lines is deleted, a diagram may be empty. In that case the fixed tool must return to select.</p>

<p><strong>Code 06-07.20</strong>: When deleting a selection of all boxes and lines.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>deleteSelection</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='n'>deleteSelectedLines</span><span class='o'>();</span>
    <span class='n'>deleteSelectedBoxes</span><span class='o'>();</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>isEmpty</span><span class='o'>())</span> <span class='o'>{</span>
      <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToSelectAsFixedTool</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  
  <span class='n'>bool</span> <span class='nf'>isEmpty</span><span class='o'>()</span> <span class='o'>{</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>boxes</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>==</span> <span class='mi'>0</span> <span class='o'>&amp;&amp;</span> <span class='n'>lines</span><span class='o'>.</span><span class='na'>length</span> <span class='o'>==</span> <span class='mi'>0</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>The private boxExists method of the Board class returns <strong>true</strong> if the given box is a member of the boxes attribute.</p>

<p><strong>Code 06-07.21</strong>: The private boxExists method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='n'>bool</span> <span class='nf'>_boxExists</span><span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>b</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>b</span> <span class='o'>==</span> <span class='n'>box</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='k'>return</span> <span class='kc'>true</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    <span class='k'>return</span> <span class='kc'>false</span><span class='o'>;</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>This method is called in the onMouseDown method to check if the last two boxes clicked used in a new line creation do actually exist. After one of actions is done by the onMouseDown method, the fixed tool is back.</p>

<p><strong>Code 06-07.22</strong>: The onMouseDown method of the Board class.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>bool</span> <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>false</span><span class='o'>;</span> 
    <span class='k'>for</span> <span class='o'>(</span><span class='n'>Box</span> <span class='n'>box</span> <span class='n'>in</span> <span class='n'>boxes</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>box</span><span class='o'>.</span><span class='na'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
        <span class='c1'>// Clicked on the existing box.</span>
        <span class='n'>clickedOnBox</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
        <span class='k'>break</span><span class='o'>;</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
    
    <span class='k'>if</span> <span class='o'>(!</span><span class='n'>clickedOnBox</span><span class='o'>)</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='n'>Point</span> <span class='n'>clickedPoint</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Point</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>);</span>
        <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='n'>_lineContains</span><span class='o'>(</span><span class='n'>clickedPoint</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>line</span> <span class='o'>!=</span> <span class='kc'>null</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='c1'>// Select or deselect the existing line.</span>
          <span class='n'>line</span><span class='o'>.</span><span class='na'>toggleSelection</span><span class='o'>();</span>
        <span class='o'>}</span> <span class='k'>else</span> <span class='o'>{</span>
          <span class='c1'>// Deselect all.</span>
          <span class='n'>deselect</span><span class='o'>();</span>
        <span class='o'>}</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isBoxToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='c1'>// Create a box in the position of the mouse click on the board.</span>
        <span class='n'>Box</span> <span class='n'>box</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Box</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>,</span> 
          <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_WIDTH</span><span class='o'>,</span> <span class='n'>Box</span><span class='o'>.</span><span class='na'>DEFAULT_HEIGHT</span><span class='o'>);</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>&gt;</span> <span class='n'>width</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>x</span> <span class='o'>=</span> <span class='n'>width</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>width</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span> <span class='o'>+</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>&gt;</span> <span class='n'>height</span><span class='o'>)</span> <span class='o'>{</span>
          <span class='n'>box</span><span class='o'>.</span><span class='na'>y</span> <span class='o'>=</span> <span class='n'>height</span> <span class='o'>-</span> <span class='n'>box</span><span class='o'>.</span><span class='na'>height</span> <span class='o'>-</span> <span class='mi'>1</span><span class='o'>;</span>
        <span class='o'>}</span>
        <span class='n'>boxes</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>box</span><span class='o'>);</span>
      <span class='o'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='o'>(</span><span class='n'>toolBar</span><span class='o'>.</span><span class='na'>isLineToolOn</span><span class='o'>())</span> <span class='o'>{</span>
        <span class='c1'>// Create a line between the last two clicked boxes.</span>
        <span class='k'>if</span> <span class='o'>(</span><span class='n'>beforeLastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> <span class='n'>lastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> 
            <span class='n'>_boxExists</span><span class='o'>(</span><span class='n'>beforeLastBoxClicked</span><span class='o'>)</span> <span class='o'>&amp;&amp;</span> 
            <span class='n'>_boxExists</span><span class='o'>(</span><span class='n'>lastBoxClicked</span><span class='o'>))</span> <span class='o'>{</span>  
          <span class='n'>Line</span> <span class='n'>line</span> <span class='o'>=</span> <span class='k'>new</span> <span class='n'>Line</span><span class='o'>(</span><span class='k'>this</span><span class='o'>,</span> <span class='n'>beforeLastBoxClicked</span><span class='o'>,</span> 
            <span class='n'>lastBoxClicked</span><span class='o'>);</span>
          <span class='n'>lines</span><span class='o'>.</span><span class='na'>add</span><span class='o'>(</span><span class='n'>line</span><span class='o'>);</span>
        <span class='o'>}</span>
      <span class='o'>}</span>
      <span class='n'>toolBar</span><span class='o'>.</span><span class='na'>backToFixedTool</span><span class='o'>();</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
<p>In the onMouseDown method of the Box class, when a box is clicked on, before it becomes the last box clicked, the actual last box clicked first becomes the box clicked before the last one, but only if it is not <strong>null</strong> and if it is different from the current box.</p>

<p><strong>Code 06-07.23</strong>: Updating the two last boxes clicked.</p>
<div class='highlight'><pre><code class='java'>  <span class='kt'>void</span> <span class='nf'>onMouseDown</span><span class='o'>(</span><span class='n'>MouseEvent</span> <span class='n'>e</span><span class='o'>)</span> <span class='o'>{</span>
    <span class='n'>_mouseDown</span> <span class='o'>=</span> <span class='kc'>true</span><span class='o'>;</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>board</span><span class='o'>.</span><span class='na'>toolBar</span><span class='o'>.</span><span class='na'>isSelectToolOn</span><span class='o'>()</span> <span class='o'>&amp;&amp;</span> 
        <span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='n'>toggleSelection</span><span class='o'>();</span>
    <span class='o'>}</span>
    <span class='k'>if</span> <span class='o'>(</span><span class='n'>contains</span><span class='o'>(</span><span class='n'>e</span><span class='o'>.</span><span class='na'>offsetX</span><span class='o'>,</span> <span class='n'>e</span><span class='o'>.</span><span class='na'>offsetY</span><span class='o'>))</span> <span class='o'>{</span>
      <span class='k'>if</span> <span class='o'>(</span><span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>!=</span> <span class='kc'>null</span> <span class='o'>&amp;&amp;</span> 
          <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>!=</span> <span class='k'>this</span><span class='o'>)</span> <span class='o'>{</span>
        <span class='n'>board</span><span class='o'>.</span><span class='na'>beforeLastBoxClicked</span> <span class='o'>=</span> <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span><span class='o'>;</span>
      <span class='o'>}</span>
      <span class='n'>board</span><span class='o'>.</span><span class='na'>lastBoxClicked</span> <span class='o'>=</span> <span class='k'>this</span><span class='o'>;</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
</code></pre>
</div>
        </section>

        <section>
     
        </section>

        <footer>
          <a href="http://dzenanr.github.com/ondart.rss">
            <img src="/img/xml.gif" width=36 height=14 alt="RSS feed for this site" border=0>
          </a>
        </footer>

    </body>
</html>


